<!DOCTYPE html><!-- Layout específico para writeups en markdown. Muestra hero (si existe) y el contenido --><html lang="es"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Writeup</title><link rel="stylesheet" href="/_astro/contact.Cqf3A00g.css">
<link rel="stylesheet" href="/_astro/contact.B2mefsI4.css"></head> <body class="bg-bg1 text-white"> <div class="min-h-screen flex flex-col"> <!-- Header reutiliza el componente global si está disponible --> <header class="w-full py-4"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="flex items-center gap-3"> <div class="w-12 h-12 rounded-full bg-black flex items-center justify-center shadow-[0_0_10px_2px_rgba(0,255,255,0.7)]"> <img src="/icons8-hacker-96.png" alt="Logo" class="w-10 h-10 rounded-full object-cover invert"> </div> <div> <div class="text-lg font-semibold">Angel Corral</div> <div class="text-xs text-slate-400">Ciberseguridad · Hacking Ético</div> </div> </a> <nav class="flex items-center gap-6 text-sm"> <a href="/writeups">Writeups</a> <a href="/projects">Proyectos</a> <a href="/services">Servicios</a> <a href="/contact" class="px-3 py-1 rounded-md border">Contacto</a> </nav> </div> </header> <main class="container mx-auto px-6 py-10 flex-1"> <article class="max-w-3xl mx-auto">  <div class="prose prose-invert prose-xl max-w-none">   <article class="max-w-3xl mx-auto px-6"> <div class="mb-12"> <a href="/projects" class="text-sm text-slate-400 hover:text-accentBlue transition-colors">
← Volver a Proyectos
</a> <h1 class="text-4xl font-bold bg-gradient-to-r from-accentBlue to-accentGreen text-transparent bg-clip-text mb-4"> Proyecto 3 </h1>  <div class="flex flex-wrap gap-3">  </div> </div> <div class="prose prose-projects prose-invert prose-xl max-w-none"> <h1 id="script-de-respaldo-automático">Script de Respaldo Automático</h1>
<h2 id="resumen">Resumen</h2>
<p>Script Bash para automatizar respaldos locales (tar.gz), gestionar retención básica y opcionalmente sincronizar los archivos de respaldo con un repositorio Git (por ejemplo, en GitHub). Está diseñado para uso en Linux/Unix y sigue buenas prácticas de robustez y seguridad.</p>
<h2 id="características-principales">Características principales</h2>
<ul>
<li>Parámetros configurables mediante variables de entorno.</li>
<li>Manejo de errores y limpieza segura (trap).</li>
<li>Rotación simple de backups por número máximo.</li>
<li>Integración opcional con Git (commit y push) usando la rama configurada.</li>
</ul>
<h2 id="requisitos">Requisitos</h2>
<ul>
<li>Bash (>= 4 recomendado)</li>
<li>tar, gzip</li>
<li>git (solo si se quiere sincronizar con un repositorio remoto)</li>
<li>Permisos adecuados sobre los directorios implicados</li>
</ul>
<h2 id="variables-configurables-valores-por-defecto-dentro-del-script">Variables configurables (valores por defecto dentro del script)</h2>
<ul>
<li>ORIGEN: directorio a respaldar</li>
<li>BACKUP_DIR: directorio donde se almacenan los backups localmente</li>
<li>KEEP: número máximo de backups a conservar (rotación)</li>
<li>GIT_REPO: ruta local del repositorio Git donde se guardarán los backups (opcional)</li>
<li>GIT_BRANCH: rama para push (por defecto: main)</li>
</ul>
<h2 id="uso">Uso</h2>
<ol>
<li>Copiar el script a un archivo, por ejemplo backup.sh</li>
<li>Editar las variables al principio del script o definirlas como variables de entorno antes de ejecutar.</li>
<li>Dar permisos de ejecución:</li>
</ol>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">chmod</span><span style="color:#F1FA8C"> +x</span><span style="color:#F1FA8C"> backup.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">4.</span><span style="color:#F1FA8C"> Ejecutar</span><span style="color:#F1FA8C"> manualmente</span><span style="color:#F1FA8C"> o</span><span style="color:#F1FA8C"> añadir</span><span style="color:#F1FA8C"> a</span><span style="color:#F1FA8C"> crontab</span><span style="color:#F1FA8C"> para</span><span style="color:#F1FA8C"> ejecución</span><span style="color:#F1FA8C"> periódica.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">## Script recomendado</span></span>
<span class="line"><span style="color:#F1FA8C">```</span><span style="color:#50FA7B">bash</span></span>
<span class="line"><span style="color:#50FA7B">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4"># Configuración (ajustar según sea necesario o exportar como variables de entorno)</span></span>
<span class="line"><span style="color:#8BE9FD">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">${</span><span style="color:#BD93F9">ORIGEN</span><span style="color:#FF79C6">:=/</span><span style="color:#BD93F9">ruta</span><span style="color:#FF79C6">/</span><span style="color:#BD93F9">a</span><span style="color:#FF79C6">/</span><span style="color:#BD93F9">origen</span><span style="color:#F1FA8C">}</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">${</span><span style="color:#BD93F9">BACKUP_DIR</span><span style="color:#FF79C6">:=/</span><span style="color:#BD93F9">ruta</span><span style="color:#FF79C6">/</span><span style="color:#BD93F9">a</span><span style="color:#FF79C6">/</span><span style="color:#BD93F9">backups</span><span style="color:#F1FA8C">}</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">${</span><span style="color:#BD93F9">KEEP</span><span style="color:#FF79C6">:=</span><span style="color:#BD93F9">10</span><span style="color:#F1FA8C">}</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">${</span><span style="color:#BD93F9">GIT_REPO</span><span style="color:#FF79C6">:=</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">}</span><span style="color:#E9F284">"</span><span style="color:#FF79C6">  #</span><span style="color:#BD93F9"> ruta</span><span style="color:#BD93F9"> local</span><span style="color:#BD93F9"> del</span><span style="color:#BD93F9"> repo</span><span style="color:#BD93F9"> git</span><span style="color:#F1FA8C"> (vacío = </span><span style="color:#BD93F9">no</span><span style="color:#BD93F9"> usar</span><span style="color:#BD93F9"> git</span><span style="color:#F1FA8C">)</span></span>
<span class="line"><span style="color:#FF79C6">:</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">${</span><span style="color:#BD93F9">GIT_BRANCH</span><span style="color:#FF79C6">:=</span><span style="color:#BD93F9">main</span><span style="color:#F1FA8C">}</span><span style="color:#E9F284">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD93F9">FECHA</span><span style="color:#F1FA8C">=$(</span><span style="color:#BD93F9">date</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">+%Y-%m-%d_%H-%M-%S</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">)</span></span>
<span class="line"><span style="color:#BD93F9">NOMBRE</span><span style="color:#F1FA8C">=</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">backup_${</span><span style="color:#BD93F9">FECHA</span><span style="color:#F1FA8C">}.tar.gz</span><span style="color:#E9F284">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD93F9">log</span><span style="color:#F1FA8C">() { </span><span style="color:#BD93F9">printf</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">%s %s\n</span><span style="color:#E9F284">"</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">$(</span><span style="color:#50FA7B">date</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">+%Y-%m-%d %H:%M:%S</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">)</span><span style="color:#E9F284">"</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9;font-style:italic">$*</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F1FA8C"># Verificaciones iniciales</span></span>
<span class="line"><span style="color:#F1FA8C">if [ ! -d </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$ORIGEN</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> ]; then</span></span>
<span class="line"><span style="color:#F1FA8C">    log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">ERROR: Directorio de origen no existe: </span><span style="color:#BD93F9">$ORIGEN</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">    exit 2</span></span>
<span class="line"><span style="color:#F1FA8C">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F1FA8C">mkdir -p </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$BACKUP_DIR</span><span style="color:#E9F284">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F1FA8C">TMPFILE=$(</span><span style="color:#50FA7B">mktemp</span><span style="color:#BD93F9"> -p</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$BACKUP_DIR</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> .tmp_backup_XXXXXX) || { log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Fallo creando tmpfile</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">; exit 3; }</span></span>
<span class="line"><span style="color:#F1FA8C">cleanup() {</span></span>
<span class="line"><span style="color:#F1FA8C">    rm -f </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$TMPFILE</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">}</span></span>
<span class="line"><span style="color:#F1FA8C">trap cleanup EXIT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F1FA8C">log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Creando backup: </span><span style="color:#BD93F9">$NOMBRE</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">if tar -czf </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$TMPFILE</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> -C </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$ORIGEN</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> .; then</span></span>
<span class="line"><span style="color:#F1FA8C">    mv </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$TMPFILE</span><span style="color:#E9F284">"</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$BACKUP_DIR</span><span style="color:#F1FA8C">/</span><span style="color:#BD93F9">$NOMBRE</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">    log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Backup creado en </span><span style="color:#BD93F9">$BACKUP_DIR</span><span style="color:#F1FA8C">/</span><span style="color:#BD93F9">$NOMBRE</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">else</span></span>
<span class="line"><span style="color:#F1FA8C">    log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">ERROR: Falló creación del tar.gz</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">    exit 4</span></span>
<span class="line"><span style="color:#F1FA8C">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F1FA8C"># Rotación: conservar solo los últimos </span><span style="color:#BD93F9">$KEEP</span><span style="color:#F1FA8C"> archivos</span></span>
<span class="line"><span style="color:#F1FA8C">if command -v ls >/dev/null 2>&#x26;1; then</span></span>
<span class="line"><span style="color:#F1FA8C">    mapfile -t archivos &#x3C; &#x3C;(ls -1t </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$BACKUP_DIR</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">/backup_*.tar.gz 2>/dev/null || true)</span></span>
<span class="line"><span style="color:#F1FA8C">    if [ </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">${</span><span style="color:#FF79C6">#</span><span style="color:#BD93F9">archivos</span><span style="color:#F1FA8C">[</span><span style="color:#FF79C6">@</span><span style="color:#F1FA8C">]}</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> -gt </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$KEEP</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> ]; then</span></span>
<span class="line"><span style="color:#F1FA8C">        for f in </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">${</span><span style="color:#BD93F9">archivos</span><span style="color:#F1FA8C">[</span><span style="color:#FF79C6">@</span><span style="color:#F1FA8C">]</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9">$KEEP</span><span style="color:#F1FA8C">}</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">; do</span></span>
<span class="line"><span style="color:#F1FA8C">            log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Eliminando backup viejo: </span><span style="color:#BD93F9">$f</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">            rm -f -- </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$f</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> || log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Advertencia: no se pudo eliminar </span><span style="color:#BD93F9">$f</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">        done</span></span>
<span class="line"><span style="color:#F1FA8C">    fi</span></span>
<span class="line"><span style="color:#F1FA8C">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F1FA8C"># Integración con Git (opcional)</span></span>
<span class="line"><span style="color:#F1FA8C">if [ -n </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$GIT_REPO</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> ]; then</span></span>
<span class="line"><span style="color:#F1FA8C">    if [ ! -d </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$GIT_REPO</span><span style="color:#F1FA8C">/.git</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> ]; then</span></span>
<span class="line"><span style="color:#F1FA8C">        log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">ERROR: </span><span style="color:#BD93F9">$GIT_REPO</span><span style="color:#F1FA8C"> no es un repositorio git válido</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">        exit 5</span></span>
<span class="line"><span style="color:#F1FA8C">    fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F1FA8C">    cp </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$BACKUP_DIR</span><span style="color:#F1FA8C">/</span><span style="color:#BD93F9">$NOMBRE</span><span style="color:#E9F284">"</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$GIT_REPO</span><span style="color:#F1FA8C">/</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> || { log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">ERROR: no se pudo copiar </span><span style="color:#BD93F9">$NOMBRE</span><span style="color:#F1FA8C"> a </span><span style="color:#BD93F9">$GIT_REPO</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">; exit 6; }</span></span>
<span class="line"><span style="color:#F1FA8C">    cd </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$GIT_REPO</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">    git add </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$NOMBRE</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">    git commit -m </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Backup: </span><span style="color:#BD93F9">$FECHA</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> || log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Advertencia: ningún cambio para commitear</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">    git push origin </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$GIT_BRANCH</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> || { log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">ERROR: push falló</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">; exit 7; }</span></span>
<span class="line"><span style="color:#F1FA8C">    log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Backup sincronizado en repo: </span><span style="color:#BD93F9">$GIT_REPO</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F1FA8C">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F1FA8C">log </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Proceso finalizado con éxito</span><span style="color:#E9F284">"</span></span></code></pre>
<h2 id="ejemplo-de-crontab">Ejemplo de crontab</h2>
<p>Recomendado usar rutas absolutas y redirigir salida a un log controlado.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span># Ejecutar diariamente a las 01:30 y guardar log (ejecutar como el usuario con permisos)</span></span>
<span class="line"><span>30 1 * * * /usr/bin/env bash /ruta/a/backup.sh >> /var/log/backup_script.log 2>&#x26;1</span></span></code></pre>
<h2 id="buenas-prácticas-y-seguridad">Buenas prácticas y seguridad</h2>
<ul>
<li>Preferir autenticación por clave SSH para git push y/o usar un token con gh o con credenciales del sistema.</li>
<li>Restringir permisos del directorio de backups: chmod 700 /ruta/a/backups.</li>
<li>Evitar poner contraseñas en texto plano dentro del script.</li>
<li>Probar el script manualmente antes de programarlo en cron.</li>
</ul>
<h2 id="depuración-y-troubleshooting">Depuración y troubleshooting</h2>
<ul>
<li>Revisar /var/log/backup_script.log (o el archivo que haya definido) para mensajes de error.</li>
<li>Ejecutar el script en modo verboso para aislar problemas: bash -x backup.sh.</li>
</ul>
<h2 id="notas-finales">Notas finales</h2>
<p>Este script es una base sólida para respaldos simples y sincronización con Git. Para entornos de producción o datos críticos, considere soluciones dedicadas (rsync+snapshots, Borg, Restic, duplicity) que brindan deduplicación, cifrado y mejor retención.</p> </div> <div class="mt-16 pt-8 border-t border-slate-800"> <a href="/projects" class="text-slate-400 hover:text-accentBlue transition-colors">
← Volver a la lista de proyectos
</a> </div> </article>   </div> </article> </main> <footer class="w-full py-6 mt-12"> <div class="container mx-auto text-sm text-slate-400">
© 2025 Angel Corral — Ciberseguridad
</div> </footer> </div> </body></html>