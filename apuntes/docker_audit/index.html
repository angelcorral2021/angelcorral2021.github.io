<!DOCTYPE html><!-- Layout específico para writeups en markdown. Muestra hero (si existe) y el contenido --><html lang="es" class="dark"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Writeup</title><script type="module">!function(){const t=localStorage.getItem("theme")||"dark";document.documentElement.classList.toggle("light","light"===t),document.documentElement.classList.toggle("dark","dark"===t)}();</script><link rel="stylesheet" href="/assets/apuntes.fBeTOWmP.css">
<link rel="stylesheet" href="/assets/apuntes.sk8r29IW.css"></head> <body class="bg-bg1 text-white"> <div class="min-h-screen flex flex-col"> <!-- Header reutiliza el componente global si está disponible --> <header class="w-full py-4"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="flex items-center gap-3"> <div> <div class="text-lg font-semibold">Angel Corral</div> <div class="text-xs text-slate-400">Informatica y Ciberseguridad</div> </div> </a> <nav class="flex items-center gap-6 text-sm"> <a href="/writeups">Writeups</a> <a href="/projects">Proyectos</a> <a href="/apuntes">Apuntes</a> <a href="/services">Servicios</a> <a href="/contact" class="px-3 py-1 rounded-md border">Contacto</a> <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema" type="button"> <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path> </svg> <svg id="moon-icon" class="block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path> </svg> </button> <script type="module">!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("sun-icon"),s=document.getElementById("moon-icon"),d=document.documentElement;function c(){return localStorage.getItem("theme")||"dark"}function l(e){"light"===e?(d.classList.remove("dark"),d.classList.add("light"),t.classList.remove("hidden"),t.classList.add("block"),s.classList.remove("block"),s.classList.add("hidden")):(d.classList.remove("light"),d.classList.add("dark"),s.classList.remove("hidden"),s.classList.add("block"),t.classList.remove("block"),t.classList.add("hidden")),localStorage.setItem("theme",e)}l(c()),e.addEventListener("click",()=>{l("light"===c()?"dark":"light")})}();</script> </nav> </div> </header> <main class="container mx-auto px-6 py-10 flex-1"> <article class="max-w-3xl mx-auto">  <div class="prose prose-invert prose-xl max-w-none">   <article class="max-w-3xl mx-auto px-6"> <div class="mb-12"> <a href="/apuntes" class="text-sm text-slate-400 hover:text-accentBlue transition-colors">
← Volver a Apuntes
</a> <h1 class="text-4xl font-bold bg-gradient-to-r from-accentBlue to-accentGreen text-transparent bg-clip-text mb-4"> DOCKER AUDIT </h1>  <div class="flex flex-wrap gap-3">  </div> </div> <div class="prose prose-projects prose-invert prose-xl max-w-none"> <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#6272A4">#!/bin/bash</span></span>
<span class="line"><span style="color:#6272A4"># docker_audit.sh v1.3 — Auditoría rápida y no intrusiva del entorno Docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">=== Docker Security Audit ($(</span><span style="color:#50FA7B">date</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">+%Y-%m-%d %H:%M:%S</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">)) ===</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4"># Verificar que Docker esté instalado</span></span>
<span class="line"><span style="color:#FF79C6">if</span><span style="color:#FF79C6"> !</span><span style="color:#8BE9FD"> command</span><span style="color:#BD93F9"> -v</span><span style="color:#F1FA8C"> docker</span><span style="color:#F8F8F2"> &#x26;</span><span style="color:#FF79C6">></span><span style="color:#F8F8F2">/dev/null; </span><span style="color:#FF79C6">then</span></span>
<span class="line"><span style="color:#8BE9FD">  echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[!] Docker no está instalado o no está en el PATH.</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">  exit</span><span style="color:#BD93F9"> 1</span></span>
<span class="line"><span style="color:#FF79C6">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4"># 1. Versión y privilegios</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[*] Información general:</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#50FA7B">docker</span><span style="color:#F1FA8C"> version</span><span style="color:#BD93F9"> --format</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">Servidor: {{.Server.Version}} | Cliente: {{.Client.Version}}</span><span style="color:#E9F284">'</span><span style="color:#FF79C6"> 2></span><span style="color:#F1FA8C">/dev/null</span><span style="color:#FF79C6"> ||</span><span style="color:#8BE9FD"> echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[!] No se pudo obtener la versión de Docker.</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">Usuario actual: $(</span><span style="color:#50FA7B">whoami</span><span style="color:#F1FA8C">)</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#50FA7B">groups</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#BD93F9"> -q</span><span style="color:#F1FA8C"> docker</span><span style="color:#F8F8F2"> &#x26;&#x26; </span><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[✔] Usuario pertenece al grupo docker</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> ||</span><span style="color:#8BE9FD"> echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[!] Usuario NO pertenece al grupo docker</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4"># 2. Contenedores en ejecución</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[*] Contenedores en ejecución:</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">if</span><span style="color:#FF79C6"> !</span><span style="color:#50FA7B"> docker</span><span style="color:#F1FA8C"> ps</span><span style="color:#BD93F9"> --format</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">table {{.Names}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#BD93F9"> -v</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">NAMES</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> ></span><span style="color:#F1FA8C">/dev/null</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">then</span></span>
<span class="line"><span style="color:#8BE9FD">  echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[i] No hay contenedores en ejecución.</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">else</span></span>
<span class="line"><span style="color:#50FA7B">  docker</span><span style="color:#F1FA8C"> ps</span><span style="color:#BD93F9"> --format</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">table {{.Names}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">fi</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4"># 3. Verificación de montajes sensibles</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[*] Verificando montajes peligrosos...</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#BD93F9">containers</span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2">$(</span><span style="color:#50FA7B">docker</span><span style="color:#F1FA8C"> ps</span><span style="color:#BD93F9"> -q</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">if</span><span style="color:#F8F8F2"> [ </span><span style="color:#FF79C6">-z</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$containers</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> ]; </span><span style="color:#FF79C6">then</span></span>
<span class="line"><span style="color:#8BE9FD">  echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[i] No hay contenedores para inspeccionar.</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">else</span></span>
<span class="line"><span style="color:#BD93F9">  risk_found</span><span style="color:#FF79C6">=</span><span style="color:#F1FA8C">false</span></span>
<span class="line"><span style="color:#FF79C6">  while</span><span style="color:#8BE9FD"> read</span><span style="color:#BD93F9"> -r</span><span style="color:#F1FA8C"> id</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">do</span></span>
<span class="line"><span style="color:#BD93F9">    name</span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2">$(</span><span style="color:#50FA7B">docker</span><span style="color:#F1FA8C"> inspect</span><span style="color:#BD93F9"> --format</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">{{.Name}}</span><span style="color:#E9F284">'</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$id</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> tr</span><span style="color:#BD93F9"> -d</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">/</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#BD93F9">    mounts</span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2">$(</span><span style="color:#50FA7B">docker</span><span style="color:#F1FA8C"> inspect</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$id</span><span style="color:#E9F284">"</span><span style="color:#BD93F9"> --format</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">{{json .Mounts}}</span><span style="color:#E9F284">'</span><span style="color:#FF79C6"> 2></span><span style="color:#F1FA8C">/dev/null</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#8BE9FD"> echo</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$mounts</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#BD93F9"> -Eq</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">docker.sock|/root|/etc/shadow|/var/run/docker.sock|/etc/passwd</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">then</span></span>
<span class="line"><span style="color:#8BE9FD">      echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[!] Riesgo: Contenedor '</span><span style="color:#BD93F9">$name</span><span style="color:#F1FA8C">' monta rutas sensibles</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">      echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">    → $(</span><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$mounts</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#BD93F9"> -Eo</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">/[^"]+</span><span style="color:#E9F284">'</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#BD93F9"> -E</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">docker.sock|/root|/etc/shadow|/etc/passwd</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">)</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#BD93F9">      risk_found</span><span style="color:#FF79C6">=</span><span style="color:#F1FA8C">true</span></span>
<span class="line"><span style="color:#FF79C6">    fi</span></span>
<span class="line"><span style="color:#FF79C6">  done</span><span style="color:#FF79C6"> &#x3C;&#x3C;&#x3C;</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$containers</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F8F8F2">  [ </span><span style="color:#E9F284">"</span><span style="color:#BD93F9">$risk_found</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> false</span><span style="color:#F8F8F2"> ] &#x26;&#x26; </span><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[✔] No se detectaron montajes sensibles.</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">fi</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4"># 4. Revisión de capacidades peligrosas</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[*] Revisando capacidades peligrosas...</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">if</span><span style="color:#50FA7B"> docker</span><span style="color:#F1FA8C"> ps</span><span style="color:#BD93F9"> -q</span><span style="color:#FF79C6"> |</span><span style="color:#FF79C6"> while</span><span style="color:#8BE9FD"> read</span><span style="color:#BD93F9"> -r</span><span style="color:#F1FA8C"> id</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">do</span><span style="color:#50FA7B"> docker</span><span style="color:#F1FA8C"> inspect</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$id</span><span style="color:#E9F284">"</span><span style="color:#BD93F9"> --format</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">{{.HostConfig.CapAdd}}</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">done</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#BD93F9"> -qE</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">SYS_ADMIN|NET_ADMIN|SYS_PTRACE</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">then</span></span>
<span class="line"><span style="color:#8BE9FD">  echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[!] Algunos contenedores tienen capacidades elevadas (SYS_ADMIN, NET_ADMIN, SYS_PTRACE).</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">else</span></span>
<span class="line"><span style="color:#8BE9FD">  echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[✔] No se detectaron capacidades peligrosas.</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">fi</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4"># 5. Revisión de modo privilegiado</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[*] Comprobando contenedores con modo privilegiado...</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">if</span><span style="color:#50FA7B"> docker</span><span style="color:#F1FA8C"> ps</span><span style="color:#BD93F9"> -q</span><span style="color:#FF79C6"> |</span><span style="color:#FF79C6"> while</span><span style="color:#8BE9FD"> read</span><span style="color:#BD93F9"> -r</span><span style="color:#F1FA8C"> id</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">do</span><span style="color:#50FA7B"> docker</span><span style="color:#F1FA8C"> inspect</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$id</span><span style="color:#E9F284">"</span><span style="color:#BD93F9"> --format</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">{{.HostConfig.Privileged}}</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">done</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#BD93F9"> -q</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">then</span></span>
<span class="line"><span style="color:#8BE9FD">  echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[!] Hay contenedores en modo privilegiado.</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">else</span></span>
<span class="line"><span style="color:#8BE9FD">  echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">[✔] Ningún contenedor usa modo privilegiado.</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#FF79C6">fi</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">=== Auditoría Docker completada ===</span><span style="color:#E9F284">"</span></span>
<span class="line"></span></code></pre> </div> <div class="mt-16 pt-8 border-t border-slate-800"> <a href="/projects" class="text-slate-400 hover:text-accentBlue transition-colors">
← Volver a la lista de proyectos
</a> </div> </article>   </div> </article> </main> <footer class="w-full py-6 mt-12"> <div class="container mx-auto text-sm text-slate-400">
© 2025 Angel Corral - Todos los derechos reservados.
</div> </footer> </div> </body></html>