<!DOCTYPE html><!-- Layout específico para writeups en markdown. Muestra hero (si existe) y el contenido --><html lang="es" class="dark"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Writeup</title><script type="module">!function(){const t=localStorage.getItem("theme")||"dark";document.documentElement.classList.toggle("light","light"===t),document.documentElement.classList.toggle("dark","dark"===t)}();</script><link rel="stylesheet" href="/assets/apuntes.fBeTOWmP.css">
<link rel="stylesheet" href="/assets/apuntes.sk8r29IW.css"></head> <body class="bg-bg1 text-white"> <div class="min-h-screen flex flex-col"> <!-- Header reutiliza el componente global si está disponible --> <header class="w-full py-4"> <div class="container mx-auto flex items-center justify-between"> <a href="/" class="flex items-center gap-3"> <div> <div class="text-lg font-semibold">Angel Corral</div> <div class="text-xs text-slate-400">Informatica y Ciberseguridad</div> </div> </a> <nav class="flex items-center gap-6 text-sm"> <a href="/writeups">Writeups</a> <a href="/projects">Proyectos</a> <a href="/apuntes">Apuntes</a> <a href="/services">Servicios</a> <a href="/contact" class="px-3 py-1 rounded-md border">Contacto</a> <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema" type="button"> <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path> </svg> <svg id="moon-icon" class="block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path> </svg> </button> <script type="module">!function(){const e=document.getElementById("theme-toggle"),t=document.getElementById("sun-icon"),s=document.getElementById("moon-icon"),d=document.documentElement;function c(){return localStorage.getItem("theme")||"dark"}function l(e){"light"===e?(d.classList.remove("dark"),d.classList.add("light"),t.classList.remove("hidden"),t.classList.add("block"),s.classList.remove("block"),s.classList.add("hidden")):(d.classList.remove("light"),d.classList.add("dark"),s.classList.remove("hidden"),s.classList.add("block"),t.classList.remove("block"),t.classList.add("hidden")),localStorage.setItem("theme",e)}l(c()),e.addEventListener("click",()=>{l("light"===c()?"dark":"light")})}();</script> </nav> </div> </header> <main class="container mx-auto px-6 py-10 flex-1"> <article class="max-w-3xl mx-auto">  <div class="prose prose-invert prose-xl max-w-none">   <article class="max-w-5xl mx-auto px-6 py-12"> <!-- ENCABEZADO --> <div class="mb-14 text-center"> <a href="/writeups" class="text-sm text-slate-400 hover:text-accentBlue transition-colors block mb-4">
← Volver a Writeups
</a> <h1 class="text-5xl font-bold bg-gradient-to-r from-accentBlue to-accentGreen text-transparent bg-clip-text mb-4"> Lockdown Lab </h1> <p class="text-slate-400 text-sm mb-2">11 de enero de 2026</p> <p class="text-lg text-slate-300 max-w-2xl mx-auto mb-6 leading-relaxed"> Informe Técnico de Análisis Forense: Lockdown Lab </p> </div> <!-- BLOQUE DE INFORMACIÓN TÉCNICA --> <section class="grid md:grid-cols-2 gap-6 mb-12 text-sm"> <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-xl backdrop-blur-sm"> <h2 class="text-accentBlue text-lg font-semibold mb-3">Detalles Técnicos</h2> <ul class="space-y-2 text-slate-300">    <li><strong>Dificultad:</strong> Easy</li> </ul> </div> <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-xl backdrop-blur-sm"> <h2 class="text-accentGreen text-lg font-semibold mb-3">Etiquetas y Tecnología</h2> <div class="flex flex-wrap gap-2"> <span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> Forensics </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> Blue Team </span><span class="px-3 py-1 rounded-full bg-slate-800/60 text-slate-300 border border-slate-700 text-sm"> ciberdefenders </span> </div> </div> </section> <!-- IMAGEN DESTACADA -->  <div class="prose-writeup"> <h4 id="guión">Guión</h4>
<p>El SOC de TechNova Systems ha detectado tráfico saliente sospechoso desde un servidor IIS público en su plataforma en la nube, actividad que sugiere una caída del shell web y conexiones encubiertas a un host desconocido.</p>
<p>Como examinador forense, tiene tres artefactos críticos a su disposición: un PCAP que captura el tráfico inicial, una imagen completa de la memoria del servidor y una muestra de malware recuperada del disco. Reconstruya la intrusión y todas las actividades del atacante para que TechNova pueda contener la brecha y reforzar sus defensas.
Este laboratorio, denominado <strong>Lockdown Lab</strong>, es un ejercicio de respuesta a incidentes y análisis forense digital (DFIR). El objetivo es reconstruir la cadena de ataque (Kill Chain) sufrida por un servidor IIS, desde el reconocimiento inicial hasta la identificación de la familia de malware.</p>
<h2 id="1-resumen-del-incidente">1. Resumen del Incidente</h2>
<p>El SOC de TechNova Systems identificó tráfico saliente sospechoso desde un servidor IIS público. El análisis forense confirmó el compromiso del host mediante la carga de un web shell y la posterior ejecución de un troyano de acceso remoto (RAT) para persistencia y exfiltración de datos.</p>
<hr>
<h3 id="fase-1-reconocimiento-y-enumeración">Fase 1: Reconocimiento y Enumeración</h3>
<p>El atacante comenzó identificando servicios vulnerables en la infraestructura de TechNova Systems.</p>
<ul>
<li>
<p><strong>Identificación del Atacante:</strong> Mediante el análisis del tráfico de red (PCAP), se determinó que la dirección IP <strong>10.0.2.4</strong> fue la fuente de los sondeos rápidos.</p>
</li>
<li>
<p><strong>Técnica de MITRE ATT&#x26;CK:</strong> Esta actividad se clasifica como <strong>T1046 (Network Service Scanning)</strong>, utilizada para buscar servicios abiertos en el host objetivo.</p>
</li>
</ul>
<h3 id="fase-2-explotación-y-acceso-inicial">Fase 2: Explotación y Acceso Inicial</h3>
<p>El atacante aprovechó el protocolo SMB (Server Message Block) para interactuar con el servidor e introducir archivos maliciosos.</p>
<ul>
<li>
<p><strong>Enumeración SMB:</strong> El análisis de tráfico mostró conexiones a recursos compartidos (Tree Connect) específicos: <code>\\10.0.2.15\Documents</code> y <code>\\10.0.2.15\IPC$</code>.</p>
</li>
<li>
<p><strong>Instalación del Web Shell:</strong> El atacante subió una carga útil llamada <strong><code>shell.aspx</code></strong>. Este archivo permitió la ejecución remota de código (RCE) a través de la web.</p>
<ul>
<li><strong>Detalle Técnico:</strong> La solicitud de escritura SMB2 especificó un tamaño exacto de <strong>1,015,024 bytes</strong> para este archivo.</li>
</ul>
</li>
<li>
<p><strong>Establecimiento del Canal:</strong> La web shell realizó una conexión de retorno (<strong>Reverse Shell</strong>) al atacante a través del puerto <strong>4443</strong>.</p>
</li>
</ul>
<h4 id="filtros-de-wireshark-utilizados">Filtros de Wireshark Utilizados</h4>
<ul>
<li>
<p><strong>Identificación de origen:</strong> <code>ip.src == 10.0.2.4</code> permite aislar el tráfico del atacante durante la fase de sondeo.</p>
</li>
<li>
<p><strong>Enumeración de recursos:</strong> <code>smb2.tree_connect_request</code> visualiza las solicitudes a rutas compartidas.</p>
</li>
<li>
<p><strong>Localización de carga útil:</strong> <code>smb2.filename contains "shell.aspx"</code> identifica la transferencia del archivo malicioso.</p>
</li>
<li>
<p><strong>Canal de comunicación:</strong> <code>tcp.port == 4443</code> filtra el tráfico de la shell inversa establecida tras la explotación.</p>
</li>
</ul>
<h4 id="hallazgos-técnicos">Hallazgos Técnicos</h4>
<ul>
<li>
<p><strong>IP Atacante:</strong> 10.0.2.4.</p>
</li>
<li>
<p><strong>Técnica MITRE ATT&#x26;CK:</strong> T1046 (Network Service Scanning).</p>
</li>
<li>
<p><strong>Recursos SMB Comprometidos:</strong> <code>\\10.0.2.15\Documents</code> y <code>\\10.0.2.15\IPC$</code>.</p>
</li>
<li>
<p><strong>Web Shell:</strong> <code>shell.aspx</code> (Longitud: 1,015,024 bytes).</p>
</li>
<li>
<p><strong>Puerto de Escucha:</strong> 4443.</p>
</li>
</ul>
<hr>
<h3 id="fase-3-análisis-forense-de-memoria">Fase 3: Análisis Forense de Memoria</h3>
<p>Para comprender el estado del sistema comprometido, se analizó el volcado de memoria (<code>memdump.mem</code>).</p>
<ul>
<li>
<p><strong>Contexto del Sistema:</strong> Se identificó la dirección base del núcleo (Kernel) en <strong><code>0xf80079213000</code></strong>, un dato crítico para mapear procesos en memoria.</p>
</li>
<li>
<p><strong>Persistencia:</strong> Se detectó un ejecutable sospechoso fuera de la ruta habitual de IIS: <code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\updatenow.exe</code>.</p>
<ul>
<li><strong>Técnica de MITRE ATT&#x26;CK:</strong> Este método de persistencia corresponde a <strong>T1547 (Boot or Logon Autostart Execution)</strong>.</li>
</ul>
</li>
<li>
<p><strong>Relación de Procesos:</strong> El proceso legítimo de Windows <strong><code>w3wp.exe</code></strong> (el proceso de trabajo de IIS), bajo el <strong>PID 4332</strong>, fue el encargado de gestionar el tráfico de la shell inversa y generar el ejecutable de persistencia.</p>
</li>
</ul>
<h4 id="comandos-de-volatility-3">Comandos de Volatility 3</h4>
<ul>
<li>
<p><code>windows.info</code>: Utilizado para determinar que la dirección base del núcleo es <strong>0xf80079213000</strong>.</p>
</li>
<li>
<p><code>windows.pstree</code>: Reveló que el proceso de trabajo de IIS <strong>w3wp.exe</strong> (PID 4332) gestionó el tráfico de la shell y generó el ejecutable de persistencia.</p>
</li>
<li>
<p><code>windows.filescan</code>: Localizó el binario implantado en la ruta de inicio del sistema.</p>
</li>
</ul>
<h4 id="persistencia-y-ejecución">Persistencia y Ejecución</h4>
<ul>
<li>
<p><strong>Ruta del ejecutable:</strong> <code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\updatenow.exe</code>.</p>
</li>
<li>
<p><strong>Técnica MITRE ATT&#x26;CK:</strong> T1547 (Boot or Logon Autostart Execution).</p>
</li>
<li>
<p><strong>Tráfico saliente del shell inverso:</strong>  w3wp.exe,4332</p>
</li>
</ul>
<hr>
<h3 id="fase-4-análisis-de-malware-ingeniería-inversa">Fase 4: Análisis de Malware (Ingeniería Inversa)</h3>
<p>El archivo recuperado, <code>updatenow.exe</code>, fue sometido a inspección estática y de inteligencia.</p>





















<table><thead><tr><th><strong>Atributo</strong></th><th><strong>Detalle Técnico</strong></th></tr></thead><tbody><tr><td><strong>Formato</strong></td><td>AutoIt (v3.XX)</td></tr><tr><td><strong>Empaquetado</strong></td><td><strong>UPX (v3.91)</strong>, utilizado para comprimir y dificultar el análisis estático</td></tr><tr><td><strong>C&#x26;C (FQDN)</strong></td><td>El malware se comunica con el dominio <strong><code>cp8nl.hyperhost.ua</code></strong></td></tr></tbody></table>
<h3 id="fase-5-atribución">Fase 5: Atribución</h3>
<p>Finalmente, cruzando el hash del archivo y el dominio de Comando y Control (C2) con fuentes de inteligencia de código abierto (OSINT) como VirusTotal, se identificó la amenaza:</p>
<ul>
<li>
<p><strong>Familia de Malware:</strong> <strong>AgentTesla</strong>.</p>
</li>
<li>
<p><strong>Capacidades:</strong> Se trata de un <strong>RAT (Remote Access Trojan)</strong> y spyware diseñado en .NET para el robo de datos personales, captura de pantalla y registro de pulsaciones de teclas (keylogger).</p>
</li>
</ul>
<p>El binario recuperado fue analizado para identificar su funcionalidad y destino de conexión.</p>
<h4 id="procedimiento-técnico">Procedimiento Técnico</h4>
<ul>
<li>
<p><strong>Identificación:</strong> El comando <code>diec updatenow.exe</code> determinó que es un script de <strong>AutoIt (3.XX)</strong> empaquetado con <strong>UPX (3.91)</strong>.</p>
</li>
<li>
<p><strong>Desofuscación:</strong> Se requiere el uso de <code>upx -d</code> para descomprimir el binario y facilitar la extracción de cadenas de texto.</p>
</li>
<li>
<p><strong>Atribución OSINT:</strong> El hash del archivo vincula la muestra con la familia de malware <strong>AgentTesla</strong>.</p>
</li>
</ul>
<h4 id="inteligencia-de-comando-y-control-c2">Inteligencia de Comando y Control (C2)</h4>





















<table><thead><tr><th><strong>Atributo</strong></th><th><strong>Detalle</strong></th></tr></thead><tbody><tr><td><strong>FQDN de Conexión</strong></td><td><code>cp8nl.hyperhost.ua</code></td></tr><tr><td><strong>Familia de Malware</strong></td><td>AgentTesla</td></tr><tr><td><strong>Capacidades</strong></td><td>Robo de credenciales, captura de pantalla y registro de teclado</td></tr></tbody></table> </div> <!-- FOOTER DEL ARTÍCULO --> <div class="mt-16 pt-8 border-t border-slate-800 text-center"> <a href="/writeups" class="text-slate-400 hover:text-accentBlue transition-colors">
← Volver a la lista de writeups
</a> </div> </article>   </div> </article> </main> <footer class="w-full py-6 mt-12"> <div class="container mx-auto text-sm text-slate-400">
© 2026 Angel Corral - Todos los derechos reservados.
</div> </footer> </div> </body></html>